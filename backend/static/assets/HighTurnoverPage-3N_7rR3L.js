import{j as e,u as T}from"./vendor-data-CkOiUkF9.js";import{a as o,L as Y}from"./vendor-react-CiXd1m8D.js";import{C as d,a as x,b as u,c}from"./card-BInHG3Zt.js";import{u as Z,B as m}from"./index-CN1IIGNT.js";import{I as v}from"./input-C5aoutXU.js";import{L as y}from"./label-D66ahaKK.js";import{n as B,o as G,e as V,F as S,j as J,p as W,A as ee,Z as se,q as te,i as ae}from"./vendor-utils-3hQanHZm.js";import{R as w,B as P,X as z,Y as F,T as C,b as $,C as K,P as re,a as ne,L as ie,S as le,c as oe,d as de}from"./vendor-charts-2uieviVG.js";import{S as ce,a as me,b as xe,g as ue}from"./StockAnalysisDialog-Bwyn-n6i.js";import{f as pe,a as he,g as je,b as M}from"./format-CUqWL-d1.js";import"./vendor-radix-aGPdNwig.js";const O=["#f97316","#3b82f6","#22c55e","#eab308","#8b5cf6","#ec4899","#14b8a6","#f43f5e"];function fe({stocks:n}){const h=o.useMemo(()=>n.slice(0,20).map(s=>({rank:s.turnover_rank,symbol:s.symbol,turnover_rate:s.turnover_rate,is_limit_up:s.is_limit_up,fill:s.is_limit_up?"#f97316":"#3b82f6"})),[n]),j=o.useMemo(()=>{const s=n.filter(r=>r.is_limit_up),a={};return s.forEach(r=>{const i=r.industry||"其他";a[i]=(a[i]||0)+1}),Object.entries(a).map(([r,i])=>({name:r,value:i})).sort((r,i)=>i.value-r.value).slice(0,8)},[n]),N=o.useMemo(()=>n.map(s=>({symbol:s.symbol,name:s.name,turnover_rate:s.turnover_rate,change_percent:s.change_percent||0,is_limit_up:s.is_limit_up})),[n]),l=o.useMemo(()=>{const s={};return n.filter(a=>a.is_limit_up).forEach(a=>{const r=a.limit_up_type||"未知";s[r]=(s[r]||0)+1}),Object.entries(s).map(([a,r])=>({name:a,value:r}))},[n]);return n.length===0?null:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 mb-6",children:[e.jsxs(d,{className:"lg:col-span-2",children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"})," 周轉率前20名分布（橙色=漲停）"]})}),e.jsx(c,{children:e.jsx(w,{width:"100%",height:250,children:e.jsxs(P,{data:h,margin:{bottom:10,right:20},children:[e.jsx(z,{dataKey:"rank",tick:{fontSize:10}}),e.jsx(F,{tick:{fontSize:10}}),e.jsx(C,{content:({payload:s})=>{if(s&&s.length){const a=s[0].payload;return e.jsxs("div",{className:"bg-popover p-2 rounded shadow text-xs",children:[e.jsxs("div",{children:["#",a.rank," ",a.symbol]}),e.jsxs("div",{children:["周轉率: ",a.turnover_rate,"%"]}),e.jsx("div",{children:a.is_limit_up?"漲停":""})]})}return null}}),e.jsx($,{dataKey:"turnover_rate",radius:[2,2,0,0],children:h.map((s,a)=>e.jsx(K,{fill:s.fill},a))})]})})})]}),e.jsxs(d,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"})," 前20名中漲停股產業分布"]})}),e.jsx(c,{children:j.length>0?e.jsx(w,{width:"100%",height:280,children:e.jsxs(re,{children:[e.jsx(ne,{data:j,dataKey:"value",nameKey:"name",cx:"50%",cy:"40%",outerRadius:60,label:({percent:s})=>`${(s*100).toFixed(0)}%`,labelLine:!1,children:j.map((s,a)=>e.jsx(K,{fill:O[a%O.length]},a))}),e.jsx(C,{formatter:(s,a)=>[`${s} 檔`,a]}),e.jsx(ie,{layout:"horizontal",verticalAlign:"bottom",align:"center",wrapperStyle:{fontSize:"10px",paddingTop:"8px"},formatter:s=>s.length>6?s.slice(0,6)+"…":s})]})}):e.jsx("div",{className:"h-[200px] flex items-center justify-center text-muted-foreground text-sm",children:"無漲停股資料"})})]}),e.jsxs(d,{className:"lg:col-span-2",children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"})," 周轉率 vs 漲幅（前20名）"]})}),e.jsx(c,{children:e.jsx(w,{width:"100%",height:280,children:e.jsxs(le,{margin:{bottom:30,left:10,right:20,top:10},children:[e.jsx(oe,{strokeDasharray:"3 3",opacity:.3}),e.jsx(z,{dataKey:"turnover_rate",name:"周轉率",unit:"%",tick:{fontSize:10},label:{value:"周轉率(%)",position:"bottom",fontSize:10}}),e.jsx(F,{dataKey:"change_percent",name:"漲幅",unit:"%",tick:{fontSize:10},label:{value:"漲幅(%)",angle:-90,position:"left",fontSize:10}}),e.jsx(C,{content:({payload:s})=>{var a;if(s&&s.length){const r=s[0].payload;return e.jsxs("div",{className:"bg-popover p-2 rounded shadow text-xs",children:[e.jsxs("div",{className:"font-bold",children:[r.symbol," ",r.name]}),e.jsxs("div",{children:["周轉率: ",r.turnover_rate,"%"]}),e.jsxs("div",{children:["漲幅: ",(a=r.change_percent)==null?void 0:a.toFixed(2),"%"]})]})}return null}}),e.jsx(de,{data:N,fill:"#3b82f6",children:N.map((s,a)=>e.jsx(K,{fill:s.is_limit_up?"#f97316":"#3b82f6"},a))})]})})})]}),e.jsxs(d,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"})," 漲停類型"]})}),e.jsx(c,{children:l.length>0?e.jsx(w,{width:"100%",height:200,children:e.jsxs(P,{data:l,layout:"vertical",children:[e.jsx(z,{type:"number",tick:{fontSize:10}}),e.jsx(F,{dataKey:"name",type:"category",tick:{fontSize:10},width:60}),e.jsx(C,{}),e.jsx($,{dataKey:"value",fill:"#f97316",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-[200px] flex items-center justify-center text-muted-foreground text-sm",children:"無漲停股資料"})})]})]})}function Te(){const{queryDate:n,setQueryDate:h}=Z(),[j,N]=o.useState(!1),[l,s]=o.useState("limit_up"),[a,r]=o.useState({min_turnover_rate:"",price_max:"",max_open_count:""}),[i,q]=o.useState(null),[E,A]=o.useState(!1),R=(t,_)=>{q({symbol:t,name:_}),A(!0)},U=()=>{A(!1),q(null)},{data:f,isLoading:H,refetch:I}=T({queryKey:["highTurnoverLimitUp",n],queryFn:()=>me(n),enabled:!!n}),{data:k,isLoading:Q}=T({queryKey:["top20Turnover",n],queryFn:()=>xe(n),enabled:!!n&&l==="top20"}),{data:g}=T({queryKey:["tradingDate"],queryFn:ue});o.useEffect(()=>{g!=null&&g.latest_trading_day&&!n&&h(g.latest_trading_day)},[g,n,h]);const p=f==null?void 0:f.stats,b=l==="limit_up"?(f==null?void 0:f.items)||[]:(k==null?void 0:k.items)||[],X=l==="limit_up"?H:Q,L=t=>{switch(t){case"strong_retail":r({min_turnover_rate:"20",max_open_count:"1",price_max:""});break;case"low_price":r({min_turnover_rate:"",max_open_count:"",price_max:"30"});break;case"big_player":r({min_turnover_rate:"15",max_open_count:"",price_max:""});break}};return e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx(m,{variant:"ghost",size:"icon",asChild:!0,className:"hover:bg-muted/80 transition-colors",children:e.jsx(Y,{to:"/",children:e.jsx(J,{className:"w-5 h-5"})})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3 tracking-tight",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-500/10",children:e.jsx(S,{className:"w-6 h-6 text-orange-500"})}),"周轉率前200名漲停股分析"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["顯示當日周轉率排名前200的股票中，達到漲停的股票",e.jsx("span",{className:"ml-2 font-mono text-xs bg-muted px-2 py-0.5 rounded-full",children:n})]})]})]}),p&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[e.jsxs(d,{className:"border-border/50 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"周轉率前200名"})}),e.jsx(c,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[p.top20_count," ",e.jsx("span",{className:"text-base font-normal text-muted-foreground",children:"檔"})]})})]}),e.jsxs(d,{className:"border-l-4 border-orange-500 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-xs font-medium text-orange-500 uppercase tracking-wide",children:"其中漲停股數"})}),e.jsx(c,{children:e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[p.limit_up_count," ",e.jsx("span",{className:"text-base font-normal opacity-70",children:"檔"})]})})]}),e.jsxs(d,{className:"border-border/50 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"漲停佔比"})}),e.jsx(c,{children:e.jsxs("div",{className:"text-2xl font-bold font-mono",children:[p.limit_up_count,"/",p.top20_count," = ",p.limit_up_ratio,"%"]})})]}),e.jsxs(d,{className:"border-border/50 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"平均周轉率"})}),e.jsx(c,{children:e.jsxs("div",{className:"text-2xl font-bold font-mono",children:[p.avg_turnover_rate,"%"]})})]})]}),e.jsx(d,{className:"mb-6 border-border/50 shadow-sm",children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(y,{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"查詢日期"}),e.jsx(v,{type:"date",value:n,onChange:t=>h(t.target.value),className:"w-44 font-mono text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:l==="limit_up"?"default":"outline",onClick:()=>s("limit_up"),className:"transition-all duration-200",children:[e.jsx(S,{className:"w-4 h-4 mr-1.5"})," 漲停股"]}),e.jsxs(m,{variant:l==="top20"?"default":"outline",onClick:()=>s("top20"),className:"transition-all duration-200",children:[e.jsx(B,{className:"w-4 h-4 mr-1.5"})," Top200完整"]})]}),e.jsxs(m,{variant:"outline",onClick:()=>N(!j),className:"transition-all duration-200",children:[e.jsx(W,{className:"w-4 h-4 mr-1.5"})," 篩選"]}),e.jsxs(m,{onClick:()=>I(),className:"shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(ee,{className:"w-4 h-4 mr-1.5"})," 重新查詢"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-5 pt-5 border-t border-border/50",children:[e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1.5 uppercase tracking-wide",children:[e.jsx(se,{className:"w-4 h-4"})," 快速預設："]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>L("strong_retail"),className:"text-orange-500 hover:bg-orange-500/10 transition-colors",children:"超強游資股"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>L("low_price"),className:"text-amber-500 hover:bg-amber-500/10 transition-colors",children:"低價飆股"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>L("big_player"),className:"text-blue-500 hover:bg-blue-500/10 transition-colors",children:"大戶進場"})]}),j&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"最低周轉率 (%)"}),e.jsx(v,{type:"number",placeholder:"例: 10",value:a.min_turnover_rate,onChange:t=>r({...a,min_turnover_rate:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"最高股價"}),e.jsx(v,{type:"number",placeholder:"例: 50",value:a.price_max,onChange:t=>r({...a,price_max:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"開板次數上限"}),e.jsx(v,{type:"number",placeholder:"例: 0 (封死)",value:a.max_open_count,onChange:t=>r({...a,max_open_count:t.target.value})})]})]})]})}),b.length>0&&e.jsx(fe,{stocks:b}),e.jsxs(d,{className:"border-border/50 shadow-sm overflow-hidden",children:[e.jsx(x,{className:"pb-3 border-b border-border/50",children:e.jsxs(u,{className:"text-lg flex items-center justify-between",children:[e.jsx("span",{className:"flex items-center gap-2",children:l==="limit_up"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1.5 rounded-md bg-orange-500/10",children:e.jsx(S,{className:"w-5 h-5 text-orange-500"})})," 高周轉漲停股"]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1.5 rounded-md bg-muted",children:e.jsx(te,{className:"w-5 h-5"})})," 周轉率前200完整名單"]})}),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground bg-muted/50 px-3 py-1 rounded-full",children:["共 ",b.length," 檔"]})]})}),e.jsx(c,{className:"p-0",children:X?e.jsxs("div",{className:"py-20 text-center text-muted-foreground",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-3"}),e.jsx("p",{children:"載入中..."})]}):b.length===0?e.jsx("div",{className:"py-20 text-center text-muted-foreground",children:l==="limit_up"?"今日周轉率前200名中無漲停股票":"查無資料"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 border-b border-border/50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"排名"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"代號"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"名稱"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"產業"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"收盤價"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"漲幅"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"周轉率"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"成交量"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"流通股數"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"漲停類型"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"封單量"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"連漲"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"divide-y divide-border/30",children:b.map(t=>{var _,D;return e.jsxs("tr",{className:`hover:bg-muted/40 transition-colors duration-150 ${t.is_limit_up?"bg-orange-500/5":""} ${t.turnover_rank<=10?"font-medium bg-amber-500/5":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center justify-center w-7 h-7 rounded-full text-xs font-semibold ${t.turnover_rank<=10?"bg-amber-500 text-white shadow-sm":"bg-muted text-muted-foreground"}`,children:t.turnover_rank})}),e.jsx("td",{className:"px-4 py-3 font-mono font-medium text-primary",children:t.symbol}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("span",{className:"font-medium",children:t.name}),t.is_limit_up&&e.jsx("span",{className:"ml-1.5 inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-orange-500/10 text-orange-500",children:"漲停"})]}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-xs",children:t.industry||"-"}),e.jsx("td",{className:"px-4 py-3 font-mono tabular-nums",children:pe(t.close_price)}),e.jsx("td",{className:`px-4 py-3 font-mono font-semibold tabular-nums ${je(t.change_percent)}`,children:he(t.change_percent)}),e.jsxs("td",{className:"px-4 py-3 font-mono font-semibold tabular-nums text-sky-500",children:[(_=t.turnover_rate)==null?void 0:_.toFixed(1),"%"]}),e.jsx("td",{className:"px-4 py-3 font-mono tabular-nums text-muted-foreground",children:M(t.volume)}),e.jsxs("td",{className:"px-4 py-3 font-mono text-xs tabular-nums",children:[(D=t.float_shares)==null?void 0:D.toFixed(0),"萬"]}),e.jsx("td",{className:"px-4 py-3",children:t.limit_up_type&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${t.limit_up_type==="一字板"?"bg-red-500 text-white":"bg-muted"}`,children:t.limit_up_type})}),e.jsx("td",{className:"px-4 py-3 font-mono tabular-nums",children:t.seal_volume?M(t.seal_volume):"-"}),e.jsx("td",{className:"px-4 py-3",children:t.consecutive_up_days&&t.consecutive_up_days>0?e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-xs bg-red-500/10 text-red-500 font-medium",children:[t.consecutive_up_days,"天"]}):"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>R(t.symbol,t.name),className:"h-8 w-8 p-0 hover:bg-primary/10 hover:text-primary transition-colors cursor-pointer",title:"查看K線圖",children:e.jsx(ae,{className:"h-4 w-4"})})})]},t.symbol)})})]})})})]}),e.jsx(ce,{open:E,onClose:U,symbol:(i==null?void 0:i.symbol)||null,name:i==null?void 0:i.name})]})}export{Te as HighTurnoverPage};
