import{j as e,c as nt}from"./vendor-data-BGC679gK.js";import{r}from"./vendor-react-CfDhA8Yr.js";import{c as Te,B as A,p as rt}from"./index-C61RkY3j.js";import{n as lt,o as qe,p as Xe,q as Ye}from"./vendor-radix-DB-zNCEb.js";import{f as Se,o as Ne,g as Ce}from"./vendor-charts-DCUSocby.js";import{N as at,O as it,Q as ot,X as ct,T as Ze,V as ut,W as ft,Y as mt,_ as dt,$ as ht,B as Be,a0 as gt,a1 as xt,L as Ue,C as bt,i as pt,a2 as yt,a3 as vt,a4 as wt,R as jt,p as Rt,A as kt,k as St}from"./vendor-utils-CbPNna8o.js";const Qe=r.forwardRef(({className:s,type:i,...g},o)=>e.jsx("input",{type:i,className:Te("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:o,...g}));Qe.displayName="Input";const Nt=lt,Je=r.forwardRef(({className:s,...i},g)=>e.jsx(qe,{ref:g,className:Te("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...i}));Je.displayName=qe.displayName;const Re=r.forwardRef(({className:s,...i},g)=>e.jsx(Xe,{ref:g,className:Te("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...i}));Re.displayName=Xe.displayName;const ke=r.forwardRef(({className:s,...i},g)=>e.jsx(Ye,{ref:g,className:Te("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...i}));ke.displayName=Ye.displayName;const Ee="#ef5350",Pe="#26a69a",we={ma5:"#ffc107",ma10:"#9c27b0",ma20:"#2196f3",ma60:"#ff9800",ma120:"#9e9e9e"},Ve={upper:"#e91e63",middle:"#ffc107",lower:"#4caf50"};function Ct(s){return s.filter(i=>i.open!=null&&i.high!=null&&i.low!=null&&i.close!=null).map(i=>({time:i.date,open:i.open,high:i.high,low:i.low,close:i.close}))}function ae(s,i){return s.filter(g=>g[i]!=null&&typeof g[i]=="number").map(g=>({time:g.date,value:g[i]}))}function Mt({data:s,height:i=400,showBollinger:g=!1,visibleMAs:o={ma5:!0,ma10:!0,ma20:!0,ma60:!0,ma120:!1},onChartReady:y,onCrosshairMove:k,onChartClick:f}){const b=r.useRef(null),c=r.useRef(null),T=r.useRef(s),C=r.useRef({});return r.useEffect(()=>{if(!b.current)return;const h=Se(b.current,{width:b.current.clientWidth,height:i,layout:{background:{type:Ce.Solid,color:"#ffffff"},textColor:"#333333"},grid:{vertLines:{color:"rgba(197, 203, 206, 0.3)"},horzLines:{color:"rgba(197, 203, 206, 0.3)"}},crosshair:{mode:Ne.Normal,vertLine:{width:1,color:"rgba(0, 0, 0, 0.3)",style:3},horzLine:{width:1,color:"rgba(0, 0, 0, 0.3)",style:3}},rightPriceScale:{borderColor:"rgba(197, 203, 206, 0.8)",scaleMargins:{top:.1,bottom:.1}},timeScale:{borderColor:"rgba(197, 203, 206, 0.8)",timeVisible:!0,secondsVisible:!1,rightOffset:0,barSpacing:8,minBarSpacing:2,fixLeftEdge:!1,fixRightEdge:!0,lockVisibleTimeRangeOnResize:!0,rightBarStaysOnScroll:!0},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!1},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}});c.current=h;const z=h.addCandlestickSeries({upColor:Ee,downColor:Pe,borderUpColor:Ee,borderDownColor:Pe,wickUpColor:Ee,wickDownColor:Pe});C.current.candlestick=z,C.current.ma5=h.addLineSeries({color:we.ma5,lineWidth:1,visible:o.ma5!==!1,lastValueVisible:!1,priceLineVisible:!1}),C.current.ma10=h.addLineSeries({color:we.ma10,lineWidth:1,visible:o.ma10!==!1,lastValueVisible:!1,priceLineVisible:!1}),C.current.ma20=h.addLineSeries({color:we.ma20,lineWidth:1,visible:o.ma20!==!1,lastValueVisible:!1,priceLineVisible:!1}),C.current.ma60=h.addLineSeries({color:we.ma60,lineWidth:1,visible:o.ma60!==!1,lastValueVisible:!1,priceLineVisible:!1}),C.current.ma120=h.addLineSeries({color:we.ma120,lineWidth:1,visible:o.ma120===!0,lastValueVisible:!1,priceLineVisible:!1}),C.current.bbUpper=h.addLineSeries({color:Ve.upper,lineWidth:1,lineStyle:2,title:"BB Upper",visible:g}),C.current.bbMiddle=h.addLineSeries({color:Ve.middle,lineWidth:1,title:"BB Middle",visible:g}),C.current.bbLower=h.addLineSeries({color:Ve.lower,lineWidth:1,lineStyle:2,title:"BB Lower",visible:g});const F=new ResizeObserver(D=>{if(!h||D.length===0||D[0].target!==b.current)return;const P=D[0].contentRect;h.applyOptions({width:P.width,height:P.height})});return F.observe(b.current),k&&h.subscribeCrosshairMove(D=>{if(!D.time||!D.point){k(null);return}const P=D.time,m=T.current.find(N=>N.date===P);m&&k({date:m.date,open:m.open,high:m.high,low:m.low,close:m.close,volume:m.volume,ma5:m.ma5,ma10:m.ma10,ma20:m.ma20,ma60:m.ma60,ma120:m.ma120})}),h.subscribeClick(D=>{if(!D.time||!D.point)return;const P=D.time,m=T.current.find(N=>N.date===P);m&&f&&f({date:m.date,open:m.open,high:m.high,low:m.low,close:m.close,volume:m.volume,ma5:m.ma5,ma10:m.ma10,ma20:m.ma20,ma60:m.ma60,ma120:m.ma120})}),y&&y(h,z),()=>{F.disconnect(),h.remove(),c.current=null}},[]),r.useEffect(()=>{!c.current||!b.current||c.current.applyOptions({width:b.current.clientWidth,height:i})},[i]),r.useEffect(()=>{if(!c.current||!s||s.length===0)return;T.current=s;const h=C.current;h.candlestick&&h.candlestick.setData(Ct(s));const{ma5:z,ma10:F,ma20:D,ma60:P,ma120:m}=C.current;z&&z.setData(ae(s,"ma5")),F&&F.setData(ae(s,"ma10")),D&&D.setData(ae(s,"ma20")),P&&P.setData(ae(s,"ma60")),m&&m.setData(ae(s,"ma120")),h.bbUpper&&h.bbUpper.setData(ae(s,"bb_upper")),h.bbMiddle&&h.bbMiddle.setData(ae(s,"bb_middle")),h.bbLower&&h.bbLower.setData(ae(s,"bb_lower"))},[s,c.current]),r.useEffect(()=>{const h=C.current;h.ma5&&h.ma5.applyOptions({visible:o.ma5!==!1}),h.ma10&&h.ma10.applyOptions({visible:o.ma10!==!1}),h.ma20&&h.ma20.applyOptions({visible:o.ma20!==!1}),h.ma60&&h.ma60.applyOptions({visible:o.ma60!==!1}),h.ma120&&h.ma120.applyOptions({visible:o.ma120===!0})},[o]),r.useEffect(()=>{const h=C.current;h.bbUpper&&h.bbUpper.applyOptions({visible:g}),h.bbMiddle&&h.bbMiddle.applyOptions({visible:g}),h.bbLower&&h.bbLower.applyOptions({visible:g})},[g]),e.jsx("div",{ref:b,className:"w-full",style:{height:`${i}px`}})}const Lt="rgba(239, 83, 80, 0.6)",Dt="rgba(38, 166, 154, 0.6)";function Tt({data:s,height:i=120,onChartReady:g}){const o=r.useRef(null),y=r.useRef(null),k=r.useRef({});return r.useEffect(()=>{if(!o.current)return;const f=Se(o.current,{width:o.current.clientWidth,height:i,layout:{background:{type:Ce.Solid,color:"#ffffff"},textColor:"#333333"},grid:{vertLines:{color:"rgba(197, 203, 206, 0.3)"},horzLines:{color:"rgba(197, 203, 206, 0.3)"}},crosshair:{mode:Ne.Normal},rightPriceScale:{borderColor:"rgba(197, 203, 206, 0.8)",scaleMargins:{top:.1,bottom:0}},timeScale:{borderColor:"rgba(197, 203, 206, 0.8)",visible:!1,rightOffset:0,fixRightEdge:!0,lockVisibleTimeRangeOnResize:!0},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!1},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}});y.current=f,k.current.volume=f.addHistogramSeries({priceFormat:{type:"volume"},priceScaleId:"right"}),k.current.volumeMa5=f.addLineSeries({color:"#ff9800",lineWidth:1,lineStyle:2,priceScaleId:"right"});const b=new ResizeObserver(c=>{if(!f||c.length===0||c[0].target!==o.current)return;const T=c[0].contentRect;f.applyOptions({width:T.width,height:T.height})});return b.observe(o.current),g&&g(f),()=>{b.disconnect(),f.remove(),y.current=null}},[]),r.useEffect(()=>{!y.current||!o.current||y.current.resize(o.current.clientWidth,i)},[i]),r.useEffect(()=>{if(!s||s.length===0)return;const f=k.current;if(f.volume){const b=s.map(c=>({time:c.date,value:c.volume||0,color:(c.close||0)>=(c.open||0)?Lt:Dt}));f.volume.setData(b)}if(f.volumeMa5){const b=s.filter(c=>c.volume_ma5!=null).map(c=>({time:c.date,value:c.volume_ma5}));f.volumeMa5.setData(b)}},[s]),e.jsx("div",{ref:o,className:"w-full",style:{height:`${i}px`}})}function Ke({data:s,height:i=200,onChartReady:g}){const o=r.useRef(null),y=r.useRef(null),k=r.useRef({});return r.useEffect(()=>{if(!o.current)return;const f=Se(o.current,{width:o.current.clientWidth,height:i,layout:{background:{type:Ce.Solid,color:"#ffffff"},textColor:"#333333"},grid:{vertLines:{color:"rgba(197, 203, 206, 0.3)"},horzLines:{color:"rgba(197, 203, 206, 0.3)"}},crosshair:{mode:Ne.Normal},rightPriceScale:{borderColor:"rgba(197, 203, 206, 0.8)",scaleMargins:{top:.1,bottom:.1}},timeScale:{borderColor:"rgba(197, 203, 206, 0.8)",visible:!1,rightOffset:0,fixRightEdge:!0,lockVisibleTimeRangeOnResize:!0},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!1},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}});y.current=f,k.current.histogram=f.addHistogramSeries({priceFormat:{type:"price",precision:4,minMove:1e-4},priceScaleId:"right"}),k.current.macd=f.addLineSeries({color:"#2196f3",lineWidth:2,priceScaleId:"right"}),k.current.signal=f.addLineSeries({color:"#ff9800",lineWidth:2,priceScaleId:"right"});const b=new ResizeObserver(c=>{if(!f||c.length===0||c[0].target!==o.current)return;const T=c[0].contentRect;f.applyOptions({width:T.width,height:T.height})});return b.observe(o.current),g&&g(f),()=>{b.disconnect(),f.remove(),y.current=null}},[]),r.useEffect(()=>{!y.current||!o.current||y.current.resize(o.current.clientWidth,i)},[i]),r.useEffect(()=>{if(!s||s.length===0)return;const f=k.current;if(f.histogram){const b=s.filter(c=>c.macd_hist!=null).map(c=>({time:c.date,value:c.macd_hist,color:(c.macd_hist||0)>=0?"#ef5350":"#26a69a"}));f.histogram.setData(b)}if(f.macd){const b=s.filter(c=>c.macd!=null).map(c=>({time:c.date,value:c.macd}));f.macd.setData(b)}if(f.signal){const b=s.filter(c=>c.macd_signal!=null).map(c=>({time:c.date,value:c.macd_signal}));f.signal.setData(b)}},[s]),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 text-xs border-b",children:[e.jsx("span",{className:"font-medium",children:"MACD (12, 26, 9)"}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#2196f3"},children:"â—"})," MACD"]}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#ff9800"},children:"â—"})," Signal"]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-red-500",children:"â– "}),"/",e.jsx("span",{className:"text-green-500",children:"â– "})," Histogram"]})]}),e.jsx("div",{ref:o,className:"w-full",style:{height:`${i}px`}})]})}function $e({data:s,height:i=200,onChartReady:g}){const o=r.useRef(null),y=r.useRef(null),k=r.useRef({});return r.useEffect(()=>{if(!o.current)return;const f=Se(o.current,{width:o.current.clientWidth,height:i,layout:{background:{type:Ce.Solid,color:"#ffffff"},textColor:"#333333"},grid:{vertLines:{color:"rgba(197, 203, 206, 0.3)"},horzLines:{color:"rgba(197, 203, 206, 0.3)"}},crosshair:{mode:Ne.Normal},rightPriceScale:{borderColor:"rgba(197, 203, 206, 0.8)",scaleMargins:{top:.05,bottom:.05}},timeScale:{borderColor:"rgba(197, 203, 206, 0.8)",visible:!1,rightOffset:0,fixRightEdge:!0,lockVisibleTimeRangeOnResize:!0},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!1},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}});y.current=f,k.current.kLine=f.addLineSeries({color:"#2196f3",lineWidth:2,priceScaleId:"right"}),k.current.dLine=f.addLineSeries({color:"#ff9800",lineWidth:2,priceScaleId:"right"}),f.priceScale("right").applyOptions({autoScale:!1,scaleMargins:{top:0,bottom:0}});const b=new ResizeObserver(c=>{if(!f||c.length===0||c[0].target!==o.current)return;const T=c[0].contentRect;f.applyOptions({width:T.width,height:T.height})});return b.observe(o.current),g&&g(f),()=>{b.disconnect(),f.remove(),y.current=null}},[]),r.useEffect(()=>{!y.current||!o.current||y.current.resize(o.current.clientWidth,i)},[i]),r.useEffect(()=>{if(!s||s.length===0)return;const f=k.current;if(f.kLine){const b=s.filter(c=>c.k!=null).map(c=>({time:c.date,value:c.k}));f.kLine.setData(b)}if(f.dLine){const b=s.filter(c=>c.d!=null).map(c=>({time:c.date,value:c.d}));f.dLine.setData(b)}},[s]),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 text-xs border-b",children:[e.jsx("span",{className:"font-medium",children:"KD éš¨æ©ŸæŒ‡æ¨™ (9, 3, 3)"}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#2196f3"},children:"â—"})," Kå€¼"]}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#ff9800"},children:"â—"})," Då€¼"]}),e.jsx("span",{className:"text-muted-foreground",children:"è¶…è²· 80+ / è¶…è³£ 20-"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:"5%",height:"20%",backgroundColor:"rgba(239, 83, 80, 0.08)",zIndex:1}}),e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none",style:{bottom:"5%",height:"20%",backgroundColor:"rgba(38, 166, 154, 0.08)",zIndex:1}}),e.jsx("div",{className:"absolute right-2 text-[10px] text-red-400 pointer-events-none",style:{top:"15%"},children:"80"}),e.jsx("div",{className:"absolute right-2 text-[10px] text-muted-foreground pointer-events-none",style:{top:"45%"},children:"50"}),e.jsx("div",{className:"absolute right-2 text-[10px] text-green-400 pointer-events-none",style:{bottom:"15%"},children:"20"}),e.jsx("div",{ref:o,className:"w-full relative",style:{height:`${i}px`,zIndex:2}})]})]})}function Ge({data:s,height:i=180,onChartReady:g}){const o=r.useRef(null),y=r.useRef(null),k=r.useRef(null);return r.useEffect(()=>{if(!o.current)return;const f=Se(o.current,{width:o.current.clientWidth,height:i,layout:{background:{type:Ce.Solid,color:"#ffffff"},textColor:"#333333"},grid:{vertLines:{color:"rgba(197, 203, 206, 0.3)"},horzLines:{color:"rgba(197, 203, 206, 0.3)"}},crosshair:{mode:Ne.Normal},rightPriceScale:{borderColor:"rgba(197, 203, 206, 0.8)",scaleMargins:{top:.05,bottom:.05}},timeScale:{borderColor:"rgba(197, 203, 206, 0.8)",visible:!1,rightOffset:0,fixRightEdge:!0,lockVisibleTimeRangeOnResize:!0},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!1},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}});y.current=f,k.current=f.addLineSeries({color:"#9c27b0",lineWidth:2,priceScaleId:"right"}),f.priceScale("right").applyOptions({autoScale:!1,scaleMargins:{top:0,bottom:0}});const b=new ResizeObserver(c=>{if(!f||c.length===0||c[0].target!==o.current)return;const T=c[0].contentRect;f.applyOptions({width:T.width,height:T.height})});return b.observe(o.current),g&&g(f),()=>{b.disconnect(),f.remove(),y.current=null}},[]),r.useEffect(()=>{!y.current||!o.current||y.current.resize(o.current.clientWidth,i)},[i]),r.useEffect(()=>{if(!s||s.length===0||!k.current)return;const f=s.filter(b=>b.rsi!=null).map(b=>({time:b.date,value:b.rsi}));k.current.setData(f)},[s]),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 text-xs border-b",children:[e.jsx("span",{className:"font-medium",children:"RSI ç›¸å°å¼·å¼±æŒ‡æ¨™ (14)"}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#9c27b0"},children:"â—"})," RSI"]}),e.jsx("span",{className:"text-muted-foreground",children:"è¶…è²· 70+ / è¶…è³£ 30-"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:"5%",height:"30%",backgroundColor:"rgba(239, 83, 80, 0.08)",zIndex:1}}),e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none",style:{bottom:"5%",height:"30%",backgroundColor:"rgba(38, 166, 154, 0.08)",zIndex:1}}),e.jsx("div",{className:"absolute right-2 text-[10px] text-red-400 pointer-events-none",style:{top:"20%"},children:"70"}),e.jsx("div",{className:"absolute right-2 text-[10px] text-muted-foreground pointer-events-none",style:{top:"45%"},children:"50"}),e.jsx("div",{className:"absolute right-2 text-[10px] text-green-400 pointer-events-none",style:{bottom:"20%"},children:"30"}),e.jsx("div",{ref:o,className:"w-full relative",style:{height:`${i}px`,zIndex:2}})]})]})}const zt=[{type:"trendline",label:"è¶¨å‹¢ç·š",icon:e.jsx(Ze,{className:"h-3.5 w-3.5"})},{type:"segment",label:"ç·šæ®µ",icon:e.jsx(ut,{className:"h-3.5 w-3.5"})},{type:"ray",label:"å°„ç·š",icon:e.jsx(ft,{className:"h-3.5 w-3.5"})},{type:"horizontal",label:"æ°´å¹³",icon:e.jsx(mt,{className:"h-3.5 w-3.5"})},{type:"vertical",label:"å‚ç›´",icon:e.jsx(dt,{className:"h-3.5 w-3.5"})},{type:"parallel",label:"é€šé“",icon:e.jsx(ht,{className:"h-3.5 w-3.5"})},{type:"fibonacci",label:"æ–æ³¢é‚£å¥‘",icon:e.jsx(Be,{className:"h-3.5 w-3.5"})},{type:"golden",label:"é»ƒé‡‘åˆ†å‰²",icon:e.jsx(Be,{className:"h-3.5 w-3.5"})},{type:"rectangle",label:"çŸ©å½¢",icon:e.jsx(gt,{className:"h-3.5 w-3.5"})},{type:"text",label:"æ–‡å­—",icon:e.jsx(xt,{className:"h-3.5 w-3.5"})}],je=["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6","#ec4899","#64748b"];function Et({activeType:s,onTypeChange:i,drawingCount:g=0}){return e.jsxs("div",{className:"flex items-center gap-0.5 flex-wrap",children:[e.jsx(A,{variant:s==="off"?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>i("off"),title:"æ­£å¸¸æ¨¡å¼ï¼ˆå¯æ‹–æ›³/åå­—è»¸ï¼‰",children:e.jsx(at,{className:"h-3.5 w-3.5"})}),g>0&&e.jsxs(A,{variant:s==="select"?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>i("select"),title:"é¸æ“‡æ¨¡å¼ï¼ˆé»é¸ç¹ªåœ–åˆªé™¤ï¼‰",children:[e.jsx(it,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"ml-0.5 text-[10px] bg-muted px-1 rounded",children:g})]}),e.jsx("div",{className:"w-px h-5 bg-border mx-0.5"}),zt.map(o=>e.jsxs(A,{variant:s===o.type?"default":"ghost",size:"sm",className:"h-7 px-1.5 text-xs",onClick:()=>i(o.type),title:o.label,children:[o.icon,e.jsx("span",{className:"ml-0.5 hidden sm:inline",children:o.label})]},o.type))]})}function Pt({width:s,height:i,drawings:g,activeType:o,selectedId:y,onAddDrawing:k,onSelectDrawing:f,onDeleteDrawing:b,chart:c,mainSeries:T}){const C=r.useRef(null),h=r.useRef(null),z=r.useRef(0),F=r.useRef(c),D=r.useRef(T);r.useEffect(()=>{F.current=c,D.current=T},[c,T]);const[P,m]=r.useState(!1),[N,ie]=r.useState(null),[oe,ce]=r.useState(null),[Y,fe]=r.useState(null),[me,ue]=r.useState(0),[Z,se]=r.useState({x:0,y:0,show:!1}),[ne,pe]=r.useState(""),U=r.useRef(je[0]),[J,re]=r.useState(0),ee=o==="off",K=o==="select",X=!ee&&!K,$=r.useCallback(l=>{const t=F.current,a=D.current;if(!t||!a)return null;try{const d=t.timeScale().coordinateToLogical(l.x),x=a.coordinateToPrice(l.y);return d===null||x===null?null:{logicalIndex:d,price:x}}catch{return null}},[]),Q=r.useCallback(l=>{const t=F.current,a=D.current;if(!t||!a)return null;try{const d=t.timeScale().logicalToCoordinate(l.logicalIndex),x=a.priceToCoordinate(l.price);return d===null||x===null?null:{x:d,y:x}}catch{return null}},[]);r.useEffect(()=>{if(!c)return;const l=()=>{re(t=>t+1)};return c.timeScale().subscribeVisibleLogicalRangeChange(l),()=>{c.timeScale().unsubscribeVisibleLogicalRangeChange(l)}},[c]);const de=r.useMemo(()=>{if(!y)return null;const l=g.find(d=>d.id===y);if(!l||l.points.length===0)return null;const t=Q(l.points[0]);if(!t)return null;let a=t.x,n=t.y;if(l.type==="horizontal")a=s/2;else if(l.type==="vertical")n=i/2;else if(l.points.length>=2){const d=Q(l.points[1]);d&&(a=(t.x+d.x)/2,n=(t.y+d.y)/2)}return a=Math.max(50,Math.min(s-50,a)),n=Math.max(25,Math.min(i-25,n)),{x:a,y:n}},[y,g,s,i,Q,J]),v=r.useCallback((l,t)=>Math.sqrt((t.x-l.x)**2+(t.y-l.y)**2),[]),he=r.useCallback((l,t,a,n=10)=>{const d=v(t,a);if(d===0)return v(l,t)<n;const x=Math.max(0,Math.min(1,((l.x-t.x)*(a.x-t.x)+(l.y-t.y)*(a.y-t.y))/(d*d))),j={x:t.x+x*(a.x-t.x),y:t.y+x*(a.y-t.y)};return v(l,j)<n},[v]),M=r.useCallback((l,t,a,n="none")=>{if(l.beginPath(),n==="none")l.moveTo(t.x,t.y),l.lineTo(a.x,a.y);else{const d=a.x-t.x,x=a.y-t.y,j=Math.sqrt(d*d+x*x);if(j===0)return;const S=d/j,V=x/j,G=(O,_,H,q)=>{let B=1/0;return H>0&&(B=Math.min(B,(s-O)/H)),H<0&&(B=Math.min(B,-O/H)),q>0&&(B=Math.min(B,(i-_)/q)),q<0&&(B=Math.min(B,-_/q)),{x:O+H*B,y:_+q*B}};if(n==="both"){const O=G(t.x,t.y,-S,-V),_=G(a.x,a.y,S,V);l.moveTo(O.x,O.y),l.lineTo(_.x,_.y)}else{const O=G(a.x,a.y,S,V);l.moveTo(t.x,t.y),l.lineTo(O.x,O.y)}}l.stroke()},[s,i]),I=r.useCallback((l,t,a,n)=>{const d=[0,.236,.382,.5,.618,.786,1],x=["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6","#ef4444"],j=Math.min(t.x,a.x),S=Math.max(t.x,a.x);d.forEach((V,G)=>{const O=t.y+(a.y-t.y)*V;l.strokeStyle=n?"#fff":x[G],l.lineWidth=1.5,l.setLineDash([5,3]),l.beginPath(),l.moveTo(j,O),l.lineTo(S,O),l.stroke(),l.setLineDash([]),l.font="10px sans-serif",l.fillStyle=n?"#fff":x[G],l.fillText(`${(V*100).toFixed(1)}%`,S+5,O+3)})},[]),ge=r.useCallback((l,t,a,n)=>{const d=[0,.382,.5,.618,1],x=["0%","38.2%","50%","61.8%","100%"],j=["#ef4444","#ffc107","#22c55e","#3b82f6","#ef4444"],S=Math.min(t.x,a.x),V=Math.max(t.x,a.x);d.forEach((_,H)=>{const q=t.y+(a.y-t.y)*_;l.strokeStyle=n?"#fff":j[H],l.lineWidth=_===.618?2.5:1.5,l.setLineDash(_===.5?[5,3]:[]),l.beginPath(),l.moveTo(S,q),l.lineTo(V,q),l.stroke(),l.setLineDash([]),l.font=_===.618?"bold 11px sans-serif":"10px sans-serif",l.fillStyle=n?"#fff":j[H],l.fillText(x[H]+(_===.618?" â˜…":""),V+5,q+3)});const G=t.y+(a.y-t.y)*.382,O=t.y+(a.y-t.y)*.618;l.fillStyle=(n?"#ffffff":"#ffc107")+"15",l.fillRect(S,Math.min(G,O),V-S,Math.abs(O-G))},[]),ye=r.useCallback(()=>{const l=C.current;if(!l)return;const t=l.getContext("2d");if(t){t.clearRect(0,0,s,i);for(const a of g){const n=a.points.map(x=>Q(x)).filter(x=>x!==null);if(n.length===0)continue;const d=a.id===y;switch(t.strokeStyle=d?"#ffffff":a.color,t.fillStyle=d?"#ffffff":a.color,t.lineWidth=d?2.5:2,t.setLineDash([]),a.type){case"trendline":n.length>=2&&(M(t,n[0],n[1],"both"),[0,1].forEach(x=>{t.beginPath(),t.arc(n[x].x,n[x].y,d?5:4,0,Math.PI*2),t.fill()}));break;case"segment":n.length>=2&&(M(t,n[0],n[1],"none"),[0,1].forEach(x=>{t.beginPath(),t.arc(n[x].x,n[x].y,d?5:4,0,Math.PI*2),t.fill()}));break;case"ray":n.length>=2&&(M(t,n[0],n[1],"end"),t.beginPath(),t.arc(n[0].x,n[0].y,d?5:4,0,Math.PI*2),t.fill());break;case"horizontal":n.length>=1&&(t.setLineDash([8,4]),t.beginPath(),t.moveTo(0,n[0].y),t.lineTo(s,n[0].y),t.stroke(),t.setLineDash([]));break;case"vertical":n.length>=1&&(t.setLineDash([8,4]),t.beginPath(),t.moveTo(n[0].x,0),t.lineTo(n[0].x,i),t.stroke(),t.setLineDash([]));break;case"parallel":if(n.length>=3){M(t,n[0],n[1],"both");const x=n[1].x-n[0].x,j=n[1].y-n[0].y,S=n[2];M(t,{x:S.x-x,y:S.y-j},{x:S.x+x,y:S.y+j},"both"),t.fillStyle=(d?"#ffffff":a.color)+"15",t.beginPath(),t.moveTo(n[0].x,n[0].y),t.lineTo(n[1].x,n[1].y),t.lineTo(S.x+x,S.y+j),t.lineTo(S.x-x,S.y-j),t.closePath(),t.fill()}break;case"fibonacci":n.length>=2&&I(t,n[0],n[1],d);break;case"golden":n.length>=2&&ge(t,n[0],n[1],d);break;case"rectangle":if(n.length>=2){const x=Math.min(n[0].x,n[1].x),j=Math.min(n[0].y,n[1].y),S=Math.abs(n[1].x-n[0].x),V=Math.abs(n[1].y-n[0].y);t.fillStyle=(d?"#ffffff":a.color)+"20",t.fillRect(x,j,S,V),t.strokeRect(x,j,S,V)}break;case"text":if(n.length>=1&&a.text){t.font="bold 13px sans-serif";const x=t.measureText(a.text);t.fillStyle="#00000080",t.fillRect(n[0].x-2,n[0].y-14,x.width+4,18),t.fillStyle=d?"#ffffff":a.color,t.fillText(a.text,n[0].x,n[0].y)}break}}if(P&&N&&X){t.strokeStyle=U.current,t.fillStyle=U.current,t.lineWidth=2,t.setLineDash([]);const a=oe||N;switch(o){case"trendline":M(t,N,a,"both");break;case"segment":M(t,N,a,"none");break;case"ray":M(t,N,a,"end");break;case"horizontal":t.setLineDash([8,4]),t.beginPath(),t.moveTo(0,a.y),t.lineTo(s,a.y),t.stroke();break;case"vertical":t.setLineDash([8,4]),t.beginPath(),t.moveTo(a.x,0),t.lineTo(a.x,i),t.stroke();break;case"parallel":if(me===0)M(t,N,a,"both");else if(Y){M(t,N,Y,"both");const S=Y.x-N.x,V=Y.y-N.y;M(t,{x:a.x-S,y:a.y-V},{x:a.x+S,y:a.y+V},"both")}break;case"fibonacci":I(t,N,a,!1);break;case"golden":ge(t,N,a,!1);break;case"rectangle":const n=Math.min(N.x,a.x),d=Math.min(N.y,a.y),x=Math.abs(a.x-N.x),j=Math.abs(a.y-N.y);t.fillStyle=U.current+"20",t.fillRect(n,d,x,j),t.strokeRect(n,d,x,j);break}}}},[g,s,i,P,N,oe,Y,o,y,me,X,M,I,ge,Q,J]);r.useEffect(()=>(z.current&&cancelAnimationFrame(z.current),z.current=requestAnimationFrame(ye),()=>{z.current&&cancelAnimationFrame(z.current)}),[ye]);const Me=r.useCallback(l=>{for(let t=g.length-1;t>=0;t--){const a=g[t],n=a.points.map(d=>Q(d)).filter(d=>d!==null);if(n.length!==0)switch(a.type){case"trendline":case"segment":case"ray":if(n.length>=2&&he(l,n[0],n[1],12))return a;break;case"horizontal":if(n.length>=1&&Math.abs(l.y-n[0].y)<12)return a;break;case"vertical":if(n.length>=1&&Math.abs(l.x-n[0].x)<12)return a;break;case"parallel":if(n.length>=3){if(he(l,n[0],n[1],12))return a;const d=n[1].x-n[0].x,x=n[1].y-n[0].y,j=n[2];if(he(l,{x:j.x-d,y:j.y-x},{x:j.x+d,y:j.y+x},12))return a}break;case"rectangle":case"fibonacci":case"golden":if(n.length>=2){const d=Math.min(n[0].x,n[1].x)-5,x=Math.max(n[0].x,n[1].x)+5,j=Math.min(n[0].y,n[1].y)-5,S=Math.max(n[0].y,n[1].y)+5;if(l.x>=d&&l.x<=x&&l.y>=j&&l.y<=S)return a}break;case"text":if(n.length>=1&&a.text){const d=a.text.length*8+10;if(l.x>=n[0].x-5&&l.x<=n[0].x+d&&l.y>=n[0].y-18&&l.y<=n[0].y+5)return a}break}}return null},[g,he,Q]),xe=r.useCallback(l=>{var a;const t=(a=C.current)==null?void 0:a.getBoundingClientRect();return t?{x:l.clientX-t.left,y:l.clientY-t.top}:null},[]),te=r.useCallback(l=>{if(!X)return;const t=xe(l);if(t){if(o==="text"){se({x:t.x,y:t.y,show:!0});return}U.current=je[Math.floor(Math.random()*je.length)],m(!0),ie(t),ce(t),ue(0)}},[X,o,xe]),ze=r.useCallback(l=>{if(!P||!X)return;const t=xe(l);t&&ce(t)},[P,X,xe]),Le=r.useCallback(()=>{if(!P||!N||!X)return;const l=oe||N,t=$(N),a=$(l);if(!t||!a){console.warn("åº§æ¨™è½‰æ›å¤±æ•—ï¼Œåœ–è¡¨å¯èƒ½æœªæº–å‚™å¥½"),m(!1),ie(null),ce(null),fe(null),ue(0);return}if(o==="parallel"&&me===0){fe(l),ue(1);return}let n;if(o==="horizontal"||o==="vertical")n=[a];else if(o==="parallel"&&Y){const x=$(Y);if(!x){m(!1),ie(null),ce(null),fe(null),ue(0);return}n=[t,x,a]}else n=[t,a];const d={id:Date.now().toString(),type:o,points:n,color:U.current};k(d),m(!1),ie(null),ce(null),fe(null),ue(0)},[P,X,N,oe,o,Y,me,k,$]),be=r.useCallback(l=>{var d;if(!K)return;const t=(d=h.current)==null?void 0:d.getBoundingClientRect();if(!t)return;const a={x:l.clientX-t.left,y:l.clientY-t.top},n=Me(a);n?(f(n.id),l.stopPropagation(),l.preventDefault()):f(null)},[K,Me,f]),le=r.useCallback(()=>{if(!ne.trim()){se({x:0,y:0,show:!1});return}const l=$({x:Z.x,y:Z.y});if(!l){console.warn("æ–‡å­—åº§æ¨™è½‰æ›å¤±æ•—"),se({x:0,y:0,show:!1}),pe("");return}k({id:Date.now().toString(),type:"text",points:[l],color:je[Math.floor(Math.random()*je.length)],text:ne}),se({x:0,y:0,show:!1}),pe("")},[ne,Z,k,$]),ve=r.useCallback(()=>{y&&(b(y),f(null))},[y,b,f]);return ee?e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{zIndex:10},children:e.jsx("canvas",{ref:C,width:s,height:i,className:"absolute inset-0"})}):e.jsxs("div",{ref:h,className:"absolute inset-0",style:{zIndex:10},children:[X&&e.jsx("canvas",{ref:C,width:s,height:i,className:"absolute inset-0 cursor-crosshair",style:{pointerEvents:"auto"},onMouseDown:te,onMouseMove:ze,onMouseUp:Le,onMouseLeave:()=>{P&&o!=="parallel"&&Le()}}),K&&e.jsxs(e.Fragment,{children:[e.jsx("canvas",{ref:C,width:s,height:i,className:"absolute inset-0",style:{pointerEvents:"none"}}),e.jsx("div",{className:"absolute inset-0 cursor-pointer",style:{pointerEvents:"auto"},onMouseDown:be})]}),y&&de&&K&&e.jsxs(A,{variant:"destructive",size:"sm",className:"absolute h-7 px-2 text-xs shadow-lg animate-in fade-in zoom-in duration-150",style:{left:de.x-30,top:de.y-14,pointerEvents:"auto",zIndex:20},onClick:l=>{l.stopPropagation(),ve()},children:[e.jsx(ot,{className:"h-3.5 w-3.5 mr-1"}),"åˆªé™¤"]}),Z.show&&e.jsxs("div",{className:"absolute flex items-center gap-1 bg-white dark:bg-gray-800 p-1 rounded shadow-lg border",style:{left:Z.x,top:Z.y,pointerEvents:"auto",zIndex:30},children:[e.jsx(Qe,{value:ne,onChange:l=>pe(l.target.value),onKeyDown:l=>{l.key==="Enter"&&le(),l.key==="Escape"&&se({x:0,y:0,show:!1})},placeholder:"è¼¸å…¥æ¨™è¨»...",className:"h-7 w-40 text-xs",autoFocus:!0}),e.jsx(A,{size:"sm",className:"h-7 px-2",onClick:le,children:"ç¢ºå®š"}),e.jsx(A,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0",onClick:()=>se({x:0,y:0,show:!1}),children:e.jsx(ct,{className:"h-3 w-3"})})]})]})}function Vt(){const[s,i]=r.useState([]),[g,o]=r.useState("off"),[y,k]=r.useState(null),f=r.useCallback(h=>{i(z=>[...z,h])},[]),b=r.useCallback(h=>{i(z=>z.filter(F=>F.id!==h)),k(z=>z===h?null:z)},[]),c=r.useCallback((h,z)=>{i(F=>F.map(D=>D.id===h?{...D,...z}:D))},[]),T=r.useCallback(()=>{i([]),k(null)},[]),C=r.useMemo(()=>s.find(h=>h.id===y)||null,[s,y]);return{drawings:s,activeType:g,setActiveType:o,selectedId:y,setSelectedId:k,selectedDrawing:C,addDrawing:f,deleteDrawing:b,updateDrawing:c,clearDrawings:T}}const He={visibleStartDate:null,visibleEndDate:null,loadedStartDate:"2021-01-01",loadedEndDate:new Date().toISOString().split("T")[0],showMA5:!0,showMA10:!0,showMA20:!0,showMA60:!0,showMA120:!1,showBollinger:!1,showVolume:!0,macdParams:{fast:12,slow:26,signal:9},kdParams:{k:9,d:3,smooth:3},rsiParams:{period:14},bollingerParams:{period:20,std:2},zoomLevel:1,currentSymbol:null},Ot=nt()(rt(s=>({...He,setVisibleRange:(i,g)=>s({visibleStartDate:i,visibleEndDate:g}),setLoadedRange:(i,g)=>s({loadedStartDate:i,loadedEndDate:g}),toggleIndicator:i=>s(g=>({[i]:!g[i]})),setZoomLevel:i=>s({zoomLevel:i}),setCurrentSymbol:i=>s({currentSymbol:i}),setMacdParams:i=>s({macdParams:i}),setKdParams:i=>s({kdParams:i}),setRsiParams:i=>s({rsiParams:i}),setBollingerParams:i=>s({bollingerParams:i}),resetSettings:()=>s(He)}),{name:"chart-settings",partialize:s=>({showMA5:s.showMA5,showMA10:s.showMA10,showMA20:s.showMA20,showMA60:s.showMA60,showMA120:s.showMA120,showBollinger:s.showBollinger,showVolume:s.showVolume,macdParams:s.macdParams,kdParams:s.kdParams,rsiParams:s.rsiParams,bollingerParams:s.bollingerParams})})),It=[{label:"1M",days:22,key:"1m"},{label:"3M",days:66,key:"3m"},{label:"6M",days:132,key:"6m"},{label:"1Y",days:252,key:"1y"},{label:"3Y",days:756,key:"3y"},{label:"5Y",days:1260,key:"5y"},{label:"å…¨éƒ¨",days:0,key:"all"}],Wt={main:400,volume:120,indicator:200},$t=r.forwardRef(({data:s,symbol:i,showBollinger:g=!1,isLoading:o=!1,chartHeights:y=Wt,onLoadMore:k,onRangeChange:f,onCrosshairMove:b,onChartClick:c},T)=>{var j,S,V,G,O,_,H,q,B,Oe,Ie,We,Ae,Fe,_e;const[C,h]=r.useState(null),[z,F]=r.useState("macd"),[D,P]=r.useState("3m"),[m,N]=r.useState(null),{drawings:ie,activeType:oe,setActiveType:ce,selectedId:Y,setSelectedId:fe,addDrawing:me,deleteDrawing:ue}=Vt(),[Z,se]=r.useState({width:0,height:0}),ne=r.useRef(null);r.useEffect(()=>{if(!ne.current)return;const u=new ResizeObserver(p=>{const w=p[0];w&&se({width:w.contentRect.width,height:w.contentRect.height})});return u.observe(ne.current),()=>u.disconnect()},[]);const pe=r.useCallback(u=>{N(u),b&&b(u)},[b]),{showMA5:U,showMA10:J,showMA20:re,showMA60:ee,showMA120:K,showBollinger:X,toggleIndicator:$,setVisibleRange:Q}=Ot(),de=g||X,v=r.useRef(null),he=r.useRef(null),M=r.useRef(null),I=r.useRef(null),ge=r.useRef(null),[ye,Me]=r.useState({chart:null,series:null});r.useImperativeHandle(T,()=>({captureCharts:async u=>{const p=[v.current,M.current,I.current];let w=null;if(u&&v.current&&s.length>0){const R=s.findIndex(E=>E.date===u);if(R>=0){const E=v.current.timeScale().getVisibleLogicalRange();E&&(w={from:E.from,to:E.to});const et=w?w.to-w.from:60,tt=Math.max(0,R-et+5),st=R;p.forEach(De=>{De&&De.timeScale().setVisibleLogicalRange({from:tt,to:st})}),await new Promise(De=>setTimeout(De,150))}}const L=R=>R?R.takeScreenshot().toDataURL("image/png"):null,W={main:L(v.current)||"",volume:L(M.current)||"",indicator:L(I.current)||""};return w&&(await new Promise(R=>setTimeout(R,50)),p.forEach(R=>{R&&R.timeScale().setVisibleLogicalRange(w)})),W}}));const xe=r.useMemo(()=>({ma5:U,ma10:J,ma20:re,ma60:ee,ma120:K}),[U,J,re,ee,K]),te=r.useCallback((u,p)=>{const w=u.timeScale(),L=W=>{W&&p.forEach(R=>{R&&R.timeScale().setVisibleLogicalRange(W)})};return w.subscribeVisibleLogicalRangeChange(L),()=>{w.unsubscribeVisibleLogicalRangeChange(L)}},[]),ze=r.useCallback((u,p)=>{v.current=u,he.current=p,Me({chart:u,series:p}),u.timeScale().subscribeVisibleLogicalRangeChange(w=>{if(!w||!s.length)return;const L=Math.max(0,Math.floor(w.from)),W=Math.min(s.length-1,Math.ceil(w.to));if(s[L]&&s[W]){const R=s[L].date,E=s[W].date;h({from:R,to:E}),Q(R,E),f&&f(R,E)}}),M.current&&te(u,[M.current]),I.current&&te(u,[I.current])},[s,te,Q,f]),Le=r.useCallback(u=>{if(M.current=u,v.current){te(u,[v.current]);const p=v.current.timeScale().getVisibleLogicalRange();p&&u.timeScale().setVisibleLogicalRange(p)}},[te]),be=r.useCallback(u=>{if(I.current=u,v.current){te(u,[v.current]);const p=v.current.timeScale().getVisibleLogicalRange();p&&u.timeScale().setVisibleLogicalRange(p)}},[te]),le=r.useCallback((u,p)=>{if(!v.current||!s.length)return;P(p);const w=s.length-1,L=u===0?0:Math.max(0,w-u);[v.current,M.current,I.current].forEach(R=>{R&&R.timeScale().setVisibleLogicalRange({from:L,to:w+5})})},[s]),ve=r.useCallback(()=>{le(66,"3m")},[le]),l=r.useCallback(()=>{if(!v.current)return;const u=v.current.timeScale().getVisibleLogicalRange();if(!u)return;const p=(u.from+u.to)/2,w=(u.to-u.from)*.7,L=p-w/2,W=p+w/2;[v.current,M.current,I.current].forEach(E=>{E&&E.timeScale().setVisibleLogicalRange({from:L,to:W})})},[]),t=r.useCallback(()=>{if(!v.current)return;const u=v.current.timeScale().getVisibleLogicalRange();if(!u)return;const p=(u.from+u.to)/2,w=(u.to-u.from)*1.4,L=Math.max(0,p-w/2),W=Math.min(s.length,p+w/2);[v.current,M.current,I.current].forEach(E=>{E&&E.timeScale().setVisibleLogicalRange({from:L,to:W})})},[s.length]),a=r.useCallback(()=>{if(!v.current)return;const u=v.current.timeScale().getVisibleLogicalRange();if(!u)return;const p=u.to-u.from,w=p*.3,L=Math.max(0,u.from-w),W=L+p;[v.current,M.current,I.current].forEach(E=>{E&&E.timeScale().setVisibleLogicalRange({from:L,to:W})})},[]),n=r.useCallback(()=>{if(!v.current)return;const u=v.current.timeScale().getVisibleLogicalRange();if(!u)return;const p=u.to-u.from,w=p*.3,L=Math.min(s.length+5,u.to+w),W=L-p;[v.current,M.current,I.current].forEach(E=>{E&&E.timeScale().setVisibleLogicalRange({from:W,to:L})})},[s.length]),d=r.useCallback(()=>{if(!v.current||!s.length)return;const u=v.current.timeScale().getVisibleLogicalRange();if(!u)return;const p=u.to-u.from,w=s.length+5,L=w-p;[v.current,M.current,I.current].forEach(R=>{R&&R.timeScale().setVisibleLogicalRange({from:L,to:w})})},[s.length]),x=r.useCallback(()=>{if(!v.current||!s.length)return;const u=v.current.timeScale().getVisibleLogicalRange();if(!u)return;const p=u.to-u.from,w=0,L=p;[v.current,M.current,I.current].forEach(R=>{R&&R.timeScale().setVisibleLogicalRange({from:w,to:L})})},[]);return r.useEffect(()=>{const u=p=>{var w;if(!(!((w=ge.current)!=null&&w.contains(document.activeElement))&&document.activeElement!==document.body))switch(p.key){case"ArrowLeft":p.preventDefault(),a();break;case"ArrowRight":p.preventDefault(),n();break;case"+":case"=":p.preventDefault(),l();break;case"-":p.preventDefault(),t();break;case"Home":p.preventDefault(),d();break;case"End":p.preventDefault(),x();break;case"r":case"R":!p.ctrlKey&&!p.metaKey&&(p.preventDefault(),ve());break}};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[a,n,l,t,d,x,ve]),r.useEffect(()=>{if(v.current&&I.current){const u=v.current.timeScale().getVisibleLogicalRange();u&&setTimeout(()=>{var p;(p=I.current)==null||p.timeScale().setVisibleLogicalRange(u)},50)}},[z]),r.useEffect(()=>{s.length>0&&setTimeout(()=>le(66,"3m"),100)},[s.length,le]),!s||s.length===0?e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:o?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-5 w-5 animate-spin"}),"è¼‰å…¥ä¸­..."]}):"ç„¡è³‡æ–™"}):e.jsxs("div",{ref:ge,className:"w-full space-y-2",tabIndex:0,children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 px-2",children:[e.jsx("div",{className:"flex items-center gap-1",children:It.map(u=>e.jsx(A,{variant:D===u.key?"default":"outline",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>le(u.days,u.key),children:u.label},u.key))}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:a,title:"â† å¾€å·¦ç§»å‹•",children:e.jsx(bt,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:n,title:"â†’ å¾€å³ç§»å‹•",children:e.jsx(pt,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:l,title:"+ æ”¾å¤§",children:e.jsx(yt,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:t,title:"- ç¸®å°",children:e.jsx(vt,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:d,title:"Home: è·³åˆ°æœ€æ–°",children:e.jsx(wt,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:ve,title:"R: é‡ç½®",children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(Et,{activeType:oe,onTypeChange:ce,drawingCount:ie.length})]}),C&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground bg-muted px-2 py-1 rounded",children:[e.jsx(Rt,{className:"h-3 w-3"}),e.jsxs("span",{children:[C.from," ~ ",C.to]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs px-2",children:[e.jsxs("span",{children:[e.jsx("span",{className:"inline-block w-3 h-3 mr-1",style:{backgroundColor:"#ef5350"}})," ä¸Šæ¼²"]}),e.jsxs("span",{children:[e.jsx("span",{className:"inline-block w-3 h-3 mr-1",style:{backgroundColor:"#26a69a"}})," ä¸‹è·Œ"]}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(A,{variant:U?"default":"ghost",size:"sm",className:"h-5 px-1.5 text-xs",style:{backgroundColor:U?"#ffc107":void 0,color:U?"black":"#ffc107"},onClick:()=>$("showMA5"),children:"MA5"}),U&&((m==null?void 0:m.ma5)??((j=s[s.length-1])==null?void 0:j.ma5))&&e.jsx("span",{className:"font-mono",style:{color:"#ffc107"},children:(V=(m==null?void 0:m.ma5)??((S=s[s.length-1])==null?void 0:S.ma5))==null?void 0:V.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(A,{variant:J?"default":"ghost",size:"sm",className:"h-5 px-1.5 text-xs",style:{backgroundColor:J?"#9c27b0":void 0,color:J?"white":"#9c27b0"},onClick:()=>$("showMA10"),children:"MA10"}),J&&((m==null?void 0:m.ma10)??((G=s[s.length-1])==null?void 0:G.ma10))&&e.jsx("span",{className:"font-mono",style:{color:"#9c27b0"},children:(_=(m==null?void 0:m.ma10)??((O=s[s.length-1])==null?void 0:O.ma10))==null?void 0:_.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(A,{variant:re?"default":"ghost",size:"sm",className:"h-5 px-1.5 text-xs",style:{backgroundColor:re?"#2196f3":void 0,color:re?"white":"#2196f3"},onClick:()=>$("showMA20"),children:"MA20"}),re&&((m==null?void 0:m.ma20)??((H=s[s.length-1])==null?void 0:H.ma20))&&e.jsx("span",{className:"font-mono",style:{color:"#2196f3"},children:(B=(m==null?void 0:m.ma20)??((q=s[s.length-1])==null?void 0:q.ma20))==null?void 0:B.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(A,{variant:ee?"default":"ghost",size:"sm",className:"h-5 px-1.5 text-xs",style:{backgroundColor:ee?"#ff9800":void 0,color:ee?"black":"#ff9800"},onClick:()=>$("showMA60"),children:"MA60"}),ee&&((m==null?void 0:m.ma60)??((Oe=s[s.length-1])==null?void 0:Oe.ma60))&&e.jsx("span",{className:"font-mono",style:{color:"#ff9800"},children:(We=(m==null?void 0:m.ma60)??((Ie=s[s.length-1])==null?void 0:Ie.ma60))==null?void 0:We.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(A,{variant:K?"default":"ghost",size:"sm",className:"h-5 px-1.5 text-xs",style:{backgroundColor:K?"#9e9e9e":void 0,color:K?"black":"#9e9e9e"},onClick:()=>$("showMA120"),children:"MA120"}),K&&((m==null?void 0:m.ma120)??((Ae=s[s.length-1])==null?void 0:Ae.ma120))&&e.jsx("span",{className:"font-mono",style:{color:"#9e9e9e"},children:(_e=(m==null?void 0:m.ma120)??((Fe=s[s.length-1])==null?void 0:Fe.ma120))==null?void 0:_e.toFixed(2)})]}),de&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#e91e63"},children:"- -"})," å¸ƒæ—ä¸Šè»Œ"]}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#4caf50"},children:"- -"})," å¸ƒæ—ä¸‹è»Œ"]})]})]}),e.jsxs("div",{ref:ne,className:"border rounded-lg overflow-hidden relative transition-all duration-300 ease-in-out",style:{height:y.main},children:[o&&e.jsx("div",{className:"absolute inset-0 bg-background/50 flex items-center justify-center z-10",children:e.jsx(Ue,{className:"h-6 w-6 animate-spin"})}),e.jsx(Mt,{data:s,height:y.main,showBollinger:de,visibleMAs:xe,onChartReady:ze,onCrosshairMove:pe,onChartClick:c}),Z.width>0&&e.jsx(Pt,{width:Z.width,height:Z.height,drawings:ie,activeType:oe,selectedId:Y,onAddDrawing:me,onSelectDrawing:fe,onDeleteDrawing:ue,chart:ye.chart,mainSeries:ye.series})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden transition-all duration-300 ease-in-out",style:{height:y.volume+28},children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 text-xs text-muted-foreground border-b",children:[e.jsx("span",{children:"æˆäº¤é‡"}),e.jsxs("span",{className:"ml-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"})," ä¸Šæ¼²",e.jsx("span",{className:"text-green-500 ml-2",children:"â—"})," ä¸‹è·Œ",e.jsx("span",{className:"ml-2",style:{color:"#ff9800"},children:"- -"})," 5æ—¥å‡é‡"]})]}),e.jsx(Tt,{data:s,height:y.volume,onChartReady:Le})]}),e.jsxs(Nt,{value:z,onValueChange:F,className:"w-full",children:[e.jsxs(Je,{className:"grid w-full grid-cols-4",children:[e.jsxs(Re,{value:"macd",className:"flex items-center gap-1",children:[e.jsx(kt,{className:"h-3 w-3"}),"MACD"]}),e.jsxs(Re,{value:"kd",className:"flex items-center gap-1",children:[e.jsx(St,{className:"h-3 w-3"}),"KD"]}),e.jsxs(Re,{value:"rsi",className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),"RSI"]}),e.jsx(Re,{value:"all",children:"å…¨éƒ¨"})]}),e.jsx(ke,{value:"macd",className:"border rounded-lg overflow-hidden mt-2",children:e.jsx(Ke,{data:s,height:y.indicator,onChartReady:be})}),e.jsx(ke,{value:"kd",className:"border rounded-lg overflow-hidden mt-2",children:e.jsx($e,{data:s,height:y.indicator,onChartReady:be})}),e.jsx(ke,{value:"rsi",className:"border rounded-lg overflow-hidden mt-2",children:e.jsx(Ge,{data:s,height:y.indicator,onChartReady:be})}),e.jsxs(ke,{value:"all",className:"space-y-2 mt-2",children:[e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx(Ke,{data:s,height:150,onChartReady:be})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx($e,{data:s,height:150})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx(Ge,{data:s,height:140})})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"ğŸ’¡ æ‹–æ›³ç§»å‹• | æ»¾è¼ªç¸®æ”¾ | â†â†’ æ–¹å‘éµç§»å‹• | +/- ç¸®æ”¾ | Home è·³åˆ°æœ€æ–° | R é‡ç½®"})]})});export{Qe as I,Mt as L,$t as a};
