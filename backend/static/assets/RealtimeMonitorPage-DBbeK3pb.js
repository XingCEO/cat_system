import{u as L,j as e,i as H}from"./vendor-data-CkOiUkF9.js";import{a as j,L as K}from"./vendor-react-CiXd1m8D.js";import{C as m,a as d,b as h,c as u}from"./card-BInHG3Zt.js";import{B as N}from"./index-CN1IIGNT.js";import{I as W}from"./input-C5aoutXU.js";import{L as Q}from"./label-D66ahaKK.js";import{f as w,g as R,a as G,b as J}from"./format-CUqWL-d1.js";import{j as V,Z as X,aa as Y,ab as ee,R as _,u as te,m as se,e as ae,a8 as re}from"./vendor-utils-3hQanHZm.js";import"./vendor-radix-aGPdNwig.js";const P=H.create({baseURL:"",timeout:3e4});async function ne(l=50){const{data:o}=await P.get(`/realtime/top-turnover?limit=${l}`);return o}async function le(){const{data:l}=await P.get("/realtime/status");return l}function T(){const l=new Date,o=l.getHours(),x=l.getMinutes();return o===9&&x>=0||o>=10&&o<13||o===13&&x<=30}function fe(){const[l,o]=j.useState(50),[x,O]=j.useState(!0),[b,U]=j.useState(T()),C=15;j.useEffect(()=>{const t=setInterval(()=>{U(T())},6e4);return()=>clearInterval(t)},[]);const{data:c,isLoading:A,error:S,refetch:M,isFetching:y}=L({queryKey:["realtimeTopTurnover",l],queryFn:()=>ne(l),refetchInterval:x?C*1e3:!1,staleTime:1e4});L({queryKey:["realtimeStatus"],queryFn:le,refetchInterval:6e4});const $=j.useCallback(()=>{M()},[M]),i=(c==null?void 0:c.items)||[],k=(c==null?void 0:c.update_time)||"-",q=(c==null?void 0:c.sources)||{},g={total:i.length,up:i.filter(t=>(t.realtime_change_pct??t.change_percent??0)>0).length,down:i.filter(t=>(t.realtime_change_pct??t.change_percent??0)<0).length,limitUp:i.filter(t=>(t.realtime_change_pct??t.change_percent??0)>=9.5).length};return e.jsxs("div",{className:"container mx-auto py-6 px-4 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(N,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx(K,{to:"/",children:e.jsx(V,{className:"w-5 h-5"})})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(X,{className:"w-7 h-7 text-yellow-500"}),"盤中即時監控"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["週轉率前 ",l," 名即時報價（延遲約 10-30 秒）"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium ${b?"bg-green-500/10 text-green-600":"bg-gray-500/10 text-gray-500"}`,children:[b?e.jsx(Y,{className:"w-4 h-4"}):e.jsx(ee,{className:"w-4 h-4"}),b?"盤中":"收盤"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"text-xs",children:"監控數量"}),e.jsx(W,{type:"number",min:10,max:200,step:10,value:l,onChange:t=>o(Number(t.target.value)),className:"w-20 h-8"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(N,{variant:x?"default":"outline",size:"sm",onClick:()=>O(!x),className:"gap-1",children:[e.jsx(_,{className:`w-4 h-4 ${x&&y?"animate-spin":""}`}),x?`${C}秒`:"已暫停"]})}),e.jsxs(N,{variant:"outline",size:"sm",onClick:$,disabled:y,children:[e.jsx(_,{className:`w-4 h-4 mr-1 ${y?"animate-spin":""}`}),"刷新"]})]})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-2 md:grid-cols-5",children:[e.jsxs(m,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-muted-foreground",children:"更新時間"})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center gap-1 text-lg font-semibold",children:[e.jsx(te,{className:"w-4 h-4 text-muted-foreground"}),k.split(" ")[1]||k]})})]}),e.jsxs(m,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-muted-foreground",children:"監控中"})}),e.jsx(u,{children:e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[g.total," ",e.jsx("span",{className:"text-base font-normal text-muted-foreground",children:"檔"})]})})]}),e.jsxs(m,{className:"border-l-4 border-l-red-500",children:[e.jsx(d,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-red-500",children:"上漲"})}),e.jsx(u,{children:e.jsxs("div",{className:"text-2xl font-bold text-red-500",children:[g.up," ",e.jsx("span",{className:"text-base font-normal opacity-70",children:"檔"})]})})]}),e.jsxs(m,{className:"border-l-4 border-l-green-500",children:[e.jsx(d,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-green-600",children:"下跌"})}),e.jsx(u,{children:e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[g.down," ",e.jsx("span",{className:"text-base font-normal opacity-70",children:"檔"})]})})]}),e.jsxs(m,{className:"border-l-4 border-l-orange-500",children:[e.jsx(d,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-orange-500",children:"漲停"})}),e.jsx(u,{children:e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[g.limitUp," ",e.jsx("span",{className:"text-base font-normal opacity-70",children:"檔"})]})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsx("span",{children:"資料來源："}),Object.entries(q).map(([t,n])=>e.jsxs("div",{className:`flex items-center gap-1 ${n.is_healthy?"text-green-600":"text-red-500"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.is_healthy?"bg-green-500":"bg-red-500"}`}),n.name]},t))]}),i.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(m,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(h,{className:"text-base",children:"產業分佈"})}),e.jsx(u,{children:e.jsx("div",{className:"h-48",children:(()=>{const t={};i.forEach(a=>{const r=a.industry||"其他";t[r]=(t[r]||0)+1});const n=Object.entries(t).sort((a,r)=>r[1]-a[1]).slice(0,8),f=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#ec4899","#84cc16"],s=n.reduce((a,[,r])=>a+r,0);return e.jsxs("div",{className:"flex items-center h-full",children:[e.jsx("svg",{viewBox:"0 0 100 100",className:"w-32 h-32",children:(()=>{let a=0;return n.map(([,r],p)=>{const I=r/s*360,v=a+I,B=I>180?1:0,E=50+40*Math.cos((a-90)*Math.PI/180),F=50+40*Math.sin((a-90)*Math.PI/180),z=50+40*Math.cos((v-90)*Math.PI/180),D=50+40*Math.sin((v-90)*Math.PI/180),Z=`M 50 50 L ${E} ${F} A 40 40 0 ${B} 1 ${z} ${D} Z`;return a=v,e.jsx("path",{d:Z,fill:f[p],opacity:.85},p)})})()}),e.jsx("div",{className:"ml-4 text-xs space-y-1 flex-1",children:n.map(([a,r],p)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:f[p]}}),e.jsx("span",{className:"truncate flex-1",children:a}),e.jsx("span",{className:"font-mono text-muted-foreground",children:r})]},a))})]})})()})})]}),e.jsxs(m,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(h,{className:"text-base",children:"漲跌分佈"})}),e.jsx(u,{children:e.jsx("div",{className:"h-48",children:(()=>{const n=[{label:"漲停",min:9.5,max:100,color:"#ef4444"},{label:"5-9%",min:5,max:9.5,color:"#f97316"},{label:"3-5%",min:3,max:5,color:"#fb923c"},{label:"1-3%",min:1,max:3,color:"#fbbf24"},{label:"0-1%",min:0,max:1,color:"#a3a3a3"},{label:"0-(-1)%",min:-1,max:0,color:"#a3a3a3"},{label:"(-1)-(-3)%",min:-3,max:-1,color:"#4ade80"},{label:"<-3%",min:-100,max:-3,color:"#22c55e"}].map(s=>({...s,count:i.filter(a=>{const r=a.realtime_change_pct??a.change_percent??0;return r>=s.min&&r<s.max}).length})),f=Math.max(...n.map(s=>s.count),1);return e.jsx("div",{className:"flex items-end justify-around h-full gap-1 pb-6",children:n.map((s,a)=>e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("span",{className:"text-xs font-mono mb-1",children:s.count||""}),e.jsx("div",{className:"w-full rounded-t transition-all",style:{height:`${Math.max(s.count/f*120,s.count>0?8:0)}px`,backgroundColor:s.color}}),e.jsx("span",{className:"text-[10px] text-muted-foreground mt-1 text-center leading-tight",children:s.label})]},a))})})()})})]})]}),e.jsxs(m,{children:[e.jsx(d,{className:"pb-3",children:e.jsxs(h,{className:"text-lg flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-primary"}),"即時報價"]})}),e.jsx(u,{className:"p-0",children:A?e.jsxs("div",{className:"py-20 text-center text-muted-foreground",children:[e.jsx(_,{className:"w-8 h-8 mx-auto mb-3 animate-spin text-primary"}),e.jsx("p",{children:"載入中..."})]}):S?e.jsxs("div",{className:"py-20 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-red-500",children:"載入失敗"}),e.jsx(N,{variant:"outline",onClick:$,className:"mt-3",children:"重試"})]}):i.length===0?e.jsx("div",{className:"py-20 text-center text-muted-foreground",children:e.jsx("p",{children:"無資料"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/50 border-b sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground",children:"排名"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground",children:"代號"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground",children:"名稱"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground",children:"產業"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"即時價"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"漲跌%"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"周轉率"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"成交量"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"最高"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"最低"})]})}),e.jsx("tbody",{className:"divide-y divide-border/50",children:i.map((t,n)=>{var p;const f=t.realtime_price??t.close_price,s=t.realtime_change_pct??t.change_percent,a=(s??0)>0,r=(s??0)>=9.5;return e.jsxs("tr",{className:`hover:bg-muted/30 transition-colors ${r?"bg-orange-500/5":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center justify-center w-7 h-7 rounded-full text-xs font-semibold ${(t.turnover_rank??n+1)<=10?"bg-amber-500 text-white":"bg-muted text-muted-foreground"}`,children:t.turnover_rank??n+1})}),e.jsx("td",{className:"px-4 py-3 font-mono font-medium text-primary",children:t.symbol}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("span",{className:"font-medium",children:t.name}),r&&e.jsx("span",{className:"ml-1.5 px-1.5 py-0.5 rounded text-xs bg-orange-500/10 text-orange-500",children:"漲停"})]}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-xs",children:t.industry||"-"}),e.jsx("td",{className:`px-4 py-3 text-right font-mono font-bold tabular-nums ${R(s)}`,children:w(f)}),e.jsx("td",{className:`px-4 py-3 text-right font-mono font-semibold tabular-nums ${R(s)}`,children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[a?e.jsx(ae,{className:"w-3 h-3"}):s!==0?e.jsx(re,{className:"w-3 h-3"}):null,G(s)]})}),e.jsxs("td",{className:"px-4 py-3 text-right font-mono font-semibold tabular-nums text-sky-500",children:[((p=t.turnover_rate)==null?void 0:p.toFixed(1))||"-","%"]}),e.jsx("td",{className:"px-4 py-3 text-right font-mono tabular-nums text-muted-foreground",children:J(t.realtime_volume??0)}),e.jsx("td",{className:"px-4 py-3 text-right font-mono tabular-nums text-red-500",children:w(t.realtime_high)}),e.jsx("td",{className:"px-4 py-3 text-right font-mono tabular-nums text-green-600",children:w(t.realtime_low)})]},t.symbol)})})]})})})]})]})}export{fe as RealtimeMonitorPage,fe as default};
