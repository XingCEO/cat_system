import{u as L,j as e,i as S}from"./vendor-data-BYhqPCcD.js";import{r as j,L as z}from"./vendor-react-CfDhA8Yr.js";import{C as i,a as x,b as c,c as o}from"./card-BKnyINDp.js";import{B as p}from"./index-xpQrH_iz.js";import{I as O,f as N,g as R,a as D,b as E}from"./format-B0kU3Ifh.js";import{L as H}from"./label-DfyEqqfc.js";import{C as K,Z as W,a2 as Z,a3 as A,_ as b,n as Q,B as G,T as J,$ as V}from"./vendor-utils-E_de3sau.js";import"./vendor-radix-BeDz-D1T.js";const U=S.create({baseURL:"",timeout:3e4});async function X(a=50){const{data:u}=await U.get(`/realtime/top-turnover?limit=${a}`);return u}async function Y(){const{data:a}=await U.get("/realtime/status");return a}function xe(){const[a,u]=j.useState(50),[d,B]=j.useState(!0),y=15,{data:s,isLoading:I,error:q,refetch:v,isFetching:f}=L({queryKey:["realtimeTopTurnover",a],queryFn:()=>X(a),refetchInterval:d?y*1e3:!1,staleTime:1e4});L({queryKey:["realtimeStatus"],queryFn:Y,refetchInterval:6e4});const w=j.useCallback(()=>{v()},[v]),r=(s==null?void 0:s.items)||[],_=(s==null?void 0:s.update_time)||"-",F=(s==null?void 0:s.sources)||{},m={total:r.length,up:r.filter(t=>(t.realtime_change_pct??t.change_percent??0)>0).length,down:r.filter(t=>(t.realtime_change_pct??t.change_percent??0)<0).length,limitUp:r.filter(t=>(t.realtime_change_pct??t.change_percent??0)>=9.5).length},C=new Date,h=C.getHours(),$=C.getMinutes(),g=h===9&&$>=0||h>=10&&h<13||h===13&&$<=30;return e.jsxs("div",{className:"container mx-auto py-6 px-4 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx(z,{to:"/",children:e.jsx(K,{className:"w-5 h-5"})})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(W,{className:"w-7 h-7 text-yellow-500"}),"盤中即時監控"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["週轉率前 ",a," 名即時報價（延遲約 10-30 秒）"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium ${g?"bg-green-500/10 text-green-600":"bg-gray-500/10 text-gray-500"}`,children:[g?e.jsx(Z,{className:"w-4 h-4"}):e.jsx(A,{className:"w-4 h-4"}),g?"盤中":"收盤"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"text-xs",children:"監控數量"}),e.jsx(O,{type:"number",min:10,max:200,step:10,value:a,onChange:t=>u(Number(t.target.value)),className:"w-20 h-8"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(p,{variant:d?"default":"outline",size:"sm",onClick:()=>B(!d),className:"gap-1",children:[e.jsx(b,{className:`w-4 h-4 ${d&&f?"animate-spin":""}`}),d?`${y}秒`:"已暫停"]})}),e.jsxs(p,{variant:"outline",size:"sm",onClick:w,disabled:f,children:[e.jsx(b,{className:`w-4 h-4 mr-1 ${f?"animate-spin":""}`}),"刷新"]})]})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-2 md:grid-cols-5",children:[e.jsxs(i,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"更新時間"})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-1 text-lg font-semibold",children:[e.jsx(Q,{className:"w-4 h-4 text-muted-foreground"}),_.split(" ")[1]||_]})})]}),e.jsxs(i,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"監控中"})}),e.jsx(o,{children:e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[m.total," ",e.jsx("span",{className:"text-base font-normal text-muted-foreground",children:"檔"})]})})]}),e.jsxs(i,{className:"border-l-4 border-l-red-500",children:[e.jsx(x,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-red-500",children:"上漲"})}),e.jsx(o,{children:e.jsxs("div",{className:"text-2xl font-bold text-red-500",children:[m.up," ",e.jsx("span",{className:"text-base font-normal opacity-70",children:"檔"})]})})]}),e.jsxs(i,{className:"border-l-4 border-l-green-500",children:[e.jsx(x,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-green-600",children:"下跌"})}),e.jsx(o,{children:e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[m.down," ",e.jsx("span",{className:"text-base font-normal opacity-70",children:"檔"})]})})]}),e.jsxs(i,{className:"border-l-4 border-l-orange-500",children:[e.jsx(x,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-orange-500",children:"漲停"})}),e.jsx(o,{children:e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[m.limitUp," ",e.jsx("span",{className:"text-base font-normal opacity-70",children:"檔"})]})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsx("span",{children:"資料來源："}),Object.entries(F).map(([t,n])=>e.jsxs("div",{className:`flex items-center gap-1 ${n.is_healthy?"text-green-600":"text-red-500"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.is_healthy?"bg-green-500":"bg-red-500"}`}),n.name]},t))]}),e.jsxs(i,{children:[e.jsx(x,{className:"pb-3",children:e.jsxs(c,{className:"text-lg flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-primary"}),"即時報價"]})}),e.jsx(o,{className:"p-0",children:I?e.jsxs("div",{className:"py-20 text-center text-muted-foreground",children:[e.jsx(b,{className:"w-8 h-8 mx-auto mb-3 animate-spin text-primary"}),e.jsx("p",{children:"載入中..."})]}):q?e.jsxs("div",{className:"py-20 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-red-500",children:"載入失敗"}),e.jsx(p,{variant:"outline",onClick:w,className:"mt-3",children:"重試"})]}):r.length===0?e.jsx("div",{className:"py-20 text-center text-muted-foreground",children:e.jsx("p",{children:"無資料"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/50 border-b sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground",children:"排名"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground",children:"代號"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground",children:"名稱"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground",children:"產業"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"即時價"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"漲跌%"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"周轉率"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"成交量"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"最高"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground",children:"最低"})]})}),e.jsx("tbody",{className:"divide-y divide-border/50",children:r.map((t,n)=>{var T;const M=t.realtime_price??t.close_price,l=t.realtime_change_pct??t.change_percent,P=(l??0)>0,k=(l??0)>=9.5;return e.jsxs("tr",{className:`hover:bg-muted/30 transition-colors ${k?"bg-orange-500/5":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center justify-center w-7 h-7 rounded-full text-xs font-semibold ${(t.turnover_rank??n+1)<=10?"bg-amber-500 text-white":"bg-muted text-muted-foreground"}`,children:t.turnover_rank??n+1})}),e.jsx("td",{className:"px-4 py-3 font-mono font-medium text-primary",children:t.symbol}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("span",{className:"font-medium",children:t.name}),k&&e.jsx("span",{className:"ml-1.5 px-1.5 py-0.5 rounded text-xs bg-orange-500/10 text-orange-500",children:"漲停"})]}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-xs",children:t.industry||"-"}),e.jsx("td",{className:`px-4 py-3 text-right font-mono font-bold tabular-nums ${R(l)}`,children:N(M)}),e.jsx("td",{className:`px-4 py-3 text-right font-mono font-semibold tabular-nums ${R(l)}`,children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[P?e.jsx(J,{className:"w-3 h-3"}):l!==0?e.jsx(V,{className:"w-3 h-3"}):null,D(l)]})}),e.jsxs("td",{className:"px-4 py-3 text-right font-mono font-semibold tabular-nums text-sky-500",children:[((T=t.turnover_rate)==null?void 0:T.toFixed(1))||"-","%"]}),e.jsx("td",{className:"px-4 py-3 text-right font-mono tabular-nums text-muted-foreground",children:E(t.realtime_volume??0)}),e.jsx("td",{className:"px-4 py-3 text-right font-mono tabular-nums text-red-500",children:N(t.realtime_high)}),e.jsx("td",{className:"px-4 py-3 text-right font-mono tabular-nums text-green-600",children:N(t.realtime_low)})]},t.symbol)})})]})})})]})]})}export{xe as RealtimeMonitorPage,xe as default};
