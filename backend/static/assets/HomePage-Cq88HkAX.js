import{j as e,u as $}from"./vendor-data-CkOiUkF9.js";import{a as p}from"./vendor-react-CiXd1m8D.js";import{u as E,B as u}from"./index-CN1IIGNT.js";import{I as x}from"./input-C5aoutXU.js";import{L as f}from"./label-D66ahaKK.js";import{C as y,a as C,b as w,c as N}from"./card-BInHG3Zt.js";import{f as R,Z as I,g as B,h as M,D as q,e as H,i as Q,j as V,k as W,l as U,m as X}from"./vendor-utils-3hQanHZm.js";import{f as Y,a as Z,g as G,b as J}from"./format-CUqWL-d1.js";import{R as F,P as ee,a as se,C as ae,T as z,L as te,B as T,X as K,Y as L,b as O}from"./vendor-charts-2uieviVG.js";import{S as re,g as ne,f as le}from"./StockAnalysisDialog-Bwyn-n6i.js";import"./vendor-radix-aGPdNwig.js";function ie({onSearch:l,isLoading:h,queryDate:o,onDateChange:g}){const{filterParams:a,setFilterParams:t,resetFilterParams:i}=E(),[c,_]=p.useState(!1),m=s=>{switch(s){case"small":t({price_max:50,price_min:void 0});break;case"mid":t({price_min:50,price_max:150});break;case"hot":t({volume_ratio_min:1.5});break;case"strong":t({consecutive_up_min:3});break}};return e.jsxs(y,{className:"mb-6 border-border/50 shadow-sm",children:[e.jsx(C,{className:"pb-4",children:e.jsxs(w,{className:"text-lg flex items-center gap-3 tracking-tight",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(R,{className:"w-5 h-5 text-primary"})}),"篩選條件"]})}),e.jsxs(N,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"查詢日期"}),e.jsx(x,{type:"date",value:o,onChange:s=>g(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"漲幅區間 (%)"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(x,{type:"number",step:"0.1",placeholder:"不限",value:a.change_min===void 0?"":a.change_min,onChange:s=>t({change_min:s.target.value?parseFloat(s.target.value):void 0})}),e.jsx("span",{className:"text-muted-foreground",children:"~"}),e.jsx(x,{type:"number",step:"0.1",placeholder:"不限",value:a.change_max===void 0?"":a.change_max,onChange:s=>t({change_max:s.target.value?parseFloat(s.target.value):void 0})}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"%"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"成交量區間 (張)"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(x,{type:"number",placeholder:"預設 500",value:a.volume_min||"",onChange:s=>t({volume_min:s.target.value?parseInt(s.target.value):void 0})}),e.jsx("span",{className:"text-muted-foreground",children:"~"}),e.jsx(x,{type:"number",placeholder:"無上限",value:a.volume_max||"",onChange:s=>t({volume_max:s.target.value?parseInt(s.target.value):void 0})}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"張"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"股價區間 (元)"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(x,{type:"number",placeholder:"不限",value:a.price_min||"",onChange:s=>t({price_min:s.target.value?parseFloat(s.target.value):void 0})}),e.jsx("span",{className:"text-muted-foreground",children:"~"}),e.jsx(x,{type:"number",placeholder:"不限",value:a.price_max||"",onChange:s=>t({price_max:s.target.value?parseFloat(s.target.value):void 0})}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"元"})]})]})]}),c&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"收盤價高於昨收 (%)"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(x,{type:"number",step:"0.1",placeholder:"最低",value:a.close_above_prev_min??"",onChange:s=>t({close_above_prev_min:s.target.value?parseFloat(s.target.value):void 0})}),e.jsx("span",{children:"~"}),e.jsx(x,{type:"number",step:"0.1",placeholder:"最高",value:a.close_above_prev_max??"",onChange:s=>t({close_above_prev_max:s.target.value?parseFloat(s.target.value):void 0})}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"%"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"連續上漲天數 (最少)"}),e.jsx(x,{type:"number",value:a.consecutive_up_min||"",onChange:s=>t({consecutive_up_min:s.target.value?parseInt(s.target.value):void 0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"振幅區間 (%)"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(x,{type:"number",step:"0.1",placeholder:"最低",value:a.amplitude_min||"",onChange:s=>t({amplitude_min:s.target.value?parseFloat(s.target.value):void 0})}),e.jsx("span",{children:"~"}),e.jsx(x,{type:"number",step:"0.1",placeholder:"最高",value:a.amplitude_max||"",onChange:s=>t({amplitude_max:s.target.value?parseFloat(s.target.value):void 0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"量比 (最少)"}),e.jsx(x,{type:"number",step:"0.1",value:a.volume_ratio_min||"",onChange:s=>t({volume_ratio_min:s.target.value?parseFloat(s.target.value):void 0})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 border-t",children:[e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(I,{className:"w-4 h-4"})," 快速預設："]}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>m("small"),children:"小型股 (<50元)"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>m("mid"),children:"中型股 (50-150元)"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>m("hot"),children:"熱門股 (量比>1.5)"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>m("strong"),children:"強勢股 (連漲≥3天)"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 border-t",children:[e.jsxs(u,{onClick:l,disabled:h,children:[e.jsx(R,{className:"w-4 h-4 mr-2"})," ",h?"搜尋中...":"搜尋"]}),e.jsx(u,{variant:"outline",onClick:()=>_(!c),children:c?"收起進階":"展開進階"}),e.jsxs(u,{variant:"outline",onClick:i,children:[e.jsx(B,{className:"w-4 h-4 mr-2"})," 重置"]}),e.jsxs(u,{variant:"outline",children:[e.jsx(M,{className:"w-4 h-4 mr-2"})," 儲存條件"]}),e.jsx(u,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:`/api/export/csv?date=${o}&change_min=${a.change_min??""}&change_max=${a.change_max??""}&volume_min=${a.volume_min||0}${a.volume_max?`&volume_max=${a.volume_max}`:""}`,target:"_blank",children:[e.jsx(q,{className:"w-4 h-4 mr-2"})," 匯出CSV"]})})]})]})]})}function oe({stocks:l,total:h,page:o,pageSize:g,onPageChange:a,onStockClick:t,isLoading:i}){const[c,_]=p.useState("change_percent"),[m,s]=p.useState("desc"),n=Math.ceil(h/g),S=r=>{c===r?s(m==="asc"?"desc":"asc"):(_(r),s("desc"))},k=p.useMemo(()=>!l||l.length===0?[]:[...l].sort((r,b)=>{const d=r[c],v=b[c];if(d==null&&v==null)return 0;if(d==null)return m==="asc"?-1:1;if(v==null)return m==="asc"?1:-1;if(typeof d=="number"&&typeof v=="number")return m==="asc"?d-v:v-d;const P=String(d),D=String(v);return m==="asc"?P.localeCompare(D,"zh-TW"):D.localeCompare(P,"zh-TW")}),[l,c,m]),j=({field:r,children:b})=>e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wider cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>S(r),children:e.jsxs("div",{className:"flex items-center gap-1",children:[b,e.jsx(U,{className:`w-3 h-3 transition-opacity ${c===r?"opacity-100 text-primary":"opacity-30"}`})]})});return i?e.jsx(y,{children:e.jsx(N,{className:"py-20 text-center text-muted-foreground",children:e.jsx("div",{className:"animate-pulse",children:"載入中..."})})}):l.length===0?e.jsx(y,{children:e.jsx(N,{className:"py-20 text-center text-muted-foreground",children:"查無符合條件的股票"})}):e.jsxs(y,{children:[e.jsx(C,{className:"pb-2",children:e.jsxs(w,{className:"text-lg flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"})," 篩選結果"]}),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["共 ",h," 筆"]})]})}),e.jsxs(N,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 border-y border-border/50",children:e.jsxs("tr",{children:[e.jsx(j,{field:"symbol",children:"代號"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"名稱"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"產業"}),e.jsx(j,{field:"close_price",children:"收盤價"}),e.jsx(j,{field:"change_percent",children:"漲幅"}),e.jsx(j,{field:"volume",children:"成交量"}),e.jsx(j,{field:"consecutive_up_days",children:"連漲"}),e.jsx(j,{field:"amplitude",children:"振幅"}),e.jsx(j,{field:"volume_ratio",children:"量比"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"divide-y divide-border/50",children:k.map((r,b)=>e.jsxs("tr",{className:`hover:bg-primary/5 cursor-pointer transition-colors duration-150 ${b%2===0?"":"bg-muted/30"}`,onClick:()=>t(r),children:[e.jsx("td",{className:"px-3 py-3 font-mono font-medium text-primary",children:r.symbol}),e.jsx("td",{className:"px-3 py-3 font-medium",children:r.name}),e.jsx("td",{className:"px-3 py-3 text-muted-foreground text-xs",children:r.industry||"-"}),e.jsx("td",{className:"px-3 py-3 font-mono",children:Y(r.close_price)}),e.jsx("td",{className:`px-3 py-3 font-mono font-semibold ${G(r.change_percent)}`,children:Z(r.change_percent)}),e.jsx("td",{className:"px-3 py-3 font-mono text-muted-foreground",children:J(r.volume)}),e.jsx("td",{className:"px-3 py-3",children:r.consecutive_up_days&&r.consecutive_up_days>0?e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-500/10 text-emerald-600 dark:text-emerald-400",children:[r.consecutive_up_days,"天"]}):"-"}),e.jsx("td",{className:"px-3 py-3 font-mono text-muted-foreground",children:r.amplitude?`${r.amplitude.toFixed(1)}%`:"-"}),e.jsx("td",{className:"px-3 py-3 font-mono text-muted-foreground",children:r.volume_ratio?r.volume_ratio.toFixed(2):"-"}),e.jsx("td",{className:"px-3 py-3",children:e.jsx(u,{variant:"ghost",size:"sm",className:"hover:bg-primary/10 hover:text-primary",onClick:d=>{d.stopPropagation(),t(r)},children:e.jsx(Q,{className:"w-4 h-4"})})})]},r.symbol))})]})}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["第 ",o," 頁，共 ",n," 頁"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",disabled:o<=1,onClick:()=>a(o-1),children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx(u,{variant:"outline",size:"sm",disabled:o>=n,onClick:()=>a(o+1),children:e.jsx(W,{className:"w-4 h-4"})})]})]})]})]})}const A=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#f97316"];function ce({stocks:l}){const h=p.useMemo(()=>{const a={};return l.forEach(t=>{const i=t.industry||"其他";a[i]=(a[i]||0)+1}),Object.entries(a).map(([t,i])=>({name:t,value:i})).sort((t,i)=>i.value-t.value).slice(0,8)},[l]),o=p.useMemo(()=>{const a=[{range:"0-1%",min:0,max:1,count:0},{range:"1-2%",min:1,max:2,count:0},{range:"2-3%",min:2,max:3,count:0},{range:"3-5%",min:3,max:5,count:0},{range:"5%+",min:5,max:100,count:0}];return l.forEach(t=>{const i=t.change_percent||0;for(const c of a)if(i>=c.min&&i<c.max){c.count++;break}}),a},[l]),g=p.useMemo(()=>{const a={};return l.forEach(t=>{const i=t.consecutive_up_days||0;a[i]=(a[i]||0)+1}),Object.entries(a).map(([t,i])=>({days:`${t}天`,count:i})).slice(0,6)},[l]);return l.length===0?null:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 mb-6",children:[e.jsxs(y,{className:"hover:shadow-lg transition-shadow duration-200",children:[e.jsx(C,{className:"pb-2",children:e.jsxs(w,{className:"text-sm flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-primary"})," 產業分布"]})}),e.jsx(N,{children:e.jsx(F,{width:"100%",height:280,children:e.jsxs(ee,{children:[e.jsx(se,{data:h,dataKey:"value",nameKey:"name",cx:"50%",cy:"45%",outerRadius:55,label:({percent:a})=>`${(a*100).toFixed(0)}%`,labelLine:!1,fontSize:10,children:h.map((a,t)=>e.jsx(ae,{fill:A[t%A.length]},t))}),e.jsx(z,{formatter:(a,t)=>[`${a} 檔`,t],contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(te,{layout:"horizontal",verticalAlign:"bottom",align:"center",wrapperStyle:{fontSize:"10px",paddingTop:"8px"},formatter:a=>a.length>6?a.slice(0,6)+"…":a})]})})})]}),e.jsxs(y,{className:"hover:shadow-lg transition-shadow duration-200",children:[e.jsx(C,{className:"pb-2",children:e.jsx(w,{className:"text-sm",children:"漲幅分布"})}),e.jsx(N,{children:e.jsx(F,{width:"100%",height:220,children:e.jsxs(T,{data:o,margin:{bottom:10},children:[e.jsx(K,{dataKey:"range",tick:{fontSize:12},stroke:"hsl(var(--muted-foreground))"}),e.jsx(L,{tick:{fontSize:12},stroke:"hsl(var(--muted-foreground))"}),e.jsx(z,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(O,{dataKey:"count",fill:"#3b82f6",radius:[4,4,0,0]})]})})})]}),e.jsxs(y,{className:"hover:shadow-lg transition-shadow duration-200",children:[e.jsx(C,{className:"pb-2",children:e.jsx(w,{className:"text-sm",children:"連續上漲天數"})}),e.jsx(N,{children:e.jsx(F,{width:"100%",height:220,children:e.jsxs(T,{data:g,margin:{bottom:10},children:[e.jsx(K,{dataKey:"days",tick:{fontSize:12},stroke:"hsl(var(--muted-foreground))"}),e.jsx(L,{tick:{fontSize:12},stroke:"hsl(var(--muted-foreground))"}),e.jsx(z,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(O,{dataKey:"count",fill:"#10b981",radius:[4,4,0,0]})]})})})]})]})}function ye(){const{filterParams:l,setFilterParams:h,queryDate:o,setQueryDate:g}=E(),[a,t]=p.useState(null),[i,c]=p.useState(!1),_=(d,v)=>{t({symbol:d,name:v}),c(!0)},m=()=>{c(!1),t(null)},{data:s}=$({queryKey:["tradingDate"],queryFn:ne});p.useEffect(()=>{s!=null&&s.latest_trading_day&&!o&&g(s.latest_trading_day)},[s,o,g]);const{data:n,isLoading:S,refetch:k}=$({queryKey:["stocks",l,o],queryFn:()=>le({...l,date:o}),enabled:!!o}),j=()=>{k()},r=d=>{h({page:d})},b=d=>{_(d.symbol,d.name)};return e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"TWSE 漲幅區間篩選器"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[e.jsx("span",{className:"font-mono",children:o||"載入中..."}),s&&!s.is_today_trading&&e.jsx("span",{className:"ml-2 text-xs bg-muted px-2 py-0.5 rounded-full",children:"今日非交易日"})]}),(n==null?void 0:n.warning)&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg text-amber-600 dark:text-amber-400 text-sm flex items-center gap-2",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-amber-500/20 flex items-center justify-center text-xs",children:"!"}),n.warning]}),(n==null?void 0:n.message)&&!n.is_trading_day&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg text-blue-600 dark:text-blue-400 text-sm flex items-center gap-2",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-blue-500/20 flex items-center justify-center text-xs",children:"i"}),n.message]})]}),e.jsx(ie,{onSearch:j,isLoading:S,queryDate:o,onDateChange:g}),n&&n.items.length>0&&e.jsx(ce,{stocks:n.items}),e.jsx(oe,{stocks:(n==null?void 0:n.items)||[],total:(n==null?void 0:n.total)||0,page:l.page,pageSize:l.page_size,onPageChange:r,onStockClick:b,isLoading:S}),e.jsx(re,{open:i,onClose:m,symbol:(a==null?void 0:a.symbol)||null,name:a==null?void 0:a.name})]})}export{ye as HomePage};
