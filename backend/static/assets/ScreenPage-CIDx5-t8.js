import{c as O,j as e}from"./vendor-data-BGC679gK.js";import{r as C}from"./vendor-react-CfDhA8Yr.js";import{s as $}from"./v1Api-Dn2RRHac.js";const g={type:"indicator",field:"close",operator:">",target_type:"value",target_value:0},M=O(t=>({logic:"AND",rules:[{...g}],customFormulas:[],results:[],matchedCount:0,isLoading:!1,error:null,setLogic:s=>t({logic:s}),addRule:()=>t(s=>({rules:[...s.rules,{...g}]})),updateRule:(s,c)=>t(o=>({rules:o.rules.map((n,u)=>u===s?{...n,...c}:n)})),removeRule:s=>t(c=>({rules:c.rules.filter((o,n)=>n!==s)})),addFormula:()=>t(s=>({customFormulas:[...s.customFormulas,{name:"",formula:""}]})),updateFormula:(s,c)=>t(o=>({customFormulas:o.customFormulas.map((n,u)=>u===s?{...n,...c}:n)})),removeFormula:s=>t(c=>({customFormulas:c.customFormulas.filter((o,n)=>n!==s)})),setResults:(s,c)=>t({results:s,matchedCount:c}),setLoading:s=>t({isLoading:s}),setError:s=>t({error:s}),resetRules:()=>t({logic:"AND",rules:[{...g}],customFormulas:[],results:[],matchedCount:0,error:null})})),x=[{label:"æ”¶ç›¤åƒ¹",value:"close",category:"indicator"},{label:"é–‹ç›¤åƒ¹",value:"open",category:"indicator"},{label:"æœ€é«˜åƒ¹",value:"high",category:"indicator"},{label:"æœ€ä½åƒ¹",value:"low",category:"indicator"},{label:"æˆäº¤é‡",value:"volume",category:"indicator"},{label:"MA5",value:"ma5",category:"indicator"},{label:"MA10",value:"ma10",category:"indicator"},{label:"MA20",value:"ma20",category:"indicator"},{label:"MA60",value:"ma60",category:"indicator"},{label:"RSI(14)",value:"rsi14",category:"indicator"},{label:"æ¼²è·Œå¹…%",value:"change_percent",category:"indicator"},{label:"æœ¬ç›Šæ¯”",value:"pe_ratio",category:"fundamental"},{label:"EPS",value:"eps",category:"fundamental"},{label:"å¤–è³‡è²·è³£è¶…",value:"foreign_buy",category:"chip"},{label:"æŠ•ä¿¡è²·è³£è¶…",value:"trust_buy",category:"chip"},{label:"èè³‡é¤˜é¡",value:"margin_balance",category:"chip"}],I=[{label:"å¤§æ–¼ (>)",value:">"},{label:"å°æ–¼ (<)",value:"<"},{label:"ç­‰æ–¼ (=)",value:"="},{label:"å¤§æ–¼ç­‰æ–¼ (>=)",value:">="},{label:"å°æ–¼ç­‰æ–¼ (<=)",value:"<="},{label:"é»ƒé‡‘äº¤å‰ â†‘",value:"CROSS_UP"},{label:"æ­»äº¡äº¤å‰ â†“",value:"CROSS_DOWN"}];function q(){const{logic:t,rules:s,customFormulas:c,results:o,matchedCount:n,isLoading:u,error:l,setLogic:d,addRule:v,updateRule:m,removeRule:h,addFormula:A,updateFormula:j,removeFormula:S,setResults:k,setLoading:p,setError:b,resetRules:L}=M(),[E,w]=C.useState(null),D=C.useCallback(async()=>{p(!0),b(null);try{const a={logic:t,rules:s,custom_formulas:c.filter(i=>i.name&&i.formula)},r=await $(a);k(r.data,r.matched_count)}catch(a){b(a.message||"ç¯©é¸å¤±æ•—")}finally{p(!1)}},[t,s,c]);return e.jsxs("div",{className:"screen-page",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h1",{children:"ğŸ± å–µå–µé¸è‚¡"}),e.jsx("p",{className:"screen-subtitle",children:"å¤šç¶­åº¦æ¢ä»¶ç¯©é¸ â€” æŠ€è¡“é¢ãƒ»åŸºæœ¬é¢ãƒ»ç±Œç¢¼é¢"})]}),e.jsxs("div",{className:"screen-builder",children:[e.jsxs("div",{className:"builder-toolbar",children:[e.jsxs("div",{className:"logic-toggle",children:[e.jsx("button",{className:`logic-btn ${t==="AND"?"active":""}`,onClick:()=>d("AND"),children:"AND (å…¨éƒ¨ç¬¦åˆ)"}),e.jsx("button",{className:`logic-btn ${t==="OR"?"active":""}`,onClick:()=>d("OR"),children:"OR (ä»»ä¸€ç¬¦åˆ)"})]}),e.jsxs("div",{className:"builder-actions",children:[e.jsx("button",{className:"btn btn-outline",onClick:v,children:"ï¼‹ æ–°å¢æ¢ä»¶"}),e.jsx("button",{className:"btn btn-outline",onClick:A,children:"fx è‡ªè¨‚å…¬å¼"}),e.jsx("button",{className:"btn btn-ghost",onClick:L,children:"é‡ç½®"})]})]}),e.jsx("div",{className:"rules-list",children:s.map((a,r)=>e.jsx(P,{rule:a,index:r,onChange:i=>m(r,i),onRemove:()=>h(r)},r))}),c.length>0&&e.jsxs("div",{className:"formulas-section",children:[e.jsx("h3",{children:"è‡ªè¨‚å…¬å¼"}),c.map((a,r)=>e.jsxs("div",{className:"formula-row",children:[e.jsx("input",{className:"formula-name",placeholder:"åç¨± (å¦‚ avg_ma)",value:a.name,onChange:i=>j(r,{name:i.target.value})}),e.jsx("span",{className:"formula-eq",children:"="}),e.jsx("input",{className:"formula-expr",placeholder:"å…¬å¼ (å¦‚ (ma5 + ma10 + ma20) / 3)",value:a.formula,onChange:i=>j(r,{formula:i.target.value})}),e.jsx("button",{className:"btn-icon remove",onClick:()=>S(r),children:"âœ•"})]},r))]}),e.jsx("div",{className:"screen-execute",children:e.jsx("button",{className:"btn btn-primary btn-lg",onClick:D,disabled:u||s.length===0,children:u?"ç¯©é¸ä¸­â€¦":`ğŸ” é–‹å§‹ç¯©é¸ (${s.length} æ¢ä»¶)`})})]}),l&&e.jsx("div",{className:"screen-error",children:l}),o.length>0&&e.jsxs("div",{className:"screen-results",children:[e.jsxs("div",{className:"results-header",children:[e.jsx("h2",{children:"ç¯©é¸çµæœ"}),e.jsxs("span",{className:"results-count",children:["å…± ",n," æ”¯ç¬¦åˆ"]})]}),e.jsx("div",{className:"results-table-wrap",children:e.jsxs("table",{className:"results-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ä»£è™Ÿ"}),e.jsx("th",{children:"åç¨±"}),e.jsx("th",{children:"æ”¶ç›¤åƒ¹"}),e.jsx("th",{children:"æ¼²è·Œ%"}),e.jsx("th",{children:"æˆäº¤é‡"}),e.jsx("th",{children:"MA5"}),e.jsx("th",{children:"MA20"}),e.jsx("th",{children:"RSI"}),e.jsx("th",{children:"æœ¬ç›Šæ¯”"}),e.jsx("th",{children:"å¤–è³‡"}),e.jsx("th",{children:"æŠ•ä¿¡"}),e.jsx("th",{children:"ç”¢æ¥­"})]})}),e.jsx("tbody",{children:o.map(a=>{var r,i,N,y,_,f,F,R;return e.jsxs("tr",{className:E===a.ticker_id?"selected":"",onClick:()=>w(a.ticker_id),children:[e.jsx("td",{className:"ticker-id",children:a.ticker_id}),e.jsx("td",{children:a.name}),e.jsx("td",{className:"num",children:((r=a.close)==null?void 0:r.toFixed(2))??"-"}),e.jsx("td",{className:`num ${(a.change_percent??0)>=0?"up":"down"}`,children:a.change_percent!=null?`${a.change_percent>=0?"+":""}${a.change_percent.toFixed(2)}%`:"-"}),e.jsx("td",{className:"num",children:((i=a.volume)==null?void 0:i.toLocaleString())??"-"}),e.jsx("td",{className:"num",children:((N=a.ma5)==null?void 0:N.toFixed(2))??"-"}),e.jsx("td",{className:"num",children:((y=a.ma20)==null?void 0:y.toFixed(2))??"-"}),e.jsx("td",{className:"num",children:((_=a.rsi14)==null?void 0:_.toFixed(1))??"-"}),e.jsx("td",{className:"num",children:((f=a.pe_ratio)==null?void 0:f.toFixed(1))??"-"}),e.jsx("td",{className:`num ${(a.foreign_buy??0)>=0?"up":"down"}`,children:((F=a.foreign_buy)==null?void 0:F.toLocaleString())??"-"}),e.jsx("td",{className:`num ${(a.trust_buy??0)>=0?"up":"down"}`,children:((R=a.trust_buy)==null?void 0:R.toLocaleString())??"-"}),e.jsx("td",{children:a.industry??"-"})]},a.ticker_id)})})]})})]})]})}function P({rule:t,index:s,onChange:c,onRemove:o}){var u;const n={indicator:x.filter(l=>l.category==="indicator"),fundamental:x.filter(l=>l.category==="fundamental"),chip:x.filter(l=>l.category==="chip")};return e.jsxs("div",{className:"rule-row",children:[e.jsx("span",{className:"rule-index",children:s+1}),e.jsxs("select",{className:"rule-select",value:t.type,onChange:l=>{var m,h;const d=l.target.value,v=((h=(m=n[d])==null?void 0:m[0])==null?void 0:h.value)??"close";c({type:d,field:v})},children:[e.jsx("option",{value:"indicator",children:"ğŸ“Š æŠ€è¡“é¢"}),e.jsx("option",{value:"fundamental",children:"ğŸ“ˆ åŸºæœ¬é¢"}),e.jsx("option",{value:"chip",children:"ğŸ¦ ç±Œç¢¼é¢"})]}),e.jsx("select",{className:"rule-select",value:t.field,onChange:l=>c({field:l.target.value}),children:(u=n[t.type])==null?void 0:u.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),e.jsx("select",{className:"rule-select operator",value:t.operator,onChange:l=>c({operator:l.target.value}),children:I.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),e.jsxs("select",{className:"rule-select target-type",value:t.target_type,onChange:l=>c({target_type:l.target.value}),children:[e.jsx("option",{value:"value",children:"æ•¸å€¼"}),e.jsx("option",{value:"field",children:"æ¬„ä½"})]}),t.target_type==="value"?e.jsx("input",{className:"rule-input",type:"number",step:"any",value:t.target_value,onChange:l=>c({target_value:parseFloat(l.target.value)||0})}):e.jsx("select",{className:"rule-select",value:t.target_value,onChange:l=>c({target_value:l.target.value}),children:x.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),e.jsx("button",{className:"btn-icon remove",onClick:o,children:"âœ•"})]})}export{q as default};
