import{c as E,j as e}from"./vendor-data-BGC679gK.js";import{r as n}from"./vendor-react-CfDhA8Yr.js";import{l as D,u as A,c as L,d as J,t as O}from"./v1Api-Dn2RRHac.js";const I=E(l=>({strategies:[],isLoading:!1,error:null,setStrategies:s=>l({strategies:s}),addStrategy:s=>l(r=>({strategies:[s,...r.strategies]})),removeStrategy:s=>l(r=>({strategies:r.strategies.filter(c=>c.id!==s)})),updateStrategy:s=>l(r=>({strategies:r.strategies.map(c=>c.id===s.id?s:c)})),setLoading:s=>l({isLoading:s}),setError:s=>l({error:s})}));function T(){const{strategies:l,isLoading:s,error:r,setStrategies:c,addStrategy:y,removeStrategy:f,updateStrategy:j,setLoading:x,setError:h}=I(),[v,m]=n.useState(!1),[g,u]=n.useState(null),[N,p]=n.useState(!1),[t,i]=n.useState({name:"",rules_json:{logic:"AND",rules:[]},alert_enabled:!1});n.useEffect(()=>{(async()=>{x(!0);try{const a=await D();c(a)}catch(a){h(a.message)}finally{x(!1)}})()},[]);const S=n.useCallback(async()=>{try{if(g){const a=await A(g,t);j(a)}else{const a=await L(t);y(a)}m(!1),u(null),i({name:"",rules_json:{logic:"AND",rules:[]},alert_enabled:!1})}catch(a){h(a.message)}},[t,g]),_=n.useCallback(async a=>{if(confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ç­–ç•¥ï¼Ÿ"))try{await J(a),f(a)}catch(d){h(d.message)}},[]),k=n.useCallback(async(a,d)=>{try{const o=await O(a,!d);j(o)}catch(o){h(o.message)}},[]),C=a=>{u(a.id),i({name:a.name,rules_json:a.rules_json,alert_enabled:a.alert_enabled}),m(!0)},w=()=>{u(null),i({name:"",rules_json:{logic:"AND",rules:[]},alert_enabled:!1}),m(!0)};return e.jsxs("div",{className:"strategies-page",children:[e.jsxs("div",{className:"strategies-header",children:[e.jsx("h1",{children:"ğŸ“‹ ç­–ç•¥ç®¡ç†"}),e.jsx("button",{className:"btn btn-primary",onClick:w,children:"ï¼‹ æ–°å¢ç­–ç•¥"})]}),r&&e.jsx("div",{className:"strategies-error",children:r}),s&&e.jsx("div",{className:"strategies-loading",children:"è¼‰å…¥ä¸­â€¦"}),e.jsx("div",{className:"strategy-grid",children:l.map(a=>{var d,o,b;return e.jsxs("div",{className:"strategy-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-name",children:a.name}),e.jsxs("div",{className:"card-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>C(a),title:"ç·¨è¼¯",children:"âœï¸"}),e.jsx("button",{className:"btn-icon remove",onClick:()=>_(a.id),title:"åˆªé™¤",children:"ğŸ—‘ï¸"})]})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"card-rules",children:[e.jsx("span",{className:"card-label",children:"æ¢ä»¶æ•¸"}),e.jsxs("span",{className:"card-value",children:[((o=(d=a.rules_json)==null?void 0:d.rules)==null?void 0:o.length)??0," æ¢ (",((b=a.rules_json)==null?void 0:b.logic)??"AND",")"]})]}),e.jsx("div",{className:"card-updated",children:a.updated_at&&e.jsxs("span",{className:"card-time",children:["æ›´æ–°: ",new Date(a.updated_at).toLocaleDateString("zh-TW")]})})]}),e.jsx("div",{className:"card-footer",children:e.jsxs("label",{className:"alert-toggle",children:[e.jsx("input",{type:"checkbox",checked:a.alert_enabled,onChange:()=>k(a.id,a.alert_enabled)}),e.jsx("span",{className:"toggle-slider"}),e.jsx("span",{className:"toggle-label",children:a.alert_enabled?"ğŸ”” æ¨æ’­å·²é–‹":"ğŸ”• æ¨æ’­é—œé–‰"})]})})]},a.id)})}),!s&&l.length===0&&e.jsxs("div",{className:"strategies-empty",children:[e.jsx("span",{className:"empty-icon",children:"ğŸ“­"}),e.jsx("p",{children:"å°šç„¡å„²å­˜çš„ç­–ç•¥"}),e.jsx("p",{children:"å»ºç«‹æ‚¨çš„ç¬¬ä¸€å€‹ç¯©é¸ç­–ç•¥å§ï¼"})]}),v&&e.jsx("div",{className:"modal-overlay",onClick:()=>m(!1),children:e.jsxs("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[e.jsx("h2",{children:g?"ç·¨è¼¯ç­–ç•¥":"æ–°å¢ç­–ç•¥"}),e.jsxs("div",{className:"modal-form",children:[e.jsx("label",{children:"ç­–ç•¥åç¨±"}),e.jsx("input",{className:"modal-input",placeholder:"ä¾‹: å¤–è³‡é€£è²· + RSI ä½æª”",value:t.name,onChange:a=>i({...t,name:a.target.value})}),e.jsx("label",{children:"è¦å‰‡ JSON (é€²éš)"}),e.jsx("textarea",{className:`modal-textarea ${N?"border-red-500":""}`,rows:8,value:JSON.stringify(t.rules_json,null,2),onChange:a=>{try{i({...t,rules_json:JSON.parse(a.target.value)}),p(!1)}catch{p(!0)}}}),N&&e.jsx("span",{className:"text-red-500 text-xs",children:"JSON æ ¼å¼ä¸æ­£ç¢º"}),e.jsxs("label",{className:"alert-checkbox",children:[e.jsx("input",{type:"checkbox",checked:t.alert_enabled,onChange:a=>i({...t,alert_enabled:a.target.checked})}),"é–‹å•Ÿæ¨æ’­é€šçŸ¥"]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>m(!1),children:"å–æ¶ˆ"}),e.jsx("button",{className:"btn btn-primary",onClick:S,disabled:!t.name.trim(),children:g?"æ›´æ–°":"å»ºç«‹"})]})]})})]})}export{T as default};
