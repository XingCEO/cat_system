import{j as e,u as D,i as E}from"./vendor-data-CkOiUkF9.js";import{a as o}from"./vendor-react-CiXd1m8D.js";import{C as d,a as C,b as R,d as _,c as m}from"./card-BInHG3Zt.js";import{c as x,B as F}from"./index-CN1IIGNT.js";import{T as I,o as S,p as U,q as z,S as K}from"./StockAnalysisDialog-Bwyn-n6i.js";import{Z,e as p,E as G,G as O,R as P,L as Q,H as V,I as W,i as J}from"./vendor-utils-3hQanHZm.js";import"./vendor-radix-aGPdNwig.js";import"./vendor-charts-2uieviVG.js";import"./input-C5aoutXU.js";const A=o.forwardRef(({className:t,...l},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:x("w-full caption-bottom text-sm",t),...l})}));A.displayName="Table";const M=o.forwardRef(({className:t,...l},a)=>e.jsx("thead",{ref:a,className:x("[&_tr]:border-b",t),...l}));M.displayName="TableHeader";const $=o.forwardRef(({className:t,...l},a)=>e.jsx("tbody",{ref:a,className:x("[&_tr:last-child]:border-0",t),...l}));$.displayName="TableBody";const X=o.forwardRef(({className:t,...l},a)=>e.jsx("tfoot",{ref:a,className:x("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...l}));X.displayName="TableFooter";const N=o.forwardRef(({className:t,...l},a)=>e.jsx("tr",{ref:a,className:x("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...l}));N.displayName="TableRow";const r=o.forwardRef(({className:t,...l},a)=>e.jsx("th",{ref:a,className:x("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...l}));r.displayName="TableHead";const n=o.forwardRef(({className:t,...l},a)=>e.jsx("td",{ref:a,className:x("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...l}));n.displayName="TableCell";const Y=o.forwardRef(({className:t,...l},a)=>e.jsx("caption",{ref:a,className:x("mt-4 text-sm text-muted-foreground",t),...l}));Y.displayName="TableCaption";const j=[{id:"extreme",name:"極強勢多頭",description:"多頭排列 + 均線向上 + 價格站上 MA5",meaning:"股價正處於極速攻擊階段，最強勢",icon:Z,color:"text-red-500",bgColor:"bg-red-500/10"},{id:"steady",name:"穩健多頭",description:"多頭排列 + 均線向上 + 價格站上 MA20",meaning:"股價回測月線不破，屬於中線偏多",icon:p,color:"text-orange-500",bgColor:"bg-orange-500/10"},{id:"support",name:"波段支撐",description:"多頭排列 + 均線向上 + 價格站上 MA60",meaning:"股價回測季線支撐，長線趨勢保護短線",icon:G,color:"text-blue-500",bgColor:"bg-blue-500/10"},{id:"tangled",name:"均線糾結突破",description:"均線間距 < 1% + 收盤價放量突破",meaning:"盤整結束，發動新一波趨勢的起點",icon:O,color:"text-purple-500",bgColor:"bg-purple-500/10"}];function oe(){const[t,l]=o.useState("extreme"),[a,f]=o.useState(null),{data:i,isLoading:H,error:L,refetch:q,isFetching:b}=D({queryKey:["ma-strategy",t],queryFn:async()=>(await E.get(`/api/turnover/ma-strategy/${t}`)).data,staleTime:300*1e3,refetchOnWindowFocus:!1}),c=j.find(s=>s.id===t),B=(c==null?void 0:c.icon)||p;return e.jsxs("div",{className:"container mx-auto py-6 px-4 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(p,{className:"h-6 w-6 text-primary"}),"均線策略篩選"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"從週轉率前 200 名中篩選符合均線策略的股票"})]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>q(),disabled:b,children:[e.jsx(P,{className:`h-4 w-4 mr-2 ${b?"animate-spin":""}`}),"重新整理"]})]}),e.jsxs(I,{value:t,onValueChange:l,children:[e.jsx(S,{className:"grid w-full grid-cols-2 lg:grid-cols-4",children:j.map(s=>{const h=s.icon;return e.jsxs(U,{value:s.id,className:"flex items-center gap-2",children:[e.jsx(h,{className:`h-4 w-4 ${s.color}`}),e.jsx("span",{className:"hidden sm:inline",children:s.name}),e.jsx("span",{className:"sm:hidden",children:s.name.slice(0,2)})]},s.id)})}),j.map(s=>e.jsx(z,{value:s.id,children:e.jsxs(d,{className:`mb-6 ${s.bgColor} border-none`,children:[e.jsxs(C,{className:"pb-2",children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:`h-5 w-5 ${s.color}`}),s.name]}),e.jsx(_,{className:"text-foreground/70",children:s.description})]}),e.jsx(m,{children:e.jsx("p",{className:"text-sm font-medium",children:s.meaning})})]})},s.id))]}),i&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(d,{children:e.jsxs(m,{className:"pt-4",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:i.matched_count}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"符合策略股票數"})]})}),e.jsx(d,{children:e.jsxs(m,{className:"pt-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:i.query_date}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"查詢日期"})]})}),e.jsx(d,{children:e.jsxs(m,{className:"pt-4",children:[e.jsxs("div",{className:`text-2xl font-bold ${c==null?void 0:c.color}`,children:[e.jsx(B,{className:"h-6 w-6 inline-block mr-1"}),c==null?void 0:c.name]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"當前策略"})]})}),e.jsx(d,{children:e.jsxs(m,{className:"pt-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:"200"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"週轉率池"})]})})]}),H&&e.jsxs("div",{className:"flex items-center justify-center py-20",children:[e.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"載入中..."})]}),L&&e.jsx(d,{className:"border-red-500/50 bg-red-500/10",children:e.jsx(m,{className:"pt-6",children:e.jsx("p",{className:"text-red-500",children:"載入失敗，請重試"})})}),i&&i.items.length>0&&e.jsxs(d,{children:[e.jsxs(C,{children:[e.jsx(R,{children:"篩選結果"}),e.jsxs(_,{children:["共 ",i.matched_count," 檔股票符合「",i.strategy_name,"」策略"]})]}),e.jsx(m,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(A,{children:[e.jsx(M,{children:e.jsxs(N,{children:[e.jsx(r,{children:"代號"}),e.jsx(r,{children:"名稱"}),e.jsx(r,{children:"產業"}),e.jsx(r,{className:"text-right",children:"收盤價"}),e.jsx(r,{className:"text-right",children:"漲跌幅"}),e.jsx(r,{className:"text-right",children:"週轉率"}),e.jsx(r,{className:"text-right",children:"MA5"}),e.jsx(r,{className:"text-right",children:"MA20"}),e.jsx(r,{className:"text-right",children:"MA60"}),e.jsx(r,{children:"策略細節"}),e.jsx(r,{className:"text-center",children:"操作"})]})}),e.jsx($,{children:i.items.map(s=>{var g,u,w,y,T,v;const h=s.change_percent>=0;return e.jsxs(N,{className:"hover:bg-muted/50",children:[e.jsx(n,{className:"font-mono font-bold text-primary",children:s.symbol}),e.jsx(n,{className:"font-medium",children:s.name}),e.jsx(n,{className:"text-muted-foreground text-sm",children:s.industry||"-"}),e.jsx(n,{className:"text-right font-mono",children:(g=s.close_price)==null?void 0:g.toFixed(2)}),e.jsx(n,{className:`text-right font-mono ${h?"text-red-500":"text-green-600"}`,children:e.jsxs("span",{className:"flex items-center justify-end gap-1",children:[h?e.jsx(V,{className:"h-3 w-3"}):e.jsx(W,{className:"h-3 w-3"}),h?"+":"",(u=s.change_percent)==null?void 0:u.toFixed(2),"%"]})}),e.jsxs(n,{className:"text-right font-mono text-amber-500",children:[(w=s.turnover_rate)==null?void 0:w.toFixed(2),"%"]}),e.jsx(n,{className:"text-right font-mono text-yellow-600",children:(y=s.ma5)==null?void 0:y.toFixed(2)}),e.jsx(n,{className:"text-right font-mono text-blue-500",children:(T=s.ma20)==null?void 0:T.toFixed(2)}),e.jsx(n,{className:"text-right font-mono text-orange-500",children:(v=s.ma60)==null?void 0:v.toFixed(2)}),e.jsx(n,{className:"text-sm text-muted-foreground",children:s.strategy_detail}),e.jsx(n,{className:"text-center",children:e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>f({symbol:s.symbol,name:s.name}),className:"h-8 w-8 p-0",title:"查看K線圖",children:e.jsx(J,{className:"h-4 w-4"})})})]},s.symbol)})})]})})})]}),i&&i.items.length===0&&e.jsx(d,{children:e.jsx(m,{className:"pt-6 text-center",children:e.jsxs("p",{className:"text-muted-foreground",children:["今日無符合「",i.strategy_name,"」策略的股票"]})})}),e.jsx(K,{open:!!a,onClose:()=>f(null),symbol:(a==null?void 0:a.symbol)||null,name:a==null?void 0:a.name})]})}export{oe as default};
