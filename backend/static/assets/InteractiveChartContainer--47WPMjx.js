import{j as e,c as rt}from"./vendor-data-BGC679gK.js";import{r}from"./vendor-react-CfDhA8Yr.js";import{c as Te,B as W,p as at}from"./index-eZrj1bNV.js";import{n as lt,o as Xe,p as Ye,q as Ze}from"./vendor-radix-DB-zNCEb.js";import{f as Se,o as Ne,g as Ce}from"./vendor-charts-D18Uve9I.js";import{O as it,Q as ot,V as ct,X as ut,T as Qe,W as ft,Y as mt,_ as dt,$ as ht,a0 as gt,B as Ue,a1 as xt,a2 as bt,L as Ke,i as pt,j as yt,a3 as vt,a4 as wt,a5 as jt,R as kt,q as Rt,A as St,l as Nt}from"./vendor-utils-Duyaqd-6.js";const Je=r.forwardRef(({className:s,type:i,...h},o)=>e.jsx("input",{type:i,className:Te("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:o,...h}));Je.displayName="Input";const Ct=lt,et=r.forwardRef(({className:s,...i},h)=>e.jsx(Xe,{ref:h,className:Te("inline-flex h-10 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...i}));et.displayName=Xe.displayName;const ke=r.forwardRef(({className:s,...i},h)=>e.jsx(Ye,{ref:h,className:Te("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...i}));ke.displayName=Ye.displayName;const Re=r.forwardRef(({className:s,...i},h)=>e.jsx(Ze,{ref:h,className:Te("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...i}));Re.displayName=Ze.displayName;const ze="#ef5350",Pe="#26a69a",we={ma5:"#ffc107",ma10:"#9c27b0",ma20:"#2196f3",ma60:"#ff9800",ma120:"#9e9e9e"},Ve={upper:"#e91e63",middle:"#ffc107",lower:"#4caf50"};function Mt(s){return s.filter(i=>i.open!=null&&i.high!=null&&i.low!=null&&i.close!=null).map(i=>({time:i.date,open:i.open,high:i.high,low:i.low,close:i.close}))}function ie(s,i){return s.filter(h=>h[i]!=null&&typeof h[i]=="number").map(h=>({time:h.date,value:h[i]}))}function Lt(){return document.documentElement.classList.contains("dark")}function Dt({data:s,height:i=400,showBollinger:h=!1,visibleMAs:o={ma5:!0,ma10:!0,ma20:!0,ma60:!0,ma120:!1},onChartReady:v,onCrosshairMove:N,onChartClick:m}){const u=r.useRef(null),f=r.useRef(null),L=r.useRef(s),k=r.useRef({});return r.useEffect(()=>{if(!u.current)return;const b=Lt(),R=Se(u.current,{width:u.current.clientWidth,height:i,layout:{background:{type:Ce.Solid,color:b?"#0a0f1a":"#ffffff"},textColor:b?"#94a3b8":"#475569",fontFamily:"'Inter', system-ui, sans-serif"},grid:{vertLines:{color:b?"rgba(51, 65, 85, 0.4)":"rgba(203, 213, 225, 0.5)"},horzLines:{color:b?"rgba(51, 65, 85, 0.4)":"rgba(203, 213, 225, 0.5)"}},crosshair:{mode:Ne.Normal,vertLine:{width:1,color:b?"rgba(148, 163, 184, 0.4)":"rgba(71, 85, 105, 0.3)",style:3},horzLine:{width:1,color:b?"rgba(148, 163, 184, 0.4)":"rgba(71, 85, 105, 0.3)",style:3}},rightPriceScale:{borderColor:b?"rgba(51, 65, 85, 0.6)":"rgba(203, 213, 225, 0.8)",scaleMargins:{top:.1,bottom:.1}},timeScale:{borderColor:b?"rgba(51, 65, 85, 0.6)":"rgba(203, 213, 225, 0.8)",timeVisible:!0,secondsVisible:!1,rightOffset:0,barSpacing:8,minBarSpacing:2,fixLeftEdge:!1,fixRightEdge:!0,lockVisibleTimeRangeOnResize:!0,rightBarStaysOnScroll:!0},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!1},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}});f.current=R;const F=R.addCandlestickSeries({upColor:ze,downColor:Pe,borderUpColor:ze,borderDownColor:Pe,wickUpColor:ze,wickDownColor:Pe});k.current.candlestick=F,k.current.ma5=R.addLineSeries({color:we.ma5,lineWidth:1,visible:o.ma5!==!1,lastValueVisible:!1,priceLineVisible:!1}),k.current.ma10=R.addLineSeries({color:we.ma10,lineWidth:1,visible:o.ma10!==!1,lastValueVisible:!1,priceLineVisible:!1}),k.current.ma20=R.addLineSeries({color:we.ma20,lineWidth:1,visible:o.ma20!==!1,lastValueVisible:!1,priceLineVisible:!1}),k.current.ma60=R.addLineSeries({color:we.ma60,lineWidth:1,visible:o.ma60!==!1,lastValueVisible:!1,priceLineVisible:!1}),k.current.ma120=R.addLineSeries({color:we.ma120,lineWidth:1,visible:o.ma120===!0,lastValueVisible:!1,priceLineVisible:!1}),k.current.bbUpper=R.addLineSeries({color:Ve.upper,lineWidth:1,lineStyle:2,title:"BB Upper",visible:h}),k.current.bbMiddle=R.addLineSeries({color:Ve.middle,lineWidth:1,title:"BB Middle",visible:h}),k.current.bbLower=R.addLineSeries({color:Ve.lower,lineWidth:1,lineStyle:2,title:"BB Lower",visible:h});const A=new ResizeObserver(E=>{if(!R||E.length===0||E[0].target!==u.current)return;const y=E[0].contentRect;R.applyOptions({width:y.width,height:y.height})});return A.observe(u.current),N&&R.subscribeCrosshairMove(E=>{if(!E.time||!E.point){N(null);return}const y=E.time,p=L.current.find(X=>X.date===y);p&&N({date:p.date,open:p.open,high:p.high,low:p.low,close:p.close,volume:p.volume,ma5:p.ma5,ma10:p.ma10,ma20:p.ma20,ma60:p.ma60,ma120:p.ma120})}),R.subscribeClick(E=>{if(!E.time||!E.point)return;const y=E.time,p=L.current.find(X=>X.date===y);p&&m&&m({date:p.date,open:p.open,high:p.high,low:p.low,close:p.close,volume:p.volume,ma5:p.ma5,ma10:p.ma10,ma20:p.ma20,ma60:p.ma60,ma120:p.ma120})}),v&&v(R,F),()=>{A.disconnect(),R.remove(),f.current=null}},[]),r.useEffect(()=>{!f.current||!u.current||f.current.applyOptions({width:u.current.clientWidth,height:i})},[i]),r.useEffect(()=>{if(!f.current||!s||s.length===0)return;L.current=s;const b=k.current;b.candlestick&&b.candlestick.setData(Mt(s));const{ma5:R,ma10:F,ma20:A,ma60:E,ma120:y}=k.current;R&&R.setData(ie(s,"ma5")),F&&F.setData(ie(s,"ma10")),A&&A.setData(ie(s,"ma20")),E&&E.setData(ie(s,"ma60")),y&&y.setData(ie(s,"ma120")),b.bbUpper&&b.bbUpper.setData(ie(s,"bb_upper")),b.bbMiddle&&b.bbMiddle.setData(ie(s,"bb_middle")),b.bbLower&&b.bbLower.setData(ie(s,"bb_lower"))},[s,f.current]),r.useEffect(()=>{const b=k.current;b.ma5&&b.ma5.applyOptions({visible:o.ma5!==!1}),b.ma10&&b.ma10.applyOptions({visible:o.ma10!==!1}),b.ma20&&b.ma20.applyOptions({visible:o.ma20!==!1}),b.ma60&&b.ma60.applyOptions({visible:o.ma60!==!1}),b.ma120&&b.ma120.applyOptions({visible:o.ma120===!0})},[o]),r.useEffect(()=>{const b=k.current;b.bbUpper&&b.bbUpper.applyOptions({visible:h}),b.bbMiddle&&b.bbMiddle.applyOptions({visible:h}),b.bbLower&&b.bbLower.applyOptions({visible:h})},[h]),e.jsx("div",{ref:u,className:"w-full",style:{height:`${i}px`}})}const Tt="rgba(239, 83, 80, 0.6)",Et="rgba(38, 166, 154, 0.6)";function zt({data:s,height:i=120,onChartReady:h}){const o=r.useRef(null),v=r.useRef(null),N=r.useRef({});return r.useEffect(()=>{if(!o.current)return;const m=document.documentElement.classList.contains("dark"),u=Se(o.current,{width:o.current.clientWidth,height:i,layout:{background:{type:Ce.Solid,color:m?"#0a0f1a":"#ffffff"},textColor:m?"#94a3b8":"#475569",fontFamily:"'Inter', system-ui, sans-serif"},grid:{vertLines:{color:m?"rgba(51, 65, 85, 0.4)":"rgba(203, 213, 225, 0.5)"},horzLines:{color:m?"rgba(51, 65, 85, 0.4)":"rgba(203, 213, 225, 0.5)"}},crosshair:{mode:Ne.Normal},rightPriceScale:{borderColor:m?"rgba(51, 65, 85, 0.6)":"rgba(203, 213, 225, 0.8)",scaleMargins:{top:.1,bottom:0}},timeScale:{borderColor:m?"rgba(51, 65, 85, 0.6)":"rgba(203, 213, 225, 0.8)",visible:!1,rightOffset:0,fixRightEdge:!0,lockVisibleTimeRangeOnResize:!0},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!1},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}});v.current=u,N.current.volume=u.addHistogramSeries({priceFormat:{type:"volume"},priceScaleId:"right"}),N.current.volumeMa5=u.addLineSeries({color:"#ff9800",lineWidth:1,lineStyle:2,priceScaleId:"right"});const f=new ResizeObserver(L=>{if(!u||L.length===0||L[0].target!==o.current)return;const k=L[0].contentRect;u.applyOptions({width:k.width,height:k.height})});return f.observe(o.current),h&&h(u),()=>{f.disconnect(),u.remove(),v.current=null}},[]),r.useEffect(()=>{!v.current||!o.current||v.current.resize(o.current.clientWidth,i)},[i]),r.useEffect(()=>{if(!s||s.length===0)return;const m=N.current;if(m.volume){const u=s.map(f=>({time:f.date,value:f.volume||0,color:(f.close||0)>=(f.open||0)?Tt:Et}));m.volume.setData(u)}if(m.volumeMa5){const u=s.filter(f=>f.volume_ma5!=null).map(f=>({time:f.date,value:f.volume_ma5}));m.volumeMa5.setData(u)}},[s]),e.jsx("div",{ref:o,className:"w-full",style:{height:`${i}px`}})}function $e({data:s,height:i=200,onChartReady:h}){const o=r.useRef(null),v=r.useRef(null),N=r.useRef({});return r.useEffect(()=>{if(!o.current)return;const m=document.documentElement.classList.contains("dark"),u=Se(o.current,{width:o.current.clientWidth,height:i,layout:{background:{type:Ce.Solid,color:m?"#0a0f1a":"#ffffff"},textColor:m?"#94a3b8":"#475569",fontFamily:"'Inter', system-ui, sans-serif"},grid:{vertLines:{color:m?"rgba(51, 65, 85, 0.4)":"rgba(203, 213, 225, 0.5)"},horzLines:{color:m?"rgba(51, 65, 85, 0.4)":"rgba(203, 213, 225, 0.5)"}},crosshair:{mode:Ne.Normal},rightPriceScale:{borderColor:m?"rgba(51, 65, 85, 0.6)":"rgba(203, 213, 225, 0.8)",scaleMargins:{top:.1,bottom:.1}},timeScale:{borderColor:m?"rgba(51, 65, 85, 0.6)":"rgba(203, 213, 225, 0.8)",visible:!1,rightOffset:0,fixRightEdge:!0,lockVisibleTimeRangeOnResize:!0},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!1},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}});v.current=u,N.current.histogram=u.addHistogramSeries({priceFormat:{type:"price",precision:4,minMove:1e-4},priceScaleId:"right"}),N.current.macd=u.addLineSeries({color:"#2196f3",lineWidth:2,priceScaleId:"right"}),N.current.signal=u.addLineSeries({color:"#ff9800",lineWidth:2,priceScaleId:"right"});const f=new ResizeObserver(L=>{if(!u||L.length===0||L[0].target!==o.current)return;const k=L[0].contentRect;u.applyOptions({width:k.width,height:k.height})});return f.observe(o.current),h&&h(u),()=>{f.disconnect(),u.remove(),v.current=null}},[]),r.useEffect(()=>{!v.current||!o.current||v.current.resize(o.current.clientWidth,i)},[i]),r.useEffect(()=>{if(!s||s.length===0)return;const m=N.current;if(m.histogram){const u=s.filter(f=>f.macd_hist!=null).map(f=>({time:f.date,value:f.macd_hist,color:(f.macd_hist||0)>=0?"#ef5350":"#26a69a"}));m.histogram.setData(u)}if(m.macd){const u=s.filter(f=>f.macd!=null).map(f=>({time:f.date,value:f.macd}));m.macd.setData(u)}if(m.signal){const u=s.filter(f=>f.macd_signal!=null).map(f=>({time:f.date,value:f.macd_signal}));m.signal.setData(u)}},[s]),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 text-xs border-b",children:[e.jsx("span",{className:"font-medium",children:"MACD (12, 26, 9)"}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#2196f3"},children:"â—"})," MACD"]}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#ff9800"},children:"â—"})," Signal"]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-red-500",children:"â– "}),"/",e.jsx("span",{className:"text-green-500",children:"â– "})," Histogram"]})]}),e.jsx("div",{ref:o,className:"w-full",style:{height:`${i}px`}})]})}function qe({data:s,height:i=200,onChartReady:h}){const o=r.useRef(null),v=r.useRef(null),N=r.useRef({});return r.useEffect(()=>{if(!o.current)return;const m=document.documentElement.classList.contains("dark"),u=Se(o.current,{width:o.current.clientWidth,height:i,layout:{background:{type:Ce.Solid,color:m?"#0a0f1a":"#ffffff"},textColor:m?"#94a3b8":"#475569",fontFamily:"'Inter', system-ui, sans-serif"},grid:{vertLines:{color:m?"rgba(51, 65, 85, 0.4)":"rgba(203, 213, 225, 0.5)"},horzLines:{color:m?"rgba(51, 65, 85, 0.4)":"rgba(203, 213, 225, 0.5)"}},crosshair:{mode:Ne.Normal},rightPriceScale:{borderColor:m?"rgba(51, 65, 85, 0.6)":"rgba(203, 213, 225, 0.8)",scaleMargins:{top:.05,bottom:.05}},timeScale:{borderColor:m?"rgba(51, 65, 85, 0.6)":"rgba(203, 213, 225, 0.8)",visible:!1,rightOffset:0,fixRightEdge:!0,lockVisibleTimeRangeOnResize:!0},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!1},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}});v.current=u,N.current.kLine=u.addLineSeries({color:"#2196f3",lineWidth:2,priceScaleId:"right"}),N.current.dLine=u.addLineSeries({color:"#ff9800",lineWidth:2,priceScaleId:"right"}),u.priceScale("right").applyOptions({autoScale:!1,scaleMargins:{top:0,bottom:0}});const f=new ResizeObserver(L=>{if(!u||L.length===0||L[0].target!==o.current)return;const k=L[0].contentRect;u.applyOptions({width:k.width,height:k.height})});return f.observe(o.current),h&&h(u),()=>{f.disconnect(),u.remove(),v.current=null}},[]),r.useEffect(()=>{!v.current||!o.current||v.current.resize(o.current.clientWidth,i)},[i]),r.useEffect(()=>{if(!s||s.length===0)return;const m=N.current;if(m.kLine){const u=s.filter(f=>f.k!=null).map(f=>({time:f.date,value:f.k}));m.kLine.setData(u)}if(m.dLine){const u=s.filter(f=>f.d!=null).map(f=>({time:f.date,value:f.d}));m.dLine.setData(u)}},[s]),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 text-xs border-b",children:[e.jsx("span",{className:"font-medium",children:"KD éš¨æ©ŸæŒ‡æ¨™ (9, 3, 3)"}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#2196f3"},children:"â—"})," Kå€¼"]}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#ff9800"},children:"â—"})," Då€¼"]}),e.jsx("span",{className:"text-muted-foreground",children:"è¶…è²· 80+ / è¶…è³£ 20-"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:"5%",height:"20%",backgroundColor:"rgba(239, 83, 80, 0.08)",zIndex:1}}),e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none",style:{bottom:"5%",height:"20%",backgroundColor:"rgba(38, 166, 154, 0.08)",zIndex:1}}),e.jsx("div",{className:"absolute right-2 text-[10px] text-red-400 pointer-events-none",style:{top:"15%"},children:"80"}),e.jsx("div",{className:"absolute right-2 text-[10px] text-muted-foreground pointer-events-none",style:{top:"45%"},children:"50"}),e.jsx("div",{className:"absolute right-2 text-[10px] text-green-400 pointer-events-none",style:{bottom:"15%"},children:"20"}),e.jsx("div",{ref:o,className:"w-full relative",style:{height:`${i}px`,zIndex:2}})]})]})}function Ge({data:s,height:i=180,onChartReady:h}){const o=r.useRef(null),v=r.useRef(null),N=r.useRef(null);return r.useEffect(()=>{if(!o.current)return;const m=document.documentElement.classList.contains("dark"),u=Se(o.current,{width:o.current.clientWidth,height:i,layout:{background:{type:Ce.Solid,color:m?"#0a0f1a":"#ffffff"},textColor:m?"#94a3b8":"#475569",fontFamily:"'Inter', system-ui, sans-serif"},grid:{vertLines:{color:m?"rgba(51, 65, 85, 0.4)":"rgba(203, 213, 225, 0.5)"},horzLines:{color:m?"rgba(51, 65, 85, 0.4)":"rgba(203, 213, 225, 0.5)"}},crosshair:{mode:Ne.Normal},rightPriceScale:{borderColor:m?"rgba(51, 65, 85, 0.6)":"rgba(203, 213, 225, 0.8)",scaleMargins:{top:.05,bottom:.05}},timeScale:{borderColor:m?"rgba(51, 65, 85, 0.6)":"rgba(203, 213, 225, 0.8)",visible:!1,rightOffset:0,fixRightEdge:!0,lockVisibleTimeRangeOnResize:!0},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!1},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}});v.current=u,N.current=u.addLineSeries({color:"#9c27b0",lineWidth:2,priceScaleId:"right"}),u.priceScale("right").applyOptions({autoScale:!1,scaleMargins:{top:0,bottom:0}});const f=new ResizeObserver(L=>{if(!u||L.length===0||L[0].target!==o.current)return;const k=L[0].contentRect;u.applyOptions({width:k.width,height:k.height})});return f.observe(o.current),h&&h(u),()=>{f.disconnect(),u.remove(),v.current=null}},[]),r.useEffect(()=>{!v.current||!o.current||v.current.resize(o.current.clientWidth,i)},[i]),r.useEffect(()=>{if(!s||s.length===0||!N.current)return;const m=s.filter(u=>u.rsi!=null).map(u=>({time:u.date,value:u.rsi}));N.current.setData(m)},[s]),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 text-xs border-b",children:[e.jsx("span",{className:"font-medium",children:"RSI ç›¸å°å¼·å¼±æŒ‡æ¨™ (14)"}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#9c27b0"},children:"â—"})," RSI"]}),e.jsx("span",{className:"text-muted-foreground",children:"è¶…è²· 70+ / è¶…è³£ 30-"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:"5%",height:"30%",backgroundColor:"rgba(239, 83, 80, 0.08)",zIndex:1}}),e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none",style:{bottom:"5%",height:"30%",backgroundColor:"rgba(38, 166, 154, 0.08)",zIndex:1}}),e.jsx("div",{className:"absolute right-2 text-[10px] text-red-400 pointer-events-none",style:{top:"20%"},children:"70"}),e.jsx("div",{className:"absolute right-2 text-[10px] text-muted-foreground pointer-events-none",style:{top:"45%"},children:"50"}),e.jsx("div",{className:"absolute right-2 text-[10px] text-green-400 pointer-events-none",style:{bottom:"20%"},children:"30"}),e.jsx("div",{ref:o,className:"w-full relative",style:{height:`${i}px`,zIndex:2}})]})]})}const Pt=[{type:"trendline",label:"è¶¨å‹¢ç·š",icon:e.jsx(Qe,{className:"h-3.5 w-3.5"})},{type:"segment",label:"ç·šæ®µ",icon:e.jsx(ft,{className:"h-3.5 w-3.5"})},{type:"ray",label:"å°„ç·š",icon:e.jsx(mt,{className:"h-3.5 w-3.5"})},{type:"horizontal",label:"æ°´å¹³",icon:e.jsx(dt,{className:"h-3.5 w-3.5"})},{type:"vertical",label:"å‚ç›´",icon:e.jsx(ht,{className:"h-3.5 w-3.5"})},{type:"parallel",label:"é€šé“",icon:e.jsx(gt,{className:"h-3.5 w-3.5"})},{type:"fibonacci",label:"æ–æ³¢é‚£å¥‘",icon:e.jsx(Ue,{className:"h-3.5 w-3.5"})},{type:"golden",label:"é»ƒé‡‘åˆ†å‰²",icon:e.jsx(Ue,{className:"h-3.5 w-3.5"})},{type:"rectangle",label:"çŸ©å½¢",icon:e.jsx(xt,{className:"h-3.5 w-3.5"})},{type:"text",label:"æ–‡å­—",icon:e.jsx(bt,{className:"h-3.5 w-3.5"})}],je=["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6","#ec4899","#64748b"];function Vt({activeType:s,onTypeChange:i,drawingCount:h=0}){return e.jsxs("div",{className:"flex items-center gap-0.5 flex-wrap",children:[e.jsx(W,{variant:s==="off"?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>i("off"),title:"æ­£å¸¸æ¨¡å¼ï¼ˆå¯æ‹–æ›³/åå­—è»¸ï¼‰",children:e.jsx(it,{className:"h-3.5 w-3.5"})}),h>0&&e.jsxs(W,{variant:s==="select"?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>i("select"),title:"é¸æ“‡æ¨¡å¼ï¼ˆé»é¸ç¹ªåœ–åˆªé™¤ï¼‰",children:[e.jsx(ot,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"ml-0.5 text-[10px] bg-muted px-1 rounded",children:h})]}),e.jsx("div",{className:"w-px h-5 bg-border mx-0.5"}),Pt.map(o=>e.jsxs(W,{variant:s===o.type?"default":"ghost",size:"sm",className:"h-7 px-1.5 text-xs",onClick:()=>i(o.type),title:o.label,children:[o.icon,e.jsx("span",{className:"ml-0.5 hidden sm:inline",children:o.label})]},o.type))]})}function Ot({width:s,height:i,drawings:h,activeType:o,selectedId:v,onAddDrawing:N,onSelectDrawing:m,onDeleteDrawing:u,chart:f,mainSeries:L}){const k=r.useRef(null),b=r.useRef(null),R=r.useRef(0),F=r.useRef(f),A=r.useRef(L);r.useEffect(()=>{F.current=f,A.current=L},[f,L]);const[E,y]=r.useState(!1),[p,X]=r.useState(null),[oe,ce]=r.useState(null),[Z,fe]=r.useState(null),[me,ue]=r.useState(0),[Q,ne]=r.useState({x:0,y:0,show:!1}),[re,pe]=r.useState(""),U=r.useRef(je[0]),[ee,ae]=r.useState(0),te=o==="off",K=o==="select",Y=!te&&!K,$=r.useCallback(a=>{const t=F.current,l=A.current;if(!t||!l)return null;try{const d=t.timeScale().coordinateToLogical(a.x),g=l.coordinateToPrice(a.y);return d===null||g===null?null:{logicalIndex:d,price:g}}catch{return null}},[]),J=r.useCallback(a=>{const t=F.current,l=A.current;if(!t||!l)return null;try{const d=t.timeScale().logicalToCoordinate(a.logicalIndex),g=l.priceToCoordinate(a.price);return d===null||g===null?null:{x:d,y:g}}catch{return null}},[]);r.useEffect(()=>{if(!f)return;const a=()=>{ae(t=>t+1)};return f.timeScale().subscribeVisibleLogicalRangeChange(a),()=>{f.timeScale().unsubscribeVisibleLogicalRangeChange(a)}},[f]);const de=r.useMemo(()=>{if(!v)return null;const a=h.find(d=>d.id===v);if(!a||a.points.length===0)return null;const t=J(a.points[0]);if(!t)return null;let l=t.x,n=t.y;if(a.type==="horizontal")l=s/2;else if(a.type==="vertical")n=i/2;else if(a.points.length>=2){const d=J(a.points[1]);d&&(l=(t.x+d.x)/2,n=(t.y+d.y)/2)}return l=Math.max(50,Math.min(s-50,l)),n=Math.max(25,Math.min(i-25,n)),{x:l,y:n}},[v,h,s,i,J,ee]),w=r.useCallback((a,t)=>Math.sqrt((t.x-a.x)**2+(t.y-a.y)**2),[]),he=r.useCallback((a,t,l,n=10)=>{const d=w(t,l);if(d===0)return w(a,t)<n;const g=Math.max(0,Math.min(1,((a.x-t.x)*(l.x-t.x)+(a.y-t.y)*(l.y-t.y))/(d*d))),C={x:t.x+g*(l.x-t.x),y:t.y+g*(l.y-t.y)};return w(a,C)<n},[w]),D=r.useCallback((a,t,l,n="none")=>{if(a.beginPath(),n==="none")a.moveTo(t.x,t.y),a.lineTo(l.x,l.y);else{const d=l.x-t.x,g=l.y-t.y,C=Math.sqrt(d*d+g*g);if(C===0)return;const M=d/C,P=g/C,q=(V,_,G,H)=>{let B=1/0;return G>0&&(B=Math.min(B,(s-V)/G)),G<0&&(B=Math.min(B,-V/G)),H>0&&(B=Math.min(B,(i-_)/H)),H<0&&(B=Math.min(B,-_/H)),{x:V+G*B,y:_+H*B}};if(n==="both"){const V=q(t.x,t.y,-M,-P),_=q(l.x,l.y,M,P);a.moveTo(V.x,V.y),a.lineTo(_.x,_.y)}else{const V=q(l.x,l.y,M,P);a.moveTo(t.x,t.y),a.lineTo(V.x,V.y)}}a.stroke()},[s,i]),O=r.useCallback((a,t,l,n)=>{const d=[0,.236,.382,.5,.618,.786,1],g=["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6","#ef4444"],C=Math.min(t.x,l.x),M=Math.max(t.x,l.x);d.forEach((P,q)=>{const V=t.y+(l.y-t.y)*P;a.strokeStyle=n?"#fff":g[q],a.lineWidth=1.5,a.setLineDash([5,3]),a.beginPath(),a.moveTo(C,V),a.lineTo(M,V),a.stroke(),a.setLineDash([]),a.font="10px sans-serif",a.fillStyle=n?"#fff":g[q],a.fillText(`${(P*100).toFixed(1)}%`,M+5,V+3)})},[]),ge=r.useCallback((a,t,l,n)=>{const d=[0,.382,.5,.618,1],g=["0%","38.2%","50%","61.8%","100%"],C=["#ef4444","#ffc107","#22c55e","#3b82f6","#ef4444"],M=Math.min(t.x,l.x),P=Math.max(t.x,l.x);d.forEach((_,G)=>{const H=t.y+(l.y-t.y)*_;a.strokeStyle=n?"#fff":C[G],a.lineWidth=_===.618?2.5:1.5,a.setLineDash(_===.5?[5,3]:[]),a.beginPath(),a.moveTo(M,H),a.lineTo(P,H),a.stroke(),a.setLineDash([]),a.font=_===.618?"bold 11px sans-serif":"10px sans-serif",a.fillStyle=n?"#fff":C[G],a.fillText(g[G]+(_===.618?" â˜…":""),P+5,H+3)});const q=t.y+(l.y-t.y)*.382,V=t.y+(l.y-t.y)*.618;a.fillStyle=(n?"#ffffff":"#ffc107")+"15",a.fillRect(M,Math.min(q,V),P-M,Math.abs(V-q))},[]),ye=r.useCallback(()=>{const a=k.current;if(!a)return;const t=a.getContext("2d");if(t){t.clearRect(0,0,s,i);for(const l of h){const n=l.points.map(g=>J(g)).filter(g=>g!==null);if(n.length===0)continue;const d=l.id===v;switch(t.strokeStyle=d?"#ffffff":l.color,t.fillStyle=d?"#ffffff":l.color,t.lineWidth=d?2.5:2,t.setLineDash([]),l.type){case"trendline":n.length>=2&&(D(t,n[0],n[1],"both"),[0,1].forEach(g=>{t.beginPath(),t.arc(n[g].x,n[g].y,d?5:4,0,Math.PI*2),t.fill()}));break;case"segment":n.length>=2&&(D(t,n[0],n[1],"none"),[0,1].forEach(g=>{t.beginPath(),t.arc(n[g].x,n[g].y,d?5:4,0,Math.PI*2),t.fill()}));break;case"ray":n.length>=2&&(D(t,n[0],n[1],"end"),t.beginPath(),t.arc(n[0].x,n[0].y,d?5:4,0,Math.PI*2),t.fill());break;case"horizontal":n.length>=1&&(t.setLineDash([8,4]),t.beginPath(),t.moveTo(0,n[0].y),t.lineTo(s,n[0].y),t.stroke(),t.setLineDash([]));break;case"vertical":n.length>=1&&(t.setLineDash([8,4]),t.beginPath(),t.moveTo(n[0].x,0),t.lineTo(n[0].x,i),t.stroke(),t.setLineDash([]));break;case"parallel":if(n.length>=3){D(t,n[0],n[1],"both");const g=n[1].x-n[0].x,C=n[1].y-n[0].y,M=n[2];D(t,{x:M.x-g,y:M.y-C},{x:M.x+g,y:M.y+C},"both"),t.fillStyle=(d?"#ffffff":l.color)+"15",t.beginPath(),t.moveTo(n[0].x,n[0].y),t.lineTo(n[1].x,n[1].y),t.lineTo(M.x+g,M.y+C),t.lineTo(M.x-g,M.y-C),t.closePath(),t.fill()}break;case"fibonacci":n.length>=2&&O(t,n[0],n[1],d);break;case"golden":n.length>=2&&ge(t,n[0],n[1],d);break;case"rectangle":if(n.length>=2){const g=Math.min(n[0].x,n[1].x),C=Math.min(n[0].y,n[1].y),M=Math.abs(n[1].x-n[0].x),P=Math.abs(n[1].y-n[0].y);t.fillStyle=(d?"#ffffff":l.color)+"20",t.fillRect(g,C,M,P),t.strokeRect(g,C,M,P)}break;case"text":if(n.length>=1&&l.text){t.font="bold 13px sans-serif";const g=t.measureText(l.text);t.fillStyle="#00000080",t.fillRect(n[0].x-2,n[0].y-14,g.width+4,18),t.fillStyle=d?"#ffffff":l.color,t.fillText(l.text,n[0].x,n[0].y)}break}}if(E&&p&&Y){t.strokeStyle=U.current,t.fillStyle=U.current,t.lineWidth=2,t.setLineDash([]);const l=oe||p;switch(o){case"trendline":D(t,p,l,"both");break;case"segment":D(t,p,l,"none");break;case"ray":D(t,p,l,"end");break;case"horizontal":t.setLineDash([8,4]),t.beginPath(),t.moveTo(0,l.y),t.lineTo(s,l.y),t.stroke();break;case"vertical":t.setLineDash([8,4]),t.beginPath(),t.moveTo(l.x,0),t.lineTo(l.x,i),t.stroke();break;case"parallel":if(me===0)D(t,p,l,"both");else if(Z){D(t,p,Z,"both");const M=Z.x-p.x,P=Z.y-p.y;D(t,{x:l.x-M,y:l.y-P},{x:l.x+M,y:l.y+P},"both")}break;case"fibonacci":O(t,p,l,!1);break;case"golden":ge(t,p,l,!1);break;case"rectangle":const n=Math.min(p.x,l.x),d=Math.min(p.y,l.y),g=Math.abs(l.x-p.x),C=Math.abs(l.y-p.y);t.fillStyle=U.current+"20",t.fillRect(n,d,g,C),t.strokeRect(n,d,g,C);break}}}},[h,s,i,E,p,oe,Z,o,v,me,Y,D,O,ge,J,ee]);r.useEffect(()=>(R.current&&cancelAnimationFrame(R.current),R.current=requestAnimationFrame(ye),()=>{R.current&&cancelAnimationFrame(R.current)}),[ye]);const Me=r.useCallback(a=>{for(let t=h.length-1;t>=0;t--){const l=h[t],n=l.points.map(d=>J(d)).filter(d=>d!==null);if(n.length!==0)switch(l.type){case"trendline":case"segment":case"ray":if(n.length>=2&&he(a,n[0],n[1],12))return l;break;case"horizontal":if(n.length>=1&&Math.abs(a.y-n[0].y)<12)return l;break;case"vertical":if(n.length>=1&&Math.abs(a.x-n[0].x)<12)return l;break;case"parallel":if(n.length>=3){if(he(a,n[0],n[1],12))return l;const d=n[1].x-n[0].x,g=n[1].y-n[0].y,C=n[2];if(he(a,{x:C.x-d,y:C.y-g},{x:C.x+d,y:C.y+g},12))return l}break;case"rectangle":case"fibonacci":case"golden":if(n.length>=2){const d=Math.min(n[0].x,n[1].x)-5,g=Math.max(n[0].x,n[1].x)+5,C=Math.min(n[0].y,n[1].y)-5,M=Math.max(n[0].y,n[1].y)+5;if(a.x>=d&&a.x<=g&&a.y>=C&&a.y<=M)return l}break;case"text":if(n.length>=1&&l.text){const d=l.text.length*8+10;if(a.x>=n[0].x-5&&a.x<=n[0].x+d&&a.y>=n[0].y-18&&a.y<=n[0].y+5)return l}break}}return null},[h,he,J]),xe=r.useCallback(a=>{var l;const t=(l=k.current)==null?void 0:l.getBoundingClientRect();return t?{x:a.clientX-t.left,y:a.clientY-t.top}:null},[]),se=r.useCallback(a=>{if(!Y)return;const t=xe(a);if(t){if(o==="text"){ne({x:t.x,y:t.y,show:!0});return}U.current=je[Math.floor(Math.random()*je.length)],y(!0),X(t),ce(t),ue(0)}},[Y,o,xe]),Ee=r.useCallback(a=>{if(!E||!Y)return;const t=xe(a);t&&ce(t)},[E,Y,xe]),Le=r.useCallback(()=>{if(!E||!p||!Y)return;const a=oe||p,t=$(p),l=$(a);if(!t||!l){console.warn("åº§æ¨™è½‰æ›å¤±æ•—ï¼Œåœ–è¡¨å¯èƒ½æœªæº–å‚™å¥½"),y(!1),X(null),ce(null),fe(null),ue(0);return}if(o==="parallel"&&me===0){fe(a),ue(1);return}let n;if(o==="horizontal"||o==="vertical")n=[l];else if(o==="parallel"&&Z){const g=$(Z);if(!g){y(!1),X(null),ce(null),fe(null),ue(0);return}n=[t,g,l]}else n=[t,l];const d={id:Date.now().toString(),type:o,points:n,color:U.current};N(d),y(!1),X(null),ce(null),fe(null),ue(0)},[E,Y,p,oe,o,Z,me,N,$]),be=r.useCallback(a=>{var d;if(!K)return;const t=(d=b.current)==null?void 0:d.getBoundingClientRect();if(!t)return;const l={x:a.clientX-t.left,y:a.clientY-t.top},n=Me(l);n?(m(n.id),a.stopPropagation(),a.preventDefault()):m(null)},[K,Me,m]),le=r.useCallback(()=>{if(!re.trim()){ne({x:0,y:0,show:!1});return}const a=$({x:Q.x,y:Q.y});if(!a){console.warn("æ–‡å­—åº§æ¨™è½‰æ›å¤±æ•—"),ne({x:0,y:0,show:!1}),pe("");return}N({id:Date.now().toString(),type:"text",points:[a],color:je[Math.floor(Math.random()*je.length)],text:re}),ne({x:0,y:0,show:!1}),pe("")},[re,Q,N,$]),ve=r.useCallback(()=>{v&&(u(v),m(null))},[v,u,m]);return te?e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{zIndex:10},children:e.jsx("canvas",{ref:k,width:s,height:i,className:"absolute inset-0"})}):e.jsxs("div",{ref:b,className:"absolute inset-0",style:{zIndex:10},children:[Y&&e.jsx("canvas",{ref:k,width:s,height:i,className:"absolute inset-0 cursor-crosshair",style:{pointerEvents:"auto"},onMouseDown:se,onMouseMove:Ee,onMouseUp:Le,onMouseLeave:()=>{E&&o!=="parallel"&&Le()}}),K&&e.jsxs(e.Fragment,{children:[e.jsx("canvas",{ref:k,width:s,height:i,className:"absolute inset-0",style:{pointerEvents:"none"}}),e.jsx("div",{className:"absolute inset-0 cursor-pointer",style:{pointerEvents:"auto"},onMouseDown:be})]}),v&&de&&K&&e.jsxs(W,{variant:"destructive",size:"sm",className:"absolute h-7 px-2 text-xs shadow-lg animate-in fade-in zoom-in duration-150",style:{left:de.x-30,top:de.y-14,pointerEvents:"auto",zIndex:20},onClick:a=>{a.stopPropagation(),ve()},children:[e.jsx(ct,{className:"h-3.5 w-3.5 mr-1"}),"åˆªé™¤"]}),Q.show&&e.jsxs("div",{className:"absolute flex items-center gap-1 bg-white dark:bg-gray-800 p-1 rounded shadow-lg border",style:{left:Q.x,top:Q.y,pointerEvents:"auto",zIndex:30},children:[e.jsx(Je,{value:re,onChange:a=>pe(a.target.value),onKeyDown:a=>{a.key==="Enter"&&le(),a.key==="Escape"&&ne({x:0,y:0,show:!1})},placeholder:"è¼¸å…¥æ¨™è¨»...",className:"h-7 w-40 text-xs",autoFocus:!0}),e.jsx(W,{size:"sm",className:"h-7 px-2",onClick:le,children:"ç¢ºå®š"}),e.jsx(W,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0",onClick:()=>ne({x:0,y:0,show:!1}),children:e.jsx(ut,{className:"h-3 w-3"})})]})]})}function It(){const[s,i]=r.useState([]),[h,o]=r.useState("off"),[v,N]=r.useState(null),m=r.useCallback(b=>{i(R=>[...R,b])},[]),u=r.useCallback(b=>{i(R=>R.filter(F=>F.id!==b)),N(R=>R===b?null:R)},[]),f=r.useCallback((b,R)=>{i(F=>F.map(A=>A.id===b?{...A,...R}:A))},[]),L=r.useCallback(()=>{i([]),N(null)},[]),k=r.useMemo(()=>s.find(b=>b.id===v)||null,[s,v]);return{drawings:s,activeType:h,setActiveType:o,selectedId:v,setSelectedId:N,selectedDrawing:k,addDrawing:m,deleteDrawing:u,updateDrawing:f,clearDrawings:L}}const He={visibleStartDate:null,visibleEndDate:null,loadedStartDate:"2021-01-01",loadedEndDate:new Date().toISOString().split("T")[0],showMA5:!0,showMA10:!0,showMA20:!0,showMA60:!0,showMA120:!1,showBollinger:!1,showVolume:!0,macdParams:{fast:12,slow:26,signal:9},kdParams:{k:9,d:3,smooth:3},rsiParams:{period:14},bollingerParams:{period:20,std:2},zoomLevel:1,currentSymbol:null},Wt=rt()(at(s=>({...He,setVisibleRange:(i,h)=>s({visibleStartDate:i,visibleEndDate:h}),setLoadedRange:(i,h)=>s({loadedStartDate:i,loadedEndDate:h}),toggleIndicator:i=>s(h=>({[i]:!h[i]})),setZoomLevel:i=>s({zoomLevel:i}),setCurrentSymbol:i=>s({currentSymbol:i}),setMacdParams:i=>s({macdParams:i}),setKdParams:i=>s({kdParams:i}),setRsiParams:i=>s({rsiParams:i}),setBollingerParams:i=>s({bollingerParams:i}),resetSettings:()=>s(He)}),{name:"chart-settings",partialize:s=>({showMA5:s.showMA5,showMA10:s.showMA10,showMA20:s.showMA20,showMA60:s.showMA60,showMA120:s.showMA120,showBollinger:s.showBollinger,showVolume:s.showVolume,macdParams:s.macdParams,kdParams:s.kdParams,rsiParams:s.rsiParams,bollingerParams:s.bollingerParams})})),At=[{label:"1M",days:22,key:"1m"},{label:"3M",days:66,key:"3m"},{label:"6M",days:132,key:"6m"},{label:"1Y",days:252,key:"1y"},{label:"3Y",days:756,key:"3y"},{label:"5Y",days:1260,key:"5y"},{label:"å…¨éƒ¨",days:0,key:"all"}],Ft={main:400,volume:120,indicator:200},Gt=r.forwardRef(({data:s,symbol:i,showBollinger:h=!1,isLoading:o=!1,chartHeights:v=Ft,onLoadMore:N,onRangeChange:m,onCrosshairMove:u,onChartClick:f},L)=>{var M,P,q,V,_,G,H,B,Oe,Ie,We,Ae,Fe,_e,Be;const[k,b]=r.useState(null),[R,F]=r.useState("macd"),[A,E]=r.useState("3m"),[y,p]=r.useState(null),{drawings:X,activeType:oe,setActiveType:ce,selectedId:Z,setSelectedId:fe,addDrawing:me,deleteDrawing:ue}=It(),[Q,ne]=r.useState({width:0,height:0}),re=r.useRef(null);r.useEffect(()=>{if(!re.current)return;const c=new ResizeObserver(x=>{const j=x[0];j&&ne({width:j.contentRect.width,height:j.contentRect.height})});return c.observe(re.current),()=>c.disconnect()},[]);const pe=r.useCallback(c=>{p(c),u&&u(c)},[u]),{showMA5:U,showMA10:ee,showMA20:ae,showMA60:te,showMA120:K,showBollinger:Y,toggleIndicator:$,setVisibleRange:J}=Wt(),de=h||Y,w=r.useRef(null),he=r.useRef(null),D=r.useRef(null),O=r.useRef(null),ge=r.useRef(null),[ye,Me]=r.useState({chart:null,series:null});r.useImperativeHandle(L,()=>({captureCharts:async c=>{const x=[w.current,D.current,O.current];let j=null;if(c&&w.current&&s.length>0){const S=s.findIndex(z=>z.date===c);if(S>=0){const z=w.current.timeScale().getVisibleLogicalRange();z&&(j={from:z.from,to:z.to});const tt=j?j.to-j.from:60,st=Math.max(0,S-tt+5),nt=S;x.forEach(De=>{De&&De.timeScale().setVisibleLogicalRange({from:st,to:nt})}),await new Promise(De=>setTimeout(De,150))}}const T=S=>S?S.takeScreenshot().toDataURL("image/png"):null,I={main:T(w.current)||"",volume:T(D.current)||"",indicator:T(O.current)||""};return j&&(await new Promise(S=>setTimeout(S,50)),x.forEach(S=>{S&&S.timeScale().setVisibleLogicalRange(j)})),I}}));const xe=r.useMemo(()=>({ma5:U,ma10:ee,ma20:ae,ma60:te,ma120:K}),[U,ee,ae,te,K]),se=r.useCallback((c,x)=>{const j=c.timeScale(),T=I=>{I&&x.forEach(S=>{S&&S.timeScale().setVisibleLogicalRange(I)})};return j.subscribeVisibleLogicalRangeChange(T),()=>{j.unsubscribeVisibleLogicalRangeChange(T)}},[]),Ee=r.useCallback((c,x)=>{w.current=c,he.current=x,Me({chart:c,series:x}),c.timeScale().subscribeVisibleLogicalRangeChange(j=>{if(!j||!s.length)return;const T=Math.max(0,Math.floor(j.from)),I=Math.min(s.length-1,Math.ceil(j.to));if(s[T]&&s[I]){const S=s[T].date,z=s[I].date;b({from:S,to:z}),J(S,z),m&&m(S,z)}}),D.current&&se(c,[D.current]),O.current&&se(c,[O.current])},[s,se,J,m]),Le=r.useCallback(c=>{if(D.current=c,w.current){se(c,[w.current]);const x=w.current.timeScale().getVisibleLogicalRange();x&&c.timeScale().setVisibleLogicalRange(x)}},[se]),be=r.useCallback(c=>{if(O.current=c,w.current){se(c,[w.current]);const x=w.current.timeScale().getVisibleLogicalRange();x&&c.timeScale().setVisibleLogicalRange(x)}},[se]),le=r.useCallback((c,x)=>{if(!w.current||!s.length)return;E(x);const j=s.length-1,T=c===0?0:Math.max(0,j-c);[w.current,D.current,O.current].forEach(S=>{S&&S.timeScale().setVisibleLogicalRange({from:T,to:j+5})})},[s]),ve=r.useCallback(()=>{le(66,"3m")},[le]),a=r.useCallback(()=>{if(!w.current)return;const c=w.current.timeScale().getVisibleLogicalRange();if(!c)return;const x=(c.from+c.to)/2,j=(c.to-c.from)*.7,T=x-j/2,I=x+j/2;[w.current,D.current,O.current].forEach(z=>{z&&z.timeScale().setVisibleLogicalRange({from:T,to:I})})},[]),t=r.useCallback(()=>{if(!w.current)return;const c=w.current.timeScale().getVisibleLogicalRange();if(!c)return;const x=(c.from+c.to)/2,j=(c.to-c.from)*1.4,T=Math.max(0,x-j/2),I=Math.min(s.length,x+j/2);[w.current,D.current,O.current].forEach(z=>{z&&z.timeScale().setVisibleLogicalRange({from:T,to:I})})},[s.length]),l=r.useCallback(()=>{if(!w.current)return;const c=w.current.timeScale().getVisibleLogicalRange();if(!c)return;const x=c.to-c.from,j=x*.3,T=Math.max(0,c.from-j),I=T+x;[w.current,D.current,O.current].forEach(z=>{z&&z.timeScale().setVisibleLogicalRange({from:T,to:I})})},[]),n=r.useCallback(()=>{if(!w.current)return;const c=w.current.timeScale().getVisibleLogicalRange();if(!c)return;const x=c.to-c.from,j=x*.3,T=Math.min(s.length+5,c.to+j),I=T-x;[w.current,D.current,O.current].forEach(z=>{z&&z.timeScale().setVisibleLogicalRange({from:I,to:T})})},[s.length]),d=r.useCallback(()=>{if(!w.current||!s.length)return;const c=w.current.timeScale().getVisibleLogicalRange();if(!c)return;const x=c.to-c.from,j=s.length+5,T=j-x;[w.current,D.current,O.current].forEach(S=>{S&&S.timeScale().setVisibleLogicalRange({from:T,to:j})})},[s.length]),g=r.useCallback(()=>{if(!w.current||!s.length)return;const c=w.current.timeScale().getVisibleLogicalRange();if(!c)return;const x=c.to-c.from,j=0,T=x;[w.current,D.current,O.current].forEach(S=>{S&&S.timeScale().setVisibleLogicalRange({from:j,to:T})})},[]);r.useEffect(()=>{const c=x=>{var j;if(!(!((j=ge.current)!=null&&j.contains(document.activeElement))&&document.activeElement!==document.body))switch(x.key){case"ArrowLeft":x.preventDefault(),l();break;case"ArrowRight":x.preventDefault(),n();break;case"+":case"=":x.preventDefault(),a();break;case"-":x.preventDefault(),t();break;case"Home":x.preventDefault(),d();break;case"End":x.preventDefault(),g();break;case"r":case"R":!x.ctrlKey&&!x.metaKey&&(x.preventDefault(),ve());break}};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[l,n,a,t,d,g,ve]),r.useEffect(()=>{if(w.current&&O.current){const c=w.current.timeScale().getVisibleLogicalRange();c&&setTimeout(()=>{var x;(x=O.current)==null||x.timeScale().setVisibleLogicalRange(c)},50)}},[R]),r.useEffect(()=>{s.length>0&&setTimeout(()=>le(66,"3m"),100)},[s.length,le]);const C=r.useMemo(()=>{if(!s||s.length===0)return[];const c=s.length;return At.filter(x=>x.key==="all"?!0:c>=x.days*.7)},[s]);return!s||s.length===0?e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:o?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 animate-spin"}),"è¼‰å…¥ä¸­..."]}):"ç„¡è³‡æ–™"}):e.jsxs("div",{ref:ge,className:"w-full space-y-2",tabIndex:0,children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 px-2",children:[e.jsx("div",{className:"flex items-center gap-1",children:C.map(c=>e.jsx(W,{variant:A===c.key?"default":"outline",size:"sm",className:`h-7 px-2.5 text-xs font-medium transition-all ${A===c.key?"bg-primary text-primary-foreground shadow-sm":"hover:bg-accent"}`,onClick:()=>le(c.days,c.key),children:c.label},c.key))}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:l,title:"â† å¾€å·¦ç§»å‹•",children:e.jsx(pt,{className:"h-4 w-4"})}),e.jsx(W,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:n,title:"â†’ å¾€å³ç§»å‹•",children:e.jsx(yt,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(W,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:a,title:"+ æ”¾å¤§",children:e.jsx(vt,{className:"h-4 w-4"})}),e.jsx(W,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:t,title:"- ç¸®å°",children:e.jsx(wt,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(W,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:d,title:"Home: è·³åˆ°æœ€æ–°",children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsx(W,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:ve,title:"R: é‡ç½®",children:e.jsx(kt,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(Vt,{activeType:oe,onTypeChange:ce,drawingCount:X.length})]}),k&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground bg-muted px-2 py-1 rounded",children:[e.jsx(Rt,{className:"h-3 w-3"}),e.jsxs("span",{children:[k.from," ~ ",k.to]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs px-2",children:[e.jsxs("span",{children:[e.jsx("span",{className:"inline-block w-3 h-3 mr-1",style:{backgroundColor:"#ef5350"}})," ä¸Šæ¼²"]}),e.jsxs("span",{children:[e.jsx("span",{className:"inline-block w-3 h-3 mr-1",style:{backgroundColor:"#26a69a"}})," ä¸‹è·Œ"]}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(W,{variant:U?"default":"ghost",size:"sm",className:"h-5 px-1.5 text-xs",style:{backgroundColor:U?"#ffc107":void 0,color:U?"black":"#ffc107"},onClick:()=>$("showMA5"),children:"MA5"}),U&&((y==null?void 0:y.ma5)??((M=s[s.length-1])==null?void 0:M.ma5))&&e.jsx("span",{className:"font-mono",style:{color:"#ffc107"},children:(q=(y==null?void 0:y.ma5)??((P=s[s.length-1])==null?void 0:P.ma5))==null?void 0:q.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(W,{variant:ee?"default":"ghost",size:"sm",className:"h-5 px-1.5 text-xs",style:{backgroundColor:ee?"#9c27b0":void 0,color:ee?"white":"#9c27b0"},onClick:()=>$("showMA10"),children:"MA10"}),ee&&((y==null?void 0:y.ma10)??((V=s[s.length-1])==null?void 0:V.ma10))&&e.jsx("span",{className:"font-mono",style:{color:"#9c27b0"},children:(G=(y==null?void 0:y.ma10)??((_=s[s.length-1])==null?void 0:_.ma10))==null?void 0:G.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(W,{variant:ae?"default":"ghost",size:"sm",className:"h-5 px-1.5 text-xs",style:{backgroundColor:ae?"#2196f3":void 0,color:ae?"white":"#2196f3"},onClick:()=>$("showMA20"),children:"MA20"}),ae&&((y==null?void 0:y.ma20)??((H=s[s.length-1])==null?void 0:H.ma20))&&e.jsx("span",{className:"font-mono",style:{color:"#2196f3"},children:(Oe=(y==null?void 0:y.ma20)??((B=s[s.length-1])==null?void 0:B.ma20))==null?void 0:Oe.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(W,{variant:te?"default":"ghost",size:"sm",className:"h-5 px-1.5 text-xs",style:{backgroundColor:te?"#ff9800":void 0,color:te?"black":"#ff9800"},onClick:()=>$("showMA60"),children:"MA60"}),te&&((y==null?void 0:y.ma60)??((Ie=s[s.length-1])==null?void 0:Ie.ma60))&&e.jsx("span",{className:"font-mono",style:{color:"#ff9800"},children:(Ae=(y==null?void 0:y.ma60)??((We=s[s.length-1])==null?void 0:We.ma60))==null?void 0:Ae.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(W,{variant:K?"default":"ghost",size:"sm",className:"h-5 px-1.5 text-xs",style:{backgroundColor:K?"#9e9e9e":void 0,color:K?"black":"#9e9e9e"},onClick:()=>$("showMA120"),children:"MA120"}),K&&((y==null?void 0:y.ma120)??((Fe=s[s.length-1])==null?void 0:Fe.ma120))&&e.jsx("span",{className:"font-mono",style:{color:"#9e9e9e"},children:(Be=(y==null?void 0:y.ma120)??((_e=s[s.length-1])==null?void 0:_e.ma120))==null?void 0:Be.toFixed(2)})]}),de&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#e91e63"},children:"- -"})," å¸ƒæ—ä¸Šè»Œ"]}),e.jsxs("span",{children:[e.jsx("span",{style:{color:"#4caf50"},children:"- -"})," å¸ƒæ—ä¸‹è»Œ"]})]})]}),e.jsxs("div",{ref:re,className:"rounded-xl overflow-hidden relative transition-all duration-300 ease-in-out ring-1 ring-border/50",style:{height:v.main},children:[o&&e.jsx("div",{className:"absolute inset-0 bg-background/50 flex items-center justify-center z-10",children:e.jsx(Ke,{className:"h-6 w-6 animate-spin"})}),e.jsx(Dt,{data:s,height:v.main,showBollinger:de,visibleMAs:xe,onChartReady:Ee,onCrosshairMove:pe,onChartClick:f}),Q.width>0&&e.jsx(Ot,{width:Q.width,height:Q.height,drawings:X,activeType:oe,selectedId:Z,onAddDrawing:me,onSelectDrawing:fe,onDeleteDrawing:ue,chart:ye.chart,mainSeries:ye.series})]}),e.jsxs("div",{className:"rounded-xl overflow-hidden transition-all duration-300 ease-in-out ring-1 ring-border/50",style:{height:v.volume+28},children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 text-xs text-muted-foreground border-b",children:[e.jsx("span",{children:"æˆäº¤é‡"}),e.jsxs("span",{className:"ml-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"})," ä¸Šæ¼²",e.jsx("span",{className:"text-green-500 ml-2",children:"â—"})," ä¸‹è·Œ",e.jsx("span",{className:"ml-2",style:{color:"#ff9800"},children:"- -"})," 5æ—¥å‡é‡"]})]}),e.jsx(zt,{data:s,height:v.volume,onChartReady:Le})]}),e.jsxs(Ct,{value:R,onValueChange:F,className:"w-full",children:[e.jsxs(et,{className:"grid w-full grid-cols-4",children:[e.jsxs(ke,{value:"macd",className:"flex items-center gap-1",children:[e.jsx(St,{className:"h-3 w-3"}),"MACD"]}),e.jsxs(ke,{value:"kd",className:"flex items-center gap-1",children:[e.jsx(Nt,{className:"h-3 w-3"}),"KD"]}),e.jsxs(ke,{value:"rsi",className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),"RSI"]}),e.jsx(ke,{value:"all",children:"å…¨éƒ¨"})]}),e.jsx(Re,{value:"macd",className:"rounded-xl overflow-hidden mt-2 ring-1 ring-border/50",children:e.jsx($e,{data:s,height:v.indicator,onChartReady:be})}),e.jsx(Re,{value:"kd",className:"rounded-xl overflow-hidden mt-2 ring-1 ring-border/50",children:e.jsx(qe,{data:s,height:v.indicator,onChartReady:be})}),e.jsx(Re,{value:"rsi",className:"rounded-xl overflow-hidden mt-2 ring-1 ring-border/50",children:e.jsx(Ge,{data:s,height:v.indicator,onChartReady:be})}),e.jsxs(Re,{value:"all",className:"space-y-2 mt-2",children:[e.jsx("div",{className:"rounded-xl overflow-hidden ring-1 ring-border/50",children:e.jsx($e,{data:s,height:150,onChartReady:be})}),e.jsx("div",{className:"rounded-xl overflow-hidden ring-1 ring-border/50",children:e.jsx(qe,{data:s,height:150})}),e.jsx("div",{className:"rounded-xl overflow-hidden ring-1 ring-border/50",children:e.jsx(Ge,{data:s,height:140})})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"ğŸ’¡ æ‹–æ›³ç§»å‹• | æ»¾è¼ªç¸®æ”¾ | â†â†’ æ–¹å‘éµç§»å‹• | +/- ç¸®æ”¾ | Home è·³åˆ°æœ€æ–° | R é‡ç½®"})]})});export{Je as I,Dt as L,Gt as a};
