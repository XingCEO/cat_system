# è²“æ˜Ÿäººè³ºå¤§éŒ¢ - TWSE å°è‚¡ç¯©é¸ç³»çµ±

å°è‚¡æ¼²å¹…å€é–“ç¯©é¸å™¨ï¼Œæä¾›å¤šç¨®æŠ€è¡“åˆ†æžç¯©é¸åŠŸèƒ½ã€Kç·šåœ–è¡¨ã€ç›¤ä¸­å³æ™‚ç›£æŽ§ç­‰åŠŸèƒ½ã€‚

## ç³»çµ±æž¶æ§‹

```
â”œâ”€â”€ backend/          # FastAPI å¾Œç«¯ (Python)
â”‚   â”œâ”€â”€ main.py       # ä¸»ç¨‹å¼å…¥å£
â”‚   â”œâ”€â”€ routers/      # API è·¯ç”±
â”‚   â”œâ”€â”€ services/     # æ¥­å‹™é‚è¼¯æœå‹™
â”‚   â””â”€â”€ database.py   # è³‡æ–™åº«é€£æŽ¥
â”œâ”€â”€ frontend/         # React + TypeScript å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/    # é é¢å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ components/  # UI å…ƒä»¶
â”‚   â”‚   â””â”€â”€ services/ # API æœå‹™
â”‚   â””â”€â”€ dist/         # ç·¨è­¯ç”¢å‡º
â””â”€â”€ README.md
```

## å¿«é€Ÿå•Ÿå‹•

### å¾Œç«¯
```bash
cd backend
pip install -r requirements.txt
python main.py
# ä¼ºæœå™¨å•Ÿå‹•æ–¼ http://localhost:8000
```

### å‰ç«¯é–‹ç™¼
```bash
cd frontend
npm install
npm run dev
```

### å‰ç«¯ç·¨è­¯ä¸¦éƒ¨ç½²
```bash
cd frontend
npm run build
# å°‡ dist è¤‡è£½åˆ° backend/static
cp -r dist ../backend/static
```

---

## åŠŸèƒ½é é¢

### 1. å³æ™‚ç¯©é¸ (`/`)
é¦–é è‚¡ç¥¨ç¯©é¸ï¼Œæ”¯æ´ï¼š
- æ¼²è·Œå¹…å€é–“ç¯©é¸
- åƒ¹æ ¼å€é–“ç¯©é¸
- æˆäº¤é‡ç¯©é¸
- æŽ’åºåŠŸèƒ½

### 2. ç›¤ä¸­ç›£æŽ§ (`/realtime`)
å³æ™‚å ±åƒ¹ç›£æŽ§åŠŸèƒ½ï¼š
- é¡¯ç¤ºé€±è½‰çŽ‡å‰ N åè‚¡ç¥¨çš„å³æ™‚å ±åƒ¹
- è³‡æ–™ä¾†æºï¼šè­‰äº¤æ‰€ MISï¼ˆä¸»ï¼‰ã€Yahoo Financeï¼ˆå‚™æ´ï¼‰
- è‡ªå‹•åˆ·æ–°é–“éš”ï¼š15 ç§’
- å¿«å–æ™‚é–“ï¼š15 ç§’
- å»¶é²ï¼šç´„ 15-30 ç§’ï¼ˆè­‰äº¤æ‰€æœ¬èº«å»¶é²ï¼‰

### 3. å‰200å‘¨è½‰æ¼²åœ (`/top20-limit-up`)
ç•¶æ—¥é€±è½‰çŽ‡å‰ 200 åä¸­çš„æ¼²åœè‚¡ç¥¨ï¼š
- **æ¼²åœå®šç¾©**ï¼šæ¼²å¹… â‰¥ 9.5%
- é¡¯ç¤ºé€±è½‰çŽ‡æŽ’åã€è‚¡åƒ¹ã€æ¼²å¹…ç­‰è³‡è¨Š

### 4. ç¯©é¸å™¨ (`/turnover-filters`)
é€²éšŽç¯©é¸åŠŸèƒ½é é¢ï¼š

#### 4.1 é€±è½‰çŽ‡ç¯©é¸
- **é€±è½‰çŽ‡å…¬å¼**ï¼š`é€±è½‰çŽ‡ = (æˆäº¤é‡ / æµé€šåœ¨å¤–è‚¡æ•¸) Ã— 100%`
- å¯è¨­å®šé€±è½‰çŽ‡ä¸Šä¸‹é™ï¼ˆ%ï¼‰
- é è¨­ç„¡é™åˆ¶

#### 4.2 è¤‡åˆç¯©é¸
å¤šæ¢ä»¶çµ„åˆç¯©é¸ï¼š

| ç¯©é¸æ¢ä»¶ | èªªæ˜Ž |
|---------|------|
| æ¼²åœæ¿ | æ¼²å¹… â‰¥ 9.5% |
| è·Œåœæ¿ | è·Œå¹… â‰¤ -9.5% |
| åƒ¹æ ¼çªç ´ MA20 | æ”¶ç›¤åƒ¹ > MA20 ä¸”å‰ä¸€æ—¥æ”¶ç›¤åƒ¹ â‰¤ MA20 |
| MA20 å‘ä¸Šè¶¨å‹¢ | æ”¶ç›¤åƒ¹ â‰¥ MA20 ä¸” MA20 å‘ˆå‘ä¸Šè¶¨å‹¢ï¼ˆä»Šæ—¥ MA20 > 5æ—¥å‰ MA20ï¼‰ |

#### 4.3 æ—¥æœŸå€é–“æŸ¥è©¢
- æ”¯æ´æŸ¥è©¢æ­·å²æ—¥æœŸå€é–“çš„ç¯©é¸çµæžœ
- é è¨­ç‚ºæœ€è¿‘äº¤æ˜“æ—¥

### 5. å‡ç·šçªç ´ (`/ma-breakout`)
å°ˆé–€ç¯©é¸å‡ç·šçªç ´çš„è‚¡ç¥¨ï¼š
- **çªç ´ MA20 å®šç¾©**ï¼š
  - ç•¶æ—¥æ”¶ç›¤åƒ¹ > MA20
  - å‰ä¸€æ—¥æ”¶ç›¤åƒ¹ â‰¤ MA20
- çµåˆé€±è½‰çŽ‡å‰ 200 åé€²è¡Œç¯©é¸

### 6. é«˜å‘¨è½‰æ¼²åœ (`/turnover`)
é«˜é€±è½‰çŽ‡ä¸”æ¼²åœçš„è‚¡ç¥¨ç¯©é¸

### 7. æ‰¹æ¬¡æ¯”å° (`/batch`)
æ‰¹æ¬¡è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿé€²è¡Œæ¯”å°åˆ†æž

### 8. å›žæ¸¬åˆ†æž (`/backtest`)
æ­·å²å›žæ¸¬åŠŸèƒ½

### 9. ç›£æŽ§æ¸…å–® (`/watchlist`)
è‡ªé¸è‚¡ç›£æŽ§æ¸…å–®

### 10. æ­·å²è¨˜éŒ„ (`/history`)
æŸ¥è©¢æ­·å²ç¯©é¸è¨˜éŒ„

---

## ç¯©é¸è¦å‰‡è©³è§£

### é€±è½‰çŽ‡è¨ˆç®—
```
é€±è½‰çŽ‡ (%) = (ç•¶æ—¥æˆäº¤é‡ / æµé€šåœ¨å¤–è‚¡æ•¸) Ã— 100
```

**è³‡æ–™ä¾†æº**ï¼š
- æˆäº¤é‡ï¼šTWSE OpenAPI æ¯æ—¥äº¤æ˜“è³‡æ–™
- æµé€šåœ¨å¤–è‚¡æ•¸ï¼šTWSE OpenAPI å…¬å¸åŸºæœ¬è³‡æ–™

### æ¼²åœæ¿åˆ¤å®š
```
æ¼²åœ = æ¼²å¹… â‰¥ 9.5%
```
> è¨»ï¼šå°è‚¡æ¼²è·Œå¹…é™åˆ¶ç‚º 10%ï¼Œä½¿ç”¨ 9.5% ä½œç‚ºé–€æª»ä»¥æ¶µè“‹æŽ¥è¿‘æ¼²åœçš„è‚¡ç¥¨

### è·Œåœæ¿åˆ¤å®š
```
è·Œåœ = æ¼²å¹… â‰¤ -9.5%
```

### MA20 è¨ˆç®—
```
MA20 = éŽåŽ» 20 å€‹äº¤æ˜“æ—¥æ”¶ç›¤åƒ¹çš„ç°¡å–®ç§»å‹•å¹³å‡
```

### MA20 çªç ´åˆ¤å®š
```python
çªç ´ = (ä»Šæ—¥æ”¶ç›¤åƒ¹ > ä»Šæ—¥ MA20) and (æ˜¨æ—¥æ”¶ç›¤åƒ¹ <= æ˜¨æ—¥ MA20)
```

### MA20 å‘ä¸Šè¶¨å‹¢åˆ¤å®š
```python
MA20å‘ä¸Š = (ä»Šæ—¥æ”¶ç›¤åƒ¹ >= ä»Šæ—¥ MA20) and (ä»Šæ—¥ MA20 > 5æ—¥å‰ MA20)
```

---

## K ç·šåœ–åŠŸèƒ½

### é¡¯ç¤ºè³‡è¨Š
é»žæ“Šä»»æ„è‚¡ç¥¨å¯é–‹å•Ÿ K ç·šåœ–å½ˆçª—ï¼Œé¡¯ç¤ºï¼š

| æ¬„ä½ | èªªæ˜Ž |
|-----|------|
| é–‹ç›¤åƒ¹ | ç•¶æ—¥é–‹ç›¤åƒ¹æ ¼ |
| æ”¶ç›¤åƒ¹ | ç•¶æ—¥æ”¶ç›¤åƒ¹æ ¼ |
| æœ€é«˜åƒ¹ | ç•¶æ—¥æœ€é«˜åƒ¹æ ¼ |
| æœ€ä½Žåƒ¹ | ç•¶æ—¥æœ€ä½Žåƒ¹æ ¼ |
| æ¼²è·Œå¹… | ç›¸å°å‰ä¸€æ—¥çš„æ¼²è·Œç™¾åˆ†æ¯” |
| æˆäº¤é‡ | ç•¶æ—¥æˆäº¤å¼µæ•¸ |

### å‡ç·šé¡¯ç¤º
- MA5ï¼ˆé»ƒè‰²ï¼‰
- MA10ï¼ˆç´«è‰²ï¼‰
- MA20ï¼ˆè—è‰²ï¼‰
- MA60ï¼ˆæ©˜è‰²ï¼‰
- MA120ï¼ˆç°è‰²ï¼‰

### æŠ€è¡“æŒ‡æ¨™
- MACD
- KD éš¨æ©ŸæŒ‡æ¨™
- æˆäº¤é‡æŸ±ç‹€åœ–

### äº’å‹•åŠŸèƒ½
- æ»‘é¼ ç§»å‹•ï¼šå³æ™‚é¡¯ç¤ºè©²æ—¥æœŸçš„åƒ¹æ ¼è³‡è¨Š
- é»žæ“ŠéŽ–å®šï¼šå›ºå®šé¡¯ç¤ºæŸä¸€å¤©çš„è³‡æ–™
- åˆ—å°åŠŸèƒ½ï¼šåŒ¯å‡º A4 æ©«å‘åˆ—å°ç‰ˆé¢
- é€±æœŸåˆ‡æ›ï¼šæ—¥K / é€±K / æœˆK

---

## ç›¤ä¸­å³æ™‚å ±åƒ¹ç³»çµ±

### è³‡æ–™ä¾†æºå„ªå…ˆé †åº
1. **è­‰äº¤æ‰€ MIS API**ï¼ˆä¸»è¦ï¼‰
   - å»¶é²ï¼š10-30 ç§’
   - å…è²»ã€ç„¡éœ€å¸³è™Ÿ
2. **Yahoo Finance API**ï¼ˆå‚™æ´ï¼‰
   - ç•¶ä¸»è¦ä¾†æºå¤±æ•—æ™‚è‡ªå‹•åˆ‡æ›

### ç³»çµ±åƒæ•¸
| åƒæ•¸ | å€¼ | èªªæ˜Ž |
|-----|-----|------|
| CACHE_TTL | 15 ç§’ | å¿«å–å­˜æ´»æ™‚é–“ |
| CACHE_MAX_SIZE | 500 | æœ€å¤§å¿«å–è‚¡ç¥¨æ•¸ |
| BATCH_SIZE | 80 | æ¯æ‰¹æŸ¥è©¢è‚¡ç¥¨æ•¸ |
| BATCH_DELAY | 1.5 ç§’ | æ‰¹æ¬¡é–“éš”æ™‚é–“ |
| REQUEST_TIMEOUT | 10 ç§’ | è«‹æ±‚è¶…æ™‚æ™‚é–“ |
| MAX_RETRIES | 3 | æœ€å¤§é‡è©¦æ¬¡æ•¸ |

### è«‹æ±‚ç¯€æµ
- æœ€å°è«‹æ±‚é–“éš”ï¼š1 ç§’
- éš¨æ©Ÿå»¶é²ï¼š0.1-0.5 ç§’ï¼ˆé¿å…è¢«å°éŽ–ï¼‰

---

## API ç«¯é»ž

### è‚¡ç¥¨è³‡æ–™
- `GET /api/stocks/filter` - ç¯©é¸è‚¡ç¥¨
- `GET /api/stocks/{symbol}/kline` - å–å¾— K ç·šè³‡æ–™

### é€±è½‰çŽ‡åˆ†æž
- `GET /api/turnover/top20` - é€±è½‰çŽ‡å‰ 20 å
- `GET /api/turnover/top200` - é€±è½‰çŽ‡å‰ 200 å
- `GET /api/turnover/top20-limit-up` - å‰ 200 åä¸­çš„æ¼²åœè‚¡
- `GET /api/turnover/top200-limit-up` - å‰ 200 åæ¼²åœè‚¡ï¼ˆæ—¥æœŸå€é–“ï¼‰
- `GET /api/turnover/ma-breakout` - å‡ç·šçªç ´ç¯©é¸
- `GET /api/turnover/combo-filter` - è¤‡åˆæ¢ä»¶ç¯©é¸

### å³æ™‚å ±åƒ¹
- `GET /realtime/quotes?symbols=2330,2317` - å–å¾—å³æ™‚å ±åƒ¹
- `GET /realtime/top-turnover?limit=50` - é€±è½‰çŽ‡å‰ N åå³æ™‚å ±åƒ¹
- `GET /realtime/status` - æœå‹™ç‹€æ…‹
- `POST /realtime/clear-cache` - æ¸…é™¤å¿«å–
- `POST /realtime/reset-sources` - é‡ç½®è³‡æ–™ä¾†æºç‹€æ…‹

### ç³»çµ±
- `GET /api/status` - API ç‹€æ…‹
- `GET /api/health` - å¥åº·æª¢æŸ¥
- `GET /api/cache/stats` - å¿«å–çµ±è¨ˆ
- `GET /api/cache/clear` - æ¸…é™¤å¿«å–
- `GET /api/trading-date` - æœ€è¿‘äº¤æ˜“æ—¥

å®Œæ•´ API æ–‡ä»¶ï¼š`http://localhost:8000/docs`

---

## æŠ€è¡“å †ç–Š

### å¾Œç«¯
- Python 3.11+
- FastAPI
- aiohttpï¼ˆéžåŒæ­¥ HTTPï¼‰
- cachetoolsï¼ˆTTL å¿«å–ï¼‰
- SQLiteï¼ˆæœ¬åœ°è³‡æ–™åº«ï¼‰

### å‰ç«¯
- React 18
- TypeScript
- Vite
- TanStack Queryï¼ˆè³‡æ–™ç®¡ç†ï¼‰
- Tailwind CSS
- shadcn/uiï¼ˆUI å…ƒä»¶ï¼‰
- Lightweight Chartsï¼ˆK ç·šåœ–è¡¨ï¼‰
- Rechartsï¼ˆçµ±è¨ˆåœ–è¡¨ï¼‰

### è³‡æ–™ä¾†æº
- TWSE OpenAPIï¼ˆæ¯æ—¥äº¤æ˜“è³‡æ–™ï¼‰
- è­‰äº¤æ‰€ MIS APIï¼ˆç›¤ä¸­å³æ™‚å ±åƒ¹ï¼‰
- Yahoo Finance APIï¼ˆå‚™æ´è³‡æ–™ã€æ­·å²å‡ç·šï¼‰
- FinMind APIï¼ˆæ­·å² K ç·šè³‡æ–™ï¼‰

---

## å°ˆæ¡ˆçµæ§‹

```
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py              # FastAPI ä¸»ç¨‹å¼
â”‚   â”œâ”€â”€ config.py            # è¨­å®šæª”
â”‚   â”œâ”€â”€ database.py          # è³‡æ–™åº«é€£æŽ¥
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”œâ”€â”€ stocks.py        # è‚¡ç¥¨ API
â”‚   â”‚   â”œâ”€â”€ turnover.py      # é€±è½‰çŽ‡ API
â”‚   â”‚   â”œâ”€â”€ realtime.py      # å³æ™‚å ±åƒ¹ API
â”‚   â”‚   â”œâ”€â”€ analysis.py      # åˆ†æž API
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ data_fetcher.py          # è³‡æ–™æŠ“å–
â”‚   â”‚   â”œâ”€â”€ high_turnover_analyzer.py # é€±è½‰çŽ‡åˆ†æž
â”‚   â”‚   â”œâ”€â”€ realtime_quotes.py       # å³æ™‚å ±åƒ¹æœå‹™
â”‚   â”‚   â”œâ”€â”€ enhanced_kline_service.py # Kç·šæœå‹™
â”‚   â”‚   â””â”€â”€ cache_manager.py         # å¿«å–ç®¡ç†
â”‚   â””â”€â”€ static/              # å‰ç«¯ç·¨è­¯æª”æ¡ˆ
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/          # shadcn/ui å…ƒä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ charts/      # åœ–è¡¨å…ƒä»¶
â”‚   â”‚   â”‚   â””â”€â”€ StockAnalysisDialog.tsx
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ HomePage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RealtimeMonitorPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TurnoverFiltersPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MaBreakoutPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ api.ts       # API å‘¼å«
â”‚   â”‚   â””â”€â”€ store/
â”‚   â”‚       â””â”€â”€ store.ts     # ç‹€æ…‹ç®¡ç†
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

---

## æ³¨æ„äº‹é …

1. **å³æ™‚å ±åƒ¹å»¶é²**ï¼šè­‰äº¤æ‰€ MIS API æœ¬èº«æœ‰ 10-30 ç§’å»¶é²ï¼Œéžé›¶å»¶é²ç³»çµ±
2. **API é™åˆ¶**ï¼šéƒ¨åˆ† API æœ‰è«‹æ±‚é »çŽ‡é™åˆ¶ï¼Œç³»çµ±å·²å…§å»ºç¯€æµæ©Ÿåˆ¶
3. **äº¤æ˜“æ™‚é–“**ï¼šç›¤ä¸­ç›£æŽ§åŠŸèƒ½åœ¨éžäº¤æ˜“æ™‚é–“ï¼ˆ09:00-13:30 ä»¥å¤–ï¼‰é¡¯ç¤ºæ”¶ç›¤è³‡æ–™
4. **è³‡æ–™æº–ç¢ºæ€§**ï¼šæ‰€æœ‰è³‡æ–™åƒ…ä¾›åƒè€ƒï¼ŒæŠ•è³‡æ±ºç­–è«‹è‡ªè¡Œåˆ¤æ–·
5. **ç€è¦½å™¨æ”¯æ´**ï¼šå»ºè­°ä½¿ç”¨ Chrome, Edge, Firefox, Safari æœ€æ–°ç‰ˆæœ¬

---

## æ•…éšœæŽ’é™¤

### 1. é¡¯ç¤ºã€Œä»Šæ—¥éžäº¤æ˜“æ—¥ã€ä½†ç¢ºå¯¦æ˜¯äº¤æ˜“æ—¥
- è«‹æª¢æŸ¥ API é€£ç·šæ˜¯å¦æ­£å¸¸ (`http://localhost:8000/docs`)
- ç¢ºèªç³»çµ±æ™‚é–“æ˜¯å¦æ­£ç¢º
- å¯èƒ½æ˜¯è­‰äº¤æ‰€è³‡æ–™å°šæœªæ›´æ–°ï¼ˆé€šå¸¸åœ¨ä¸‹åˆ 2:00 å¾Œæ›´æ–°ï¼‰

### 2. å³æ™‚å ±åƒ¹ç„¡è³‡æ–™
- ç¢ºèªæ˜¯å¦åœ¨äº¤æ˜“æ™‚é–“å…§ï¼ˆ09:00-13:30ï¼‰
- æª¢æŸ¥ `/realtime/status` ç¢ºèªè³‡æ–™ä¾†æºå¥åº·ç‹€æ…‹
- å¯å˜—è©¦ `/realtime/reset-sources` é‡ç½®è³‡æ–™ä¾†æº

### 3. K ç·šåœ–è¡¨é¡¯ç¤ºç©ºç™½
- è«‹å˜—è©¦å¼·åˆ¶é‡æ–°æ•´ç†é é¢ï¼ˆCtrl+Shift+Rï¼‰
- ç¢ºèªç¶²è·¯é€£ç·šæ­£å¸¸
- é¦–æ¬¡è¼‰å…¥ 5 å¹´è³‡æ–™ç´„éœ€ 30-60 ç§’

### 4. è¤‡åˆç¯©é¸ç„¡çµæžœ
- ç¢ºèªç¯©é¸æ¢ä»¶æ˜¯å¦éŽæ–¼åš´æ ¼
- æª¢æŸ¥æ—¥æœŸæ˜¯å¦ç‚ºæœ‰æ•ˆäº¤æ˜“æ—¥
- æŸäº›æ¢ä»¶çµ„åˆå¯èƒ½ç¢ºå¯¦ç„¡ç¬¦åˆè‚¡ç¥¨

---

## ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸ | èªªæ˜Ž | é è¨­å€¼ |
|------|------|--------|
| `FINMIND_API_TOKEN` | FinMind API Token (é¸å¡«) | - |
| `DATABASE_URL` | è³‡æ–™åº«é€£ç·š | `sqlite:///./twse_filter.db` |
| `CORS_ORIGINS` | å…è¨±çš„ä¾†æº | `http://localhost:5173,http://localhost:8000` |

---

---

## ç³»çµ±å®‰å…¨å ±å‘Š

### å®‰å…¨å¯©è¨ˆç¸½è¦½

æœ¬ç³»çµ±å·²é€šéŽå®Œæ•´å®‰å…¨å¯©è¨ˆï¼Œæ‰€æœ‰å·²è­˜åˆ¥å•é¡Œå‡å·²ä¿®å¾©ã€‚

| é¡žåˆ¥ | å•é¡Œæè¿° | åš´é‡ç¨‹åº¦ | ç‹€æ…‹ |
|------|---------|---------|------|
| ðŸ”’ å®‰å…¨æ€§ | è·¯å¾‘ç©¿è¶Šæ¼æ´ž | ðŸ”´ é«˜ | âœ… å·²ä¿®å¾© |
| ðŸ”’ å®‰å…¨æ€§ | CORS é…ç½®éŽæ–¼å¯¬é¬† | ðŸŸ¡ ä¸­ | âœ… å·²ä¿®å¾© |
| ðŸ› å‰ç«¯é‚è¼¯ | CSV åŒ¯å‡ºå¼•è™Ÿè·³è„«å•é¡Œ | ðŸŸ¡ ä¸­ | âœ… å·²ä¿®å¾© |
| ðŸ› å‰ç«¯é‚è¼¯ | queryFn å…§ç‹€æ…‹æ›´æ–°é•è¦ | ðŸŸ¡ ä¸­ | âœ… å·²ä¿®å¾© |
| ðŸ› å‰ç«¯é‚è¼¯ | API éžç©ºæ–·è¨€ä¸å®‰å…¨ | ðŸŸ¡ ä¸­ | âœ… å·²ä¿®å¾© |
| ðŸ› å‰ç«¯é‚è¼¯ | å¸‚å ´ç‹€æ…‹ä¸å³æ™‚æ›´æ–° | ðŸŸ¢ ä½Ž | âœ… å·²ä¿®å¾© |
| ðŸ› å¾Œç«¯é‚è¼¯ | MA è¨ˆç®— None å€¼æœªéŽæ¿¾ | ðŸŸ¡ ä¸­ | âœ… å·²ä¿®å¾© |
| âœ… é©—è­‰ | è¼¸å…¥é©—è­‰ä¸€è‡´æ€§ | - | âœ… å·²ç¢ºèªå®Œå–„ |

### ä¿®å¾©è©³æƒ…

#### 1. è·¯å¾‘ç©¿è¶Šæ¼æ´ž (Path Traversal)
- **æª”æ¡ˆ**: `backend/main.py`
- **å•é¡Œ**: å‰ç«¯éœæ…‹æª”æ¡ˆè·¯ç”±æœªé©—è­‰è·¯å¾‘ï¼Œæ”»æ“Šè€…å¯èƒ½è®€å–ç³»çµ±æª”æ¡ˆ
- **ä¿®å¾©**: ä½¿ç”¨ `pathlib` é©—è­‰è«‹æ±‚è·¯å¾‘å¿…é ˆåœ¨ `FRONTEND_DIR` å…§
```python
frontend_path = Path(FRONTEND_DIR).resolve()
requested_path = (frontend_path / path).resolve()
if not str(requested_path).startswith(str(frontend_path)):
    return JSONResponse(status_code=403, content={"error": "Forbidden"})
```

#### 2. CORS é…ç½®æ”¶ç·Š
- **æª”æ¡ˆ**: `backend/main.py`
- **å•é¡Œ**: `allow_methods=["*"]` å’Œ `allow_headers=["*"]` éŽæ–¼å¯¬é¬†
- **ä¿®å¾©**: é™åˆ¶ç‚ºå¿…è¦çš„ HTTP æ–¹æ³•å’Œæ¨™é ­
```python
allow_methods=["GET", "POST", "PUT", "DELETE", "OPTIONS"],
allow_headers=["Content-Type", "Authorization", "X-Requested-With"],
```

#### 3. CSV å¼•è™Ÿè·³è„«
- **æª”æ¡ˆ**: `frontend/src/services/api.ts`
- **å•é¡Œ**: CSV åŒ¯å‡ºæ™‚è‹¥æ•¸æ“šåŒ…å«å¼•è™Ÿæœƒç ´å£žæ ¼å¼
- **ä¿®å¾©**: æ–°å¢ž `escapeCsvValue` å‡½æ•¸ï¼Œæ­£ç¢ºè™•ç†ç‰¹æ®Šå­—å…ƒ
```typescript
function escapeCsvValue(value: unknown): string {
    if (value === null || value === undefined) return '""';
    const str = String(value);
    if (str.includes('"') || str.includes(',') || str.includes('\n')) {
        return `"${str.replace(/"/g, '""')}"`;
    }
    return `"${str}"`;
}
```

#### 4. React Query ç‹€æ…‹æ›´æ–°
- **æª”æ¡ˆ**: `frontend/src/components/StockAnalysisDialog.tsx`
- **å•é¡Œ**: åœ¨ `queryFn` å…§å‘¼å« `setState` é•å React Query è¦ç¯„
- **ä¿®å¾©**: å°‡ç‹€æ…‹é‡ç½®ç§»è‡³ç¨ç«‹çš„ `useEffect`

#### 5. API éžç©ºæ–·è¨€
- **æª”æ¡ˆ**: `frontend/src/services/api.ts`
- **å•é¡Œ**: ä½¿ç”¨ `data.data!` éžç©ºæ–·è¨€å¯èƒ½å°Žè‡´åŸ·è¡Œæ™‚éŒ¯èª¤
- **ä¿®å¾©**: æ‰€æœ‰ API å‡½æ•¸åŠ å…¥é©ç•¶çš„ null æª¢æŸ¥
```typescript
if (!data.data) {
    throw new Error('API å›žæ‡‰æ ¼å¼éŒ¯èª¤ï¼šç¼ºå°‘ data æ¬„ä½');
}
return data.data;
```

#### 6. å¸‚å ´ç‹€æ…‹å³æ™‚æ›´æ–°
- **æª”æ¡ˆ**: `frontend/src/pages/RealtimeMonitorPage.tsx`
- **å•é¡Œ**: å¸‚å ´é–‹ç›¤/æ”¶ç›¤ç‹€æ…‹åªåœ¨é é¢è¼‰å…¥æ™‚è¨ˆç®—
- **ä¿®å¾©**: åŠ å…¥å®šæ™‚å™¨æ¯åˆ†é˜è‡ªå‹•æ›´æ–°ç‹€æ…‹

#### 7. MA è¨ˆç®— None å€¼éŽæ¿¾
- **æª”æ¡ˆ**: `backend/services/high_turnover_analyzer.py`
- **å•é¡Œ**: å‡ç·šè¨ˆç®—ç›´æŽ¥ä½¿ç”¨ `sum()` æœªéŽæ¿¾ None/NaN å€¼
- **ä¿®å¾©**: æ–°å¢žå®‰å…¨çš„ `_safe_ma()` æ–¹æ³•
```python
@staticmethod
def _safe_ma(values: List, period: int) -> Optional[float]:
    valid_values = [v for v in values[:period]
                    if v is not None and not (isinstance(v, float) and np.isnan(v))]
    if len(valid_values) < period:
        return None
    return sum(valid_values) / len(valid_values)
```

### å®‰å…¨å»ºè­°

1. **å®šæœŸæ›´æ–°ä¾è³´å¥—ä»¶**: åŸ·è¡Œ `pip install --upgrade` å’Œ `npm update`
2. **ç”Ÿç”¢ç’°å¢ƒ**: å»ºè­°ä½¿ç”¨ HTTPS ä¸¦è¨­å®šé©ç•¶çš„é˜²ç«ç‰†è¦å‰‡
3. **API Token**: å¦¥å–„ä¿ç®¡ `FINMIND_API_TOKEN`ï¼Œä¸è¦æäº¤è‡³ç‰ˆæœ¬æŽ§åˆ¶
4. **æ—¥èªŒç›£æŽ§**: å®šæœŸæª¢æŸ¥ `backend/logs/` ä¸­çš„éŒ¯èª¤æ—¥èªŒ

---

## æŽˆæ¬Š

MIT License

---

## ç‰ˆæœ¬è³‡è¨Š

- ç‰ˆæœ¬ï¼š1.0.1
- æœ€å¾Œæ›´æ–°ï¼š2026-02-01
- å®‰å…¨å¯©è¨ˆå®Œæˆæ—¥æœŸï¼š2026-02-01
